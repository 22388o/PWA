(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[33],{676:function(e,t,a){},716:function(e,t,a){"use strict";a.r(t);var n=a(24),c=a(2),r=a.n(c),s=a(5),o=a(12),l=a(3),i=a(42),d=a(74),u=a.n(d),b=(a(676),a(149)),j=a(13),v=a(27),p=a(561),f=a(23),h=a(17),m=a(441),O=a(474),x=a(440),g=a(4);t.default=function(){var e,t=Object(i.b)(),a=Object(f.g)(),c=h.useSelector((function(e){return e.content.seedProviderPub})),d=h.useSelector((function(e){return e.content.seedInfo})),k=d.seedUrl,y=d.seedToken,w=h.useSelector((function(e){return e.content.availableTokens})),N=h.useSelector((function(e){return e.userProfiles})),S=Object(l.useState)(null),C=Object(o.a)(S,2),P=C[0],T=C[1],D=Object(l.useState)(!1),I=Object(o.a)(D,2),R=I[0],U=I[1],A=Object(l.useState)([]),F=Object(o.a)(A,2),W=F[0],B=F[1],E=Object(l.useState)(""),L=Object(o.a)(E,2),M=L[0],z=L[1],H=Object(l.useState)(!1),J=Object(o.a)(H,2),q=J[0],_=J[1],G=Object(l.useState)(""),K=Object(o.a)(G,2),Q=K[0],V=K[1],X=Object(l.useState)("public"),Y=Object(o.a)(X,2),Z=Y[0],$=Y[1],ee=Object(l.useRef)(null),te=Object(l.useRef)(null),ae=Object(l.useState)(null),ne=Object(o.a)(ae,2),ce=ne[0],re=ne[1],se=Object(l.useState)([]),oe=Object(o.a)(se,2),le=oe[0],ie=oe[1],de=Object(l.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(n,s){var l,i,d,u,b,j,f,h,m,O,x,g,N,S,C,P;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log([M,Q,le]),M){e.next=5;break}return T("Please input a title"),_(!0),e.abrupt("return");case 5:if(0!==le.length){e.next=8;break}return T("No selected files"),e.abrupt("return");case 8:return U(!0),l=null,e.prev=10,e.next=13,Object(p.a)({availableTokens:w,seedProviderPub:c,seedToken:y,seedUrl:k,serviceID:s,servicePrice:n});case 13:return i=e.sent,d=i.seedUrl,u=i.tokens,b=i.deleteToken,j=new FormData,Array.from(le).forEach((function(e){return j.append("files",e)})),j.append("info","extraInfo"),j.append("comment","comment"),e.next=23,fetch("".concat(d,"/api/put_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(u[0])},body:j});case 23:return l=e.sent,e.next=26,l.json();case 26:if(f=e.sent,console.log(f),!f.error||!f.error.message){e.next=33;break}return"The provided token has already been used"===(h=f.error.message)?(T("An error occurred, please try again"),Object(v.i)(d,u[0])(t)):T(h),U(!1),e.abrupt("return");case 33:return m=f.data.torrent,O=m.magnet,x=Object(o.a)(W,1),g=x[0],console.log(g),N="video"===g.type?"video/embedded":"image/embedded",S={type:N,magnetURI:O,width:0,height:0,title:M,description:Q},e.next=41,Object(v.c)(S)(t);case 41:C=e.sent,console.log("content publish complete"),console.log(C),U(!1),b&&Object(v.i)(d,u[0])(t),a.replace("/profile"),e.next=55;break;case 49:e.prev=49,e.t0=e.catch(10),console.error(e.t0),l&&l.text().then((function(e){console.error("Response data as text: ",e)})).catch((function(e){console.error("Could not process bad response data as text: ",e)})),T(null!==(P=null===e.t0||void 0===e.t0?void 0:e.t0.errorMessage)&&void 0!==P?P:null===e.t0||void 0===e.t0?void 0:e.t0.message),U(!1);case 55:case"end":return e.stop()}}),e,null,[[10,49]])})));return function(t,a){return e.apply(this,arguments)}}(),[M,Q,le,W,w,k,y,a,t,T,c]),ue=Object(l.useCallback)((function(){re(null)}),[re]),be=Object(l.useCallback)((function(){var e=ce.servicePrice,t=ce.serviceID;de(e,t),re(null)}),[ce,de,re]),je=Object(l.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,s,o,l,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=r.a.keys(w);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(n=e.t1.value,!Object.prototype.hasOwnProperty.call(w,n)){e.next=10;break}if(!w[n][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(s="",N[c]&&(s=N[c].SeedServiceProvided),!(a||k&&y)){e.next=18;break}de(),e.next=29;break;case 18:if(!s||!c){e.next=28;break}return e.next=21,j.a.get("/api/gun/otheruser/".concat(c,"/load/offeredServices>").concat(s));case 21:o=e.sent,l=o.data,i=l.data.servicePrice,console.log(l),re({servicePrice:i,serviceID:s}),e.next=29;break;case 28:T("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[w,re,T,de,N,c,y,k]),ve=Object(l.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),z(""),_(!1),V(""),T(null),re(null),ie([]),B([]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[V,z,T,re,ie,B]),pe=Object(l.useCallback)((function(e){var t=e.target,a=t.value;switch(t.name){case"title":return _(!1),void z(a);case"description":return void V(a);case"postType":return void $(a);case"createPost":return void console.log("create post");default:return}}),[z,V]),fe=Object(l.useCallback)((function(e){e.preventDefault(),console.log(e.target.files),ie(e.target.files);var t=Array.from(e.target.files).map((function(e,t){return console.log("doing file..."),new Promise((function(a){var n=e.type,c=new FileReader;c.onload=function(e){n.startsWith("image/")&&a({type:"image",uri:e.target.result,index:t}),n.startsWith("video/")&&a({type:"video",uri:e.target.result,index:t})},c.readAsDataURL(e)}))}));Promise.allSettled(t).then((function(e){var t=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value)})),console.log(t),B(t)}))}),[ie,B]),he=Object(l.useCallback)((function(e){e.preventDefault(),ee.current.click()}),[ee]),me=Object(l.useCallback)((function(e){e.preventDefault(),te.current.click()}),[te]);return Object(g.jsxs)(O.a,{padding:!0,pageTitle:"PUBLISH CONTENT",scrolls:!0,"data-v-382d115b":"",children:[R?Object(g.jsx)(b.a,{overlay:!0,fullScreen:!0,text:"Publishing content...","data-v-382d115b":""}):null,Object(g.jsxs)("h2",{"data-v-382d115b":"",children:["Say Something",Object(g.jsx)("div",{className:"line","data-v-382d115b":""})]}),Object(g.jsxs)("form",{className:"publish-content-form",onSubmit:je,onReset:ve,"data-v-382d115b":"",children:[Object(g.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},"data-v-382d115b":"",children:[Object(g.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(g.jsx)("label",{htmlFor:"title","data-v-382d115b":"",children:Object(g.jsx)("strong",{"data-v-382d115b":"",children:"Title"})})}),Object(g.jsxs)("div",{"data-v-382d115b":"",children:[Object(g.jsxs)("strong",{"data-v-382d115b":"",children:["Audience:"," ",Object(g.jsx)("i",{className:"fas ".concat("public"===Z?"fa-globe-europe":"fa-credit-card"),"data-v-382d115b":""})]}),Object(g.jsxs)("select",{name:"postType",id:"postType",onChange:pe,style:{appearance:"none",backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)",marginLeft:"0.3rem"},"data-v-382d115b":"",children:[Object(g.jsx)("option",{value:"public",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},"data-v-382d115b":"",children:"Public"}),Object(g.jsx)("option",{value:"private","data-v-382d115b":"",children:"Paywall"})]})]})]}),Object(g.jsx)("input",{type:"text",name:"title",placeholder:"How I monetized my content with ShockWallet",value:M,onChange:pe,className:u()("input-field",q&&"input-field-error"),"data-v-382d115b":""}),Object(g.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(g.jsx)("label",{htmlFor:"contents","data-v-382d115b":"",children:Object(g.jsx)("strong",{"data-v-382d115b":"",children:"Contents"})})}),Object(g.jsxs)("div",{className:W.length>0?x.l:"publish-content-icons","data-v-382d115b":"",children:[Object(g.jsx)("i",{className:"fas fa-images publish-content-icon",onClick:he,"data-v-382d115b":""}),Object(g.jsx)("i",{className:"fas fa-video publish-content-icon",onClick:me,"data-v-382d115b":""})]}),Object(g.jsxs)("div",{className:u()((e={},Object(n.a)(e,u()("publish-content-preview",x.j),W.length>0),Object(n.a)(e,x.l,0===W.length),e)),"data-v-382d115b":"",children:[W.length>0&&W.map((function(e,t){return"image"===e.type?Object(g.jsx)("img",{alt:"Media preview ".concat(t+1),src:e.uri,width:288,className:"m-1","data-v-382d115b":""},e.index.toString()):"video"===e.type?Object(g.jsx)("video",{src:e.uri,controls:!0,width:288,className:"m-1","data-v-382d115b":""},e.index.toString()):(console.error("Unknown type of preview --| ".concat(e.type," |-- found inside <PublishContentPage />")),null)})),Object(g.jsx)("div",{className:"remove-btn",onClick:Object(l.useCallback)((function(){ie([]),B([])}),[]),"data-v-382d115b":"",children:Object(g.jsx)("i",{className:"far fa-trash-alt","data-v-382d115b":""})})]}),Object(g.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(g.jsx)("label",{htmlFor:"description","data-v-382d115b":"",children:Object(g.jsx)("strong",{"data-v-382d115b":"",children:"Description"})})}),Object(g.jsx)("textarea",{name:"description",placeholder:"I made a quick video to show you guys how easy it is to run your own social platform on ShockWallet, and start earning Bitcoin",rows:3,value:Q,onChange:pe,className:"input-field","data-v-382d115b":""}),P?Object(g.jsx)("p",{className:"error-container","data-v-382d115b":"",children:P}):null,Object(g.jsxs)("div",{className:"flex-center","data-v-382d115b":"",children:[Object(g.jsx)("input",{type:"reset",value:"Reset",className:"shock-form-button m-1","data-v-382d115b":""}),Object(g.jsx)("input",{type:"submit",value:"Submit",className:"shock-form-button-confirm m-1","data-v-382d115b":""})]})]}),ce&&Object(g.jsx)(m.a,{modalOpen:ce&&!R,toggleModal:ue,"data-v-382d115b":"",children:Object(g.jsxs)("div",{style:{padding:"1rem"},"data-v-382d115b":"",children:[Object(g.jsxs)("p",{"data-v-382d115b":"",children:["The service from the default service provider will cost:"," ",Object(g.jsxs)("strong",{"data-v-382d115b":"",children:[ce.servicePrice," sats"]})]}),Object(g.jsx)("button",{className:"shock-form-button m-1",onClick:ve,"data-v-382d115b":"",children:"cancel"}),Object(g.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:be,"data-v-382d115b":"",children:"confirm"})]})}),Object(g.jsx)("input",{type:"file",id:"file",ref:ee,className:x.l,accept:"image/*",onChange:fe,"data-v-382d115b":""}),Object(g.jsx)("input",{type:"file",id:"file",ref:te,className:x.l,accept:"video/*",onChange:fe,"data-v-382d115b":""})]})}}}]);
//# sourceMappingURL=33.3ba55f18.chunk.js.map