(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[23],{444:function(e,t,n){"use strict";var a=n(3),i=n(73),r=n.n(i),c=(n(445),n(40)),o=n(88),s=n(76),d=n(443),l=n(18),u=n(7);t.a=function(e){var t=e.pageTitle,n=e.absolute,i=void 0!==n&&n,b=e.solid,h=void 0!==b&&b,f=e.enableBackButton,v=void 0!==f&&f,p=e.onHeight,m=void 0===p?o.a:p,j=Object(c.b)(),g=Object(a.useCallback)((function(){window.history.back()}),[]),O=Object(a.useCallback)((function(){j(Object(s.c)())}),[j]),y=Object(l.useSelector)((function(e){return e.node.publicKey})),x=Object(a.useCallback)((function(e){if(e)try{m(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in MainNav:"),console.log(t)}}),[m]);return Object(u.jsxs)("div",{className:r()({"main-nav-container":!0,"main-nav-absolute":i,"main-nav-solid":h}),ref:x,"data-v-3cab5dfa":"",children:[v?Object(u.jsx)("div",{className:"main-nav-back",onClick:g,"data-v-3cab5dfa":"",children:Object(u.jsx)("i",{className:"icon icon-thin-back","data-v-3cab5dfa":""})}):Object(u.jsx)(d.a,{height:40,publicKey:y,"data-v-3cab5dfa":""}),Object(u.jsx)("p",{className:"main-nav-title unselectable","data-v-3cab5dfa":"",children:t}),Object(u.jsxs)("div",{className:"main-nav-menu-btn",onClick:O,"data-v-3cab5dfa":"",children:[Object(u.jsx)("div",{className:"main-nav-menu-dash","data-v-3cab5dfa":""}),Object(u.jsx)("div",{className:"main-nav-menu-dash","data-v-3cab5dfa":""}),Object(u.jsx)("div",{className:"main-nav-menu-dash","data-v-3cab5dfa":""})]})]})}},445:function(e,t,n){},476:function(e,t,n){"use strict";t.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},523:function(e,t,n){"use strict";var a=n(3),i=a.useLayoutEffect;t.a=function(e){var t=Object(a.useRef)(e);return i((function(){t.current=e})),t}},581:function(e,t,n){},582:function(e,t,n){},583:function(e,t,n){},710:function(e,t,n){"use strict";n.r(t);var a=n(25),i=n(14),r=n(3),c=n(22),o=n(40),s=n(13),d=n(31),l=n(523),u=function(e,t){"function"!==typeof e?e.current=t:e(t)},b=function(e,t){var n=Object(r.useRef)();return Object(r.useCallback)((function(a){e.current=a,n.current&&u(n.current,null),n.current=t,t&&u(t,a)}),[t])},h={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},f=function(e){Object.keys(h).forEach((function(t){e.style.setProperty(t,h[t],"important")}))},v=null;var p=function(){},m=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],j=!!document.documentElement.currentStyle,g=function(e,t){var n=e.cacheMeasurements,a=e.maxRows,i=e.minRows,c=e.onChange,o=void 0===c?p:c,u=e.onHeightChange,h=void 0===u?p:u,g=Object(d.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var O=void 0!==g.value,y=Object(r.useRef)(null),x=b(y,t),k=Object(r.useRef)(0),w=Object(r.useRef)(),S=function(){var e=y.current,t=n&&w.current?w.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,a=(n=t,m.reduce((function(e,t){return e[t]=n[t],e}),{})),i=a.boxSizing;return""===i?null:(j&&"border-box"===i&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px"),{sizingStyle:a,paddingSize:parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),borderSize:parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth)})}(e);if(t){w.current=t;var r=function(e,t,n,a){void 0===n&&(n=1),void 0===a&&(a=1/0),v||((v=document.createElement("textarea")).setAttribute("tab-index","-1"),v.setAttribute("aria-hidden","true"),f(v)),null===v.parentNode&&document.body.appendChild(v);var i=e.paddingSize,r=e.borderSize,c=e.sizingStyle,o=c.boxSizing;Object.keys(c).forEach((function(e){var t=e;v.style[t]=c[t]})),f(v),v.value=t;var s=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(v,e);v.value="x";var d=v.scrollHeight-i,l=d*n;"border-box"===o&&(l=l+i+r),s=Math.max(l,s);var u=d*a;return"border-box"===o&&(u=u+i+r),[s=Math.min(u,s),d]}(t,e.value||e.placeholder||"x",i,a),c=r[0],o=r[1];k.current!==c&&(k.current=c,e.style.setProperty("height",c+"px","important"),h(c,{rowHeight:o}))}};return Object(r.useLayoutEffect)(S),function(e){var t=Object(l.a)(e);Object(r.useLayoutEffect)((function(){var e=function(e){t.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[])}(S),Object(r.createElement)("textarea",Object(s.a)({},g,{onChange:function(e){O||S(),o(e)},ref:x}))},O=Object(r.forwardRef)(g),y=n(73),x=n.n(y),k=n(108),w=n(56),S=n(444),C=n(0),L=n(102),N=n(7),V=function(e){var t=e.children,n=e.onHeight,a=Object(L.a)(e,["children","onHeight"]),i=r.useCallback((function(e){if(e)try{n(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in WithHeight:"),console.log(t)}}),[n]);return Object(N.jsx)("div",Object(C.a)(Object(C.a)({},a),{},{ref:i,children:t}))},F=n(26);function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var E=new Map,R=new Map,T=0;function z(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(R.has(n)||(T+=1,R.set(n,T.toString())),R.get(n)):"0":e[t]);var n})).toString()}function D(e,t,n){if(void 0===n&&(n={}),!e)return function(){};var a=function(e){var t=z(e),n=E.get(t);if(!n){var a,i=new Map,r=new IntersectionObserver((function(t){t.forEach((function(t){var n,r=t.isIntersecting&&a.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=r),null==(n=i.get(t.target))||n.forEach((function(e){e(r,t)}))}))}),e);a=r.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:r,elements:i},E.set(t,n)}return n}(n),i=a.id,r=a.observer,c=a.elements,o=c.get(e)||[];return c.has(e)||c.set(e,o),o.push(t),r.observe(e),function(){o.splice(o.indexOf(t),1),0===o.length&&(c.delete(e),r.unobserve(e)),0===c.size&&(r.disconnect(),E.delete(i))}}function H(e){return"function"!==typeof e.children}var A=function(e){var t,n;function a(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),H(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=a.prototype;return i.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,a=e.rootMargin,i=e.trackVisibility,r=e.delay;this._unobserveCb=D(this.node,this.handleChange,{threshold:t,root:n,rootMargin:a,trackVisibility:i,delay:r})}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!H(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var a=this.props,i=a.children,c=a.as,o=a.tag,s=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(a,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(r.createElement)(c||o||"div",M({ref:this.handleNode},s),i)},a}(r.Component);A.displayName="InView",A.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var I=n(446),K=n(443),_=n(88),B=(n(581),{threshold:.2}),W=function(e){var t=e.text,n=void 0===t?"":t,a=e.receivedMessage,i=void 0!==a&&a,c=e.publicKey,o=void 0===c?"":c,s=e.timestamp,d=e.onInView,l=void 0===d?_.a:d,u=e.onOutView,b=void 0===u?_.a:u,h=e.id,f=function(e){var t=void 0===e?{}:e,n=t.threshold,a=t.delay,i=t.trackVisibility,c=t.rootMargin,o=t.root,s=t.triggerOnce,d=t.skip,l=t.initialInView,u=Object(r.useRef)(),b=Object(r.useState)({inView:!!l}),h=b[0],f=b[1],v=Object(r.useCallback)((function(e){void 0!==u.current&&(u.current(),u.current=void 0),d||e&&(u.current=D(e,(function(e,t){f({inView:e,entry:t}),t.isIntersecting&&s&&u.current&&(u.current(),u.current=void 0)}),{root:o,rootMargin:c,threshold:n,trackVisibility:i,delay:a}))}),[Array.isArray(n)?n.toString():n,o,c,s,d,i,a]);Object(r.useEffect)((function(){u.current||!h.entry||s||d||f({inView:!!l})}));var p=[v,h.inView,h.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}(B),v=f.inView,p=f.ref;Object(r.useEffect)((function(){v?l(h):b(h)}),[h,v,l,b]);var m=Object(r.useMemo)((function(){try{var e=F.k(s);return k.DateTime.fromMillis(e).toLocaleString(k.DateTime.TIME_SIMPLE)}catch(t){return console.error(t),null}}),[s]);return Object(N.jsxs)("div",{className:x()({message:!0,"message-received":i}),ref:p,"data-v-1d23dd78":"",children:[i&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsx)(K.a,{height:48,publicKey:o,alignment:"end","data-v-1d23dd78":""}),Object(N.jsx)(I.a,{amt:16,insideRow:!0,"data-v-1d23dd78":""})]}),Object(N.jsxs)("div",{className:"message-content","data-v-1d23dd78":"",children:[Object(N.jsx)("p",{className:"message-text","data-v-1d23dd78":"",children:n}),Object(N.jsx)("div",{className:"timestamp","data-v-1d23dd78":"",children:Object(N.jsx)("p",{className:"timestamp-text","data-v-1d23dd78":"",children:m})})]})]})},P=n(145),q=n(23),U=n(476),J=(n(582),n(18)),Y=n(20),Q=n(435),G=(n(583),function(e){var t=e.acceptLabel,n=e.declineLabel,a=e.onAccept,i=e.onReject,r=e.text,c=e.title;return Object(N.jsxs)("div",{className:"chat-permission-bar","data-v-42a9b3d7":"",children:[c&&Object(N.jsx)("p",{className:"chat-permission-bar-title","data-v-42a9b3d7":"",children:c}),r&&Object(N.jsx)("p",{className:"chat-permission-bar-text unselectable","data-v-42a9b3d7":"",children:r}),(a||i)&&Object(N.jsxs)("div",{className:"chat-permission-bar-actions unselectable","data-v-42a9b3d7":"",children:[a&&Object(N.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:a,"data-v-42a9b3d7":"",children:t||"Accept"}),i&&Object(N.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline",onClick:i,"data-v-42a9b3d7":"",children:n||"Decline"})]})]})});Object(w.b)();t.default=function(){var e=Object(c.g)(),t=Object(o.b)(),n=Object(c.i)().publicKey,s=J.useSelector(J.selectUser(n)),d=Object(r.useState)(""),l=Object(i.a)(d,2),u=l[0],b=l[1],h=Object(r.useState)(20),f=Object(i.a)(h,2),v=f[0],p=f[1],m=Object(r.useState)(!1),j=Object(i.a)(m,2),g=j[0],y=j[1],C=Object(r.useState)(-1),L=Object(i.a)(C,2),F=L[0],M=L[1],E=Object(r.useMemo)((function(){return{top:F+8+"px"}}),[F]),R=Object(r.useCallback)((function(e){M(e)}),[]),T=Object(r.useCallback)((function(){g||(y(!0),setTimeout((function(){y(!1)}),1500))}),[g]),z=_.g(!1),D=Object(i.a)(z,2),H=D[0],A=D[1],I=Object(r.useMemo)((function(){return{bottom:v}}),[v]),K=_.g(!1),B=Object(i.a)(K,2),X=B[0],Z=B[1],$=Object(r.useCallback)((function(){A(),Z(),_.b.delete("/api/gun/chats/".concat(n)).then((function(){t(Object(q.c)(n)),e.goBack()})).catch((function(e){_.d.error("Error when trying to disconnect public key:",e),alert(e.message)})).finally(Z)}),[t,e,n,A,Z]),ee=J.useSelector((function(e){return e.chat.messages[n]})),te=J.useSelector((function(e){var t=e.chat;return _.c(t.contacts,n)})),ne=J.useSelector((function(e){var t=e.chat;return _.c(t.sentRequests,n)})),ae=J.useSelector((function(e){var t=e.chat;return _.c(t.receivedRequests,n)})),ie=J.useSelector((function(e){return e.node.publicKey})),re=!te&&ne,ce=!te&&ae,oe=Object(r.useCallback)((function(e){b(e.target.value)}),[]),se=Object(r.useCallback)((function(){console.log(ae),ae&&Object(q.b)(ae.id)(t)}),[ae,t]),de=Object(r.useCallback)((function(e){if("Enter"!==e.key||!e.ctrlKey)return"Enter"===e.key?(e.preventDefault(),t(Object(q.h)({message:u,publicKey:n})),void b("")):void 0;b(u+"\r\n")}),[u,n,t]),le=Object(r.useCallback)((function(){var e=t(Object(q.i)(ie,n));return Object(Y.f)(e)}),[t,ie,n]);Object(r.useEffect)((function(){return le()}),[le]);var ue=Object(r.useState)(new Set),be=Object(i.a)(ue,2),he=be[0],fe=be[1],ve=Object(r.useMemo)((function(){var e=Array.from(he).map((function(e){return ee.find((function(t){return t.id===e}))})).filter((function(e){return!!e})).sort((function(e,t){return t.timestamp-e.timestamp}));if(0===e.length)return[k.DateTime.now().valueOf(),Date.now().valueOf()];if(1===e.length){var t=Object(i.a)(e,1)[0];return[t.timestamp,t.timestamp]}return[e[0].timestamp,e[e.length-1].timestamp]}),[ee,he]),pe=Object(i.a)(ve,2),me=pe[0],je=pe[1],ge=Object(r.useCallback)((function(e){fe(Object(w.a)((function(t){t.add(e)})))}),[fe]),Oe=Object(r.useCallback)((function(e){fe(Object(w.a)((function(t){t.delete(e)})))}),[fe]),ye=s.displayName;return Object(N.jsxs)("div",{className:"page-container","data-v-6da333bb":"",children:[Object(N.jsx)(S.a,{solid:!0,pageTitle:ye,enableBackButton:!0,onHeight:R,"data-v-6da333bb":""}),Object(N.jsx)("div",{className:"chat-messages-container",onClick:H?A:void 0,onScroll:T,"data-v-6da333bb":"",children:null===ee||void 0===ee?void 0:ee.map((function(e){return Object(N.jsx)(W,{text:e.body,receivedMessage:!e.outgoing,publicKey:e.recipientPublicKey,timestamp:e.timestamp,onInView:ge,onOutView:Oe,id:e.id,"data-v-6da333bb":""})}))}),Object(N.jsx)("div",{className:x()(Q.horizontallyCenteredAbsolute,Q.absoluteStickToTop,Q.centerAlign,Q.centerJustify),style:E,"data-v-6da333bb":"",children:Object(N.jsx)("span",{className:x()(Q.fontSize12,"chat-date-bubble",g?Q.opacityThreeQuarters:Q.opacityNone),"data-v-6da333bb":"",children:function(){var e=k.DateTime.fromMillis(me).startOf("day"),t=k.DateTime.fromMillis(je).startOf("day"),n=k.DateTime.now().startOf("day"),a=k.DateTime.now().minus({day:1}).startOf("day"),i=e.hasSame(n,"year")&&t.hasSame(n,"year");if((e||t).hasSame(t,"day"))return e.hasSame(n,"day")?"Today":e.hasSame(a,"day")?"Yesterday":i?e.toFormat("LLLL d"):e.toLocaleString(k.DateTime.DATE_FULL);if(e.hasSame(t,"month")){var r=t.toFormat("d"),c=e.toFormat("d"),o=(e||t).toFormat("LLLL");if(i)return"".concat(o," ").concat(r," - ").concat(c);var s=e.toFormat("y");return"".concat(o," ").concat(r," - ").concat(c,", ").concat(s)}if(i){var d=t.toFormat("d"),l=e.toFormat("d"),u=t.toFormat("LLLL"),b=e.toFormat("LLLL");return"".concat(u," ").concat(d," - ").concat(b," ").concat(l)}var h=t.toFormat("d"),f=e.toFormat("d"),v=t.toFormat("LLLL"),p=e.toFormat("LLLL"),m=t.toFormat("y"),j=e.toFormat("y");return"".concat(v," ").concat(h,", ").concat(m," - ").concat(p," ").concat(f,", ").concat(j)}()})}),ce&&Object(N.jsx)(G,{text:"Once you accept the request, you'll be able to chat and send\n         invoices to ".concat(ye),title:"".concat(ye," has sent you a chat request!"),onAccept:se,"data-v-6da333bb":""}),re&&Object(N.jsx)(G,{text:"Once ".concat(ye," accepts the request, you'll be able to chat with\n        them"),title:"Your request has been sent to ".concat(ye," successfully"),"data-v-6da333bb":""}),te&&te.didDisconnect&&Object(N.jsx)(G,{acceptLabel:"Delete",text:"Delete this chat?",title:"Other user disconnected",onAccept:$,"data-v-6da333bb":""}),te&&!te.didDisconnect&&Object(N.jsx)(V,{className:"chat-bottom-bar",onHeight:p,onClick:H?A:void 0,"data-v-6da333bb":"",children:Object(N.jsxs)("div",{className:"chat-input-container","data-v-6da333bb":"",children:[Object(N.jsx)("div",{className:"chat-input-btn unselectable",onClick:A,"data-v-6da333bb":"",children:Object(N.jsx)("img",{src:U.a,alt:"Menu","data-v-6da333bb":""})}),Object(N.jsx)(O,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:de,onChange:oe,value:u,height:20,"data-v-6da333bb":""})]})}),Object(N.jsx)("div",{className:x()("action-menu",Object(a.a)({},Q.displayNone,!H)),style:I,"data-v-6da333bb":"",children:Object(N.jsx)("span",{className:x()("action",Q.unselectable),onClick:$,"data-v-6da333bb":"",children:"Disconnect"})}),X&&Object(N.jsx)(P.a,{overlay:!0,fullScreen:!0,text:"Disconnecting...","data-v-6da333bb":""})]})}}}]);
//# sourceMappingURL=23.5be788e1.chunk.js.map