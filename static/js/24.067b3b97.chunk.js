(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[24],{593:function(e,t,a){"use strict";a(2),a(615),a(616);var n=a(4);t.a=function(e){var t=e.text,a=void 0===t?"Submit":t,c=e.onClick;return Object(n.jsx)("div",{className:"submit-btn",onClick:c,"data-v-9903519c":"",children:Object(n.jsx)("p",{className:"submit-btn-text","data-v-9903519c":"",children:a})})}},615:function(e,t,a){},616:function(e,t,a){},829:function(e,t,a){},830:function(e,t,a){},831:function(e,t,a){},832:function(e,t,a){},882:function(e,t,a){"use strict";a.r(t);var n,c,r=a(35),s=a(3),i=a.n(s),o=a(5),l=a(15),d=a(2),u=a(47),b=a(83),v=a.n(b),j=a(245),p=a(282),f=0,m=0;var h=function(e,t,a){var r=t&&a||0,s=t||new Array(16),i=(e=e||{}).node||n,o=void 0!==e.clockseq?e.clockseq:c;if(null==i||null==o){var l=e.random||(e.rng||j.a)();null==i&&(i=n=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==o&&(o=c=16383&(l[6]<<8|l[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),u=void 0!==e.nsecs?e.nsecs:m+1,b=d-f+(u-m)/1e4;if(b<0&&void 0===e.clockseq&&(o=o+1&16383),(b<0||d>f)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=d,m=u,c=o;var v=(1e4*(268435455&(d+=122192928e5))+u)%4294967296;s[r++]=v>>>24&255,s[r++]=v>>>16&255,s[r++]=v>>>8&255,s[r++]=255&v;var h=d/4294967296*1e4&268435455;s[r++]=h>>>8&255,s[r++]=255&h,s[r++]=h>>>24&15|16,s[r++]=h>>>16&255,s[r++]=o>>>8|128,s[r++]=255&o;for(var O=0;O<6;++O)s[r+O]=i[O];return t||Object(p.a)(s)},O=(a(829),a(176)),x=a(17),g=a(28),k=a(705),w=a(26),y=a(20),C=a(580),N=a(600),S=a(0),T=a(593),P=(a(830),a(831),a(4)),D=function(e){var t=e.thumbnail,a=e.selected,n=e.setSelectedThumbnail,c=Object(d.useCallback)((function(){n(t)}),[n,t]);return Object(P.jsx)("div",{className:v()({choice:!0,active:a}),style:{backgroundImage:"url(".concat(t.preview,")")},onClick:c,"data-v-7a0da27e":""})},U=(a(832),function(e){var t=e.thumbnail,a=e.selected,n=e.onUpload,c=e.setSelectedThumbnail,r=e.removeCustomThumbnail,s=Object(d.useCallback)((function(){c(t)}),[c,t]);return t?Object(P.jsx)("div",{className:v()({"custom-image":!0,active:a}),style:{backgroundImage:"url(".concat(t.preview,")")},onClick:s,"data-v-2c2d8c9f":"",children:Object(P.jsx)("div",{className:"remove-btn",onClick:r,"data-v-2c2d8c9f":"",children:Object(P.jsx)("i",{className:"fas fa-trash","data-v-2c2d8c9f":""})})}):Object(P.jsxs)("label",{className:"custom-choice",htmlFor:"thumbnail","data-v-2c2d8c9f":"",children:[Object(P.jsx)("i",{className:"fas fa-images","data-v-2c2d8c9f":""}),Object(P.jsx)("p",{className:"choice-text","data-v-2c2d8c9f":"",children:"Upload a Thumbnail"}),Object(P.jsx)("input",{type:"file",id:"thumbnail",onChange:n,multiple:!1,accept:"image/*","data-v-2c2d8c9f":""})]})}),I=function(e){return new Promise((function(t){return e.toBlob((function(e){t(e)}))}))};function R(e){return E.apply(this,arguments)}function E(){return(E=Object(o.a)(i.a.mark((function e(t){var a,n,c,r=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:25,n=r.length>2&&void 0!==r[2]?r[2]:3,c=!(r.length>3&&void 0!==r[3])||r[3],e.abrupt("return",new Promise(function(){var e=Object(o.a)(i.a.mark((function e(r){var s,l,d,u,b,v,j,p,f,m,h,O,x;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(s=document.createElement("video")).addEventListener("seeked",Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l&&l();case 1:case"end":return e.stop()}}),e)})))),s.src=t;case 3:if(s.duration!==1/0&&!isNaN(s.duration)||!(s.readyState<2)){e.next=9;break}return e.next=6,new Promise((function(e){return setTimeout(e,1e3)}));case 6:s.currentTime=1e7*Math.random(),e.next=3;break;case 9:d=s.duration,u=document.createElement("canvas"),b=u.getContext("2d"),v=[s.videoWidth,s.videoHeight],j=v[0],p=v[1],u.width=j,u.height=p,f=[],m=15/a,h=0;case 18:if(!(n&&f.length<n||!n&&h<d)){e.next=29;break}return s.currentTime=c?Math.random()*d:h,e.next=22,new Promise((function(e){return l=e}));case 22:b.drawImage(s,0,0,j,p),O=u.toDataURL(),x=I(u),f.push({preview:O,blob:x}),h+=m,e.next=18;break;case 29:r(f);case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=function(e){var t=e.open,a=void 0!==t&&t,n=e.toggleModal,c=e.target,s=e.setVideoThumbnails,u=Object(d.useState)(),b=Object(l.a)(u,2),j=b[0],p=b[1],f=Object(d.useState)(),m=Object(l.a)(f,2),h=m[0],O=m[1],x=Object(d.useState)(),g=Object(l.a)(x,2),k=g[0],w=g[1],y=Object(d.useState)(!1),N=Object(l.a)(y,2),I=N[0],E=N[1],M=Object(d.useState)([]),F=Object(l.a)(M,2),A=F[0],L=F[1],V=Object(d.useRef)(),W=Object(d.useCallback)((function(e){p(e.preview),O(e.blob)}),[]),q=Object(d.useCallback)((function(e){var t=Object(l.a)(e.target.files,1)[0];if(t&&t.type.includes("image/")){var a=new FileReader;a.addEventListener("load",(function(){if("string"===typeof a.result){var e={preview:a.result,blob:t};w(e),W(e),console.log(e)}})),a.readAsDataURL(t)}}),[]),B=Object(d.useCallback)(Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(c.uri);case 2:t=e.sent,L(t),W(t[0]);case 5:case"end":return e.stop()}}),e)}))),[c]);Object(d.useEffect)((function(){(null===c||void 0===c?void 0:c.uri)&&B()}),[B,c]);var H=Object(d.useCallback)((function(){var e="".concat(c.type,"-").concat(c.index);s((function(t){return Object(S.a)(Object(S.a)({},t),{},Object(r.a)({},e,h))})),n()}),[s,n,c,h]),z=Object(d.useCallback)(Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V.current){e.next=2;break}return e.abrupt("return");case 2:if(!(V.current.currentTime>0&&!V.current.paused&&V.current.readyState>2)){e.next=6;break}return V.current.pause(),E(!1),e.abrupt("return");case 6:V.current.play(),E(!0);case 8:case"end":return e.stop()}}),e)}))),[V]),J=Object(d.useCallback)((function(){w(null),A.length&&W(A[0])}),[A]),K=Object(d.useCallback)((function(){E(!1)}),[]);return Object(P.jsxs)(C.a,{modalOpen:a,toggleModal:n,modalTitle:"Upload Video Thumbnail","data-v-5e06e61a":"",children:[Object(P.jsxs)("div",{className:"section","data-v-5e06e61a":"",children:[Object(P.jsx)("p",{className:"section-title","data-v-5e06e61a":"",children:"Choose a Thumbnail"}),Object(P.jsxs)("div",{className:"choices","data-v-5e06e61a":"",children:[Object(P.jsx)(U,{onUpload:q,removeCustomThumbnail:J,setSelectedThumbnail:W,selected:(null===k||void 0===k?void 0:k.preview)===j,thumbnail:k,"data-v-5e06e61a":""}),A.map((function(e){return Object(P.jsx)(D,{thumbnail:e,selected:j===e.preview,setSelectedThumbnail:W,"data-v-5e06e61a":""})}))]})]}),Object(P.jsxs)("div",{className:"section preview","data-v-5e06e61a":"",children:[Object(P.jsx)("p",{className:"section-title","data-v-5e06e61a":"",children:"Video Preview"}),Object(P.jsxs)("div",{className:v()({"sample-video":!0,"video-playing":I}),onClick:z,"data-v-5e06e61a":"",children:[Object(P.jsx)("div",{className:"play-btn","data-v-5e06e61a":"",children:Object(P.jsx)("i",{className:"fas fa-play","data-v-5e06e61a":""})}),j&&Object(P.jsx)("img",{src:j,alt:"Video thumbnail preview","data-v-5e06e61a":""}),(null===c||void 0===c?void 0:c.uri)&&Object(P.jsx)("video",{src:c.uri,ref:V,onEnded:K,"data-v-5e06e61a":""})]})]}),Object(P.jsx)(T.a,{text:"Update Thumbnail",onClick:H,"data-v-5e06e61a":""})]})},F=a(578);t.default=function(){var e,t=Object(u.b)(),a=Object(w.g)(),n=y.useSelector((function(e){return e.content.seedProviderPub})),c=y.useSelector((function(e){return e.content.seedInfo})),s=c.seedUrl,b=c.seedToken,j=y.useSelector((function(e){return e.content.availableTokens})),p=y.useSelector((function(e){return e.userProfiles})),f=Object(d.useState)(null),m=Object(l.a)(f,2),S=m[0],T=m[1],D=Object(d.useState)(!1),U=Object(l.a)(D,2),I=U[0],R=U[1],E=Object(d.useState)([]),A=Object(l.a)(E,2),L=A[0],V=A[1],W=Object(d.useState)(""),q=Object(l.a)(W,2),B=q[0],H=q[1],z=Object(d.useState)(!1),J=Object(l.a)(z,2),K=J[0],_=J[1],G=Object(d.useState)({}),Q=Object(l.a)(G,2),X=Q[0],Y=Q[1],Z=Object(d.useState)(null),$=Object(l.a)(Z,2),ee=$[0],te=$[1],ae=Object(d.useState)(!1),ne=Object(l.a)(ae,2),ce=ne[0],re=ne[1],se=Object(d.useState)(""),ie=Object(l.a)(se,2),oe=ie[0],le=ie[1],de=Object(d.useState)("public"),ue=Object(l.a)(de,2),be=ue[0],ve=ue[1],je=Object(d.useRef)(null),pe=Object(d.useRef)(null),fe=Object(d.useState)(null),me=Object(l.a)(fe,2),he=me[0],Oe=me[1],xe=y.useSelector(y.selectSelfPublicKey),ge=Object(d.useState)([]),ke=Object(l.a)(ge,2),we=ke[0],ye=ke[1],Ce=Object(d.useCallback)(function(){var e=Object(o.a)(i.a.mark((function e(c,r){var d,u,v,p,f,m,O,x,w,y,C,N,S,P,D,U;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log([B,oe,L,X]),B){e.next=5;break}return T("Please input a title"),re(!0),e.abrupt("return");case 5:if(0!==we.length){e.next=8;break}return T("No selected files"),e.abrupt("return");case 8:return R(!0),d=null,e.prev=10,e.next=13,Object(k.a)({availableTokens:j,seedProviderPub:n,seedToken:b,seedUrl:s,serviceID:r,servicePrice:c});case 13:return u=e.sent,v=u.seedUrl,p=u.tokens,f=u.deleteToken,m=new FormData,e.next=20,Promise.all(L.map(function(){var e=Object(o.a)(i.a.mark((function e(t){var a,n,c,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.file.type.replace("".concat(t.type,"/"),""),n="".concat(t.type,"-").concat(t.index),"video"!==t.type){e.next=7;break}return c=X[n],m.append("files",t.file,"".concat(n,".").concat(a)),c&&c.type&&(s=null===(r=c.type)||void 0===r?void 0:r.replace(/.*\//gi,""),m.append("files",c,"".concat(n,"-thumb.").concat(s))),e.abrupt("return");case 7:m.append("files",t.file);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:return m.append("info","extraInfo"),m.append("comment","comment"),console.log("Form Data:",m),e.next=25,fetch("".concat(v,"/api/put_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(p[0])},body:m});case 25:return d=e.sent,e.next=28,d.json();case 28:if(O=e.sent,console.log(O),!O.error||!O.error.message){e.next=35;break}return"The provided token has already been used"===(x=O.error.message)?(T("An error occurred, please try again"),Object(g.j)(v,p[0])(t)):T(x),R(!1),e.abrupt("return");case 35:return w=O.data.torrent,y=w.magnet,C=Object(l.a)(L,1),N=C[0],console.log(N),S="video"===N.type?"video/embedded":"image/embedded",P={id:h(),timestamp:Date.now(),author:xe,type:S,magnetURI:y,width:0,height:0,title:B,description:oe},e.next=43,Object(g.c)(P,be)(t);case 43:D=e.sent,console.log("content publish complete"),console.log(D),R(!1),f&&Object(g.j)(v,p[0])(t),a.replace("/profile"),e.next=57;break;case 51:e.prev=51,e.t0=e.catch(10),console.error(e.t0),d&&d.text().then((function(e){console.error("Response data as text: ",e)})).catch((function(e){console.error("Could not process bad response data as text: ",e)})),T(null!==(U=null===e.t0||void 0===e.t0?void 0:e.t0.errorMessage)&&void 0!==U?U:null===e.t0||void 0===e.t0?void 0:e.t0.message),R(!1);case 57:case"end":return e.stop()}}),e,null,[[10,51]])})));return function(t,a){return e.apply(this,arguments)}}(),[j,oe,t,a,L,be,n,b,s,we,xe,B,X]),Ne=Object(d.useCallback)((function(){Oe(null)}),[Oe]),Se=Object(d.useCallback)((function(){var e=he.servicePrice,t=he.serviceID;Ce(e,t),Oe(null)}),[he,Ce,Oe]),Te=Object(d.useCallback)(function(){var e=Object(o.a)(i.a.mark((function e(t){var a,c,r,o,l,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=i.a.keys(j);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(c=e.t1.value,!Object.prototype.hasOwnProperty.call(j,c)){e.next=10;break}if(!j[c][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(r="",p[n]&&(r=p[n].SeedServiceProvided),!(a||s&&b)){e.next=18;break}Ce(),e.next=29;break;case 18:if(!r||!n){e.next=28;break}return e.next=21,x.a.get("/api/gun/otheruser/".concat(n,"/load/offeredServices>").concat(r));case 21:o=e.sent,l=o.data,d=l.data.servicePrice,console.log(l),Oe({servicePrice:d,serviceID:r}),e.next=29;break;case 28:T("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[j,Oe,T,Ce,p,n,b,s]),Pe=Object(d.useCallback)(function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),H(""),re(!1),le(""),T(null),Oe(null),ye([]),V([]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[le,H,T,Oe,ye,V]),De=Object(d.useCallback)((function(e){var t=e.target,a=t.value;switch(t.name){case"title":return re(!1),void H(a);case"description":return void le(a);case"postType":return void ve(a);case"createPost":return void console.log("create post");default:return}}),[H,le]),Ue=Object(d.useCallback)((function(e){e.preventDefault(),console.log(e.target.files),ye(e.target.files);var t=Array.from(e.target.files).map((function(e,t){return console.log("doing file..."),new Promise((function(a){var n=e.type,c=new FileReader;c.onload=function(c){n.startsWith("image/")&&a({type:"image",uri:c.target.result,index:t,file:e}),n.startsWith("video/")&&a({type:"video",uri:c.target.result,index:t,file:e})},c.readAsDataURL(e)}))}));Promise.allSettled(t).then((function(e){var t=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value)})),console.log(t),V(t)}))}),[ye,V]),Ie=Object(d.useCallback)((function(e){e.preventDefault(),je.current.click()}),[je]),Re=Object(d.useCallback)((function(e){e.preventDefault(),pe.current.click()}),[pe]),Ee=Object(d.useCallback)((function(){_(!K)}),[K]);return Object(P.jsxs)(N.a,{padding:!0,pageTitle:"PUBLISH CONTENT",scrolls:!0,"data-v-382d115b":"",children:[I?Object(P.jsx)(O.a,{overlay:!0,fullScreen:!0,text:"Publishing content...","data-v-382d115b":""}):null,Object(P.jsxs)("h2",{"data-v-382d115b":"",children:["Say Something",Object(P.jsx)("div",{className:"line","data-v-382d115b":""})]}),Object(P.jsxs)("form",{className:"publish-content-form",onSubmit:Te,onReset:Pe,"data-v-382d115b":"",children:[Object(P.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},"data-v-382d115b":"",children:[Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"title","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Title"})})}),Object(P.jsxs)("div",{"data-v-382d115b":"",children:[Object(P.jsxs)("strong",{"data-v-382d115b":"",children:["Audience:"," ",Object(P.jsx)("i",{className:"fas ".concat("public"===be?"fa-globe-europe":"fa-credit-card"),"data-v-382d115b":""})]}),Object(P.jsxs)("select",{name:"postType",id:"postType",onChange:De,style:{appearance:"none",backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)",marginLeft:"0.3rem"},"data-v-382d115b":"",children:[Object(P.jsx)("option",{value:"public",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},"data-v-382d115b":"",children:"Public"}),Object(P.jsx)("option",{value:"private","data-v-382d115b":"",children:"Paywall"})]})]})]}),Object(P.jsx)("input",{type:"text",name:"title",placeholder:"How I monetized my content with ShockWallet",value:B,onChange:De,className:v()("input-field",ce&&"input-field-error"),"data-v-382d115b":""}),Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"contents","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Contents"})})}),Object(P.jsxs)("div",{className:L.length>0?F.m:"publish-content-icons","data-v-382d115b":"",children:[Object(P.jsx)("i",{className:"fas fa-images publish-content-icon",onClick:Ie,"data-v-382d115b":""}),Object(P.jsx)("i",{className:"fas fa-video publish-content-icon",onClick:Re,"data-v-382d115b":""})]}),Object(P.jsxs)("div",{className:v()((e={},Object(r.a)(e,v()("publish-content-preview",F.k),L.length>0),Object(r.a)(e,F.m,0===L.length),e)),"data-v-382d115b":"",children:[L.length>0&&L.map((function(e,t){return"image"===e.type?Object(P.jsx)("img",{alt:"Media preview ".concat(t+1),src:e.uri,width:288,className:"m-1","data-v-382d115b":""},e.index.toString()):"video"===e.type?Object(P.jsxs)("div",{className:"video-preview","data-v-382d115b":"",children:[Object(P.jsx)("div",{className:"change-thumbnail-btn",onClick:function(){Ee(),te(e)},"data-v-382d115b":"",children:Object(P.jsx)("i",{className:"fas fa-images","data-v-382d115b":""})}),Object(P.jsx)("video",{src:e.uri,controls:!0,width:288,className:"m-1","data-v-382d115b":""},e.index.toString())]}):(console.error("Unknown type of preview --| ".concat(e.type," |-- found inside <PublishContentPage />")),null)})),Object(P.jsx)("div",{className:"remove-btn",onClick:Object(d.useCallback)((function(){ye([]),V([])}),[]),"data-v-382d115b":"",children:Object(P.jsx)("i",{className:"far fa-trash-alt","data-v-382d115b":""})}),Object(P.jsx)("div",{className:"remove-btn",onClick:Object(d.useCallback)((function(){ye([]),V([])}),[]),"data-v-382d115b":"",children:Object(P.jsx)("i",{className:"far fa-trash-alt","data-v-382d115b":""})})]}),Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"description","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Description"})})}),Object(P.jsx)("textarea",{name:"description",placeholder:"I made a quick video to show you guys how easy it is to run your own social platform on ShockWallet, and start earning Bitcoin",rows:3,value:oe,onChange:De,className:"input-field","data-v-382d115b":""}),S?Object(P.jsx)("p",{className:"error-container","data-v-382d115b":"",children:S}):null,Object(P.jsxs)("div",{className:"flex-center","data-v-382d115b":"",children:[Object(P.jsx)("input",{type:"reset",value:"Reset",className:"shock-form-button m-1","data-v-382d115b":""}),Object(P.jsx)("input",{type:"submit",value:"Submit",className:"shock-form-button-confirm m-1","data-v-382d115b":""})]})]}),he&&Object(P.jsx)(C.a,{modalOpen:he&&!I,toggleModal:Ne,"data-v-382d115b":"",children:Object(P.jsxs)("div",{style:{padding:"1rem"},"data-v-382d115b":"",children:[Object(P.jsxs)("p",{"data-v-382d115b":"",children:["The service from the default service provider will cost:"," ",Object(P.jsxs)("strong",{"data-v-382d115b":"",children:[he.servicePrice," sats"]})]}),Object(P.jsx)("button",{className:"shock-form-button m-1",onClick:Pe,"data-v-382d115b":"",children:"cancel"}),Object(P.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:Se,"data-v-382d115b":"",children:"confirm"})]})}),Object(P.jsx)(M,{open:K,toggleModal:Ee,target:ee,setVideoThumbnails:Y,"data-v-382d115b":""}),Object(P.jsx)("input",{type:"file",id:"file",ref:je,className:F.m,accept:"image/*",onChange:Ue,"data-v-382d115b":""}),Object(P.jsx)("input",{type:"file",id:"file",ref:pe,className:F.m,accept:"video/*",onChange:Ue,"data-v-382d115b":""})]})}}}]);
//# sourceMappingURL=24.067b3b97.chunk.js.map