{"version":3,"sources":["common/DialogNav/index.js","common/Post/components/Image/index.js","common/DarkPage/DarkPage.tsx","common/DarkPage/css/DarkPage.module.css","pages/PublicContentItem/PublicContentItemPage.tsx"],"names":["DIALOG_NAV_MIN_HEIGHT_PX","CONTAINER_STYLE","minHeight","DialogNav","pageTitle","drawerVisible","onHeight","Utils","goBack","useCallback","window","history","back","divRefCb","el","getBoundingClientRect","height","e","console","log","className","ref","style","onClick","classNames","Image","id","item","index","postId","tipValue","tipCounter","hideRibbon","width","disableZoom","useState","zoomed","setZoomed","zoomLoaded","setZoomLoaded","previewVisible","setPreviewVisible","animationTimer","setAnimationTimer","handleZoomChange","value","clearTimeout","timer","setTimeout","contentURL","decodeURIComponent","magnetURI","replace","mainImageStyle","opacity","imgNode","alt","data-torrent","data-file-key","src","onLoad","display","isZoomed","onZoomChange","overlayBgColorStart","overlayBgColorEnd","DarkPage","children","justify","padding","scrolls","Error","React","headerHeight","setHeaderHeight","c","styles","container","gStyles","Pad","amt","module","exports","PublicContentItemPage","dispatch","Store","useParams","publicKey","setItem","error","setError","author","useEffect","subscribeUserProfile","subscription","rifle","query","onError","JSON","stringify","onData","data","Schema","warn","slice","then","sub","off","onRetry","title","type","ShockAvatar","insideRow","displayName","timestamp","description"],"mappings":"qHAAA,sFAWaA,EAA2B,GAElCC,EAAkB,CACtBC,UAAWF,GAmDEG,IAhDG,SAAC,GAIZ,IAHLC,EAGI,EAHJA,UAGI,IAFJC,qBAEI,aADJC,gBACI,MADOC,IACP,EACEC,EAASC,uBAAY,WACzBC,OAAOC,QAAQC,SACd,IAGGC,EAAWJ,uBACf,SAAAK,GAEE,GAAKA,EACL,IACER,EAASQ,EAAGC,wBAAwBC,QACpC,MAAOC,GACPC,QAAQC,IAAR,iDACAD,QAAQC,IAAIF,MAGhB,CAACX,IAGH,OACE,sBACEc,UAAU,uBACVC,IAAKR,EACLS,MAAOrB,EAHT,+BAKE,qBAAKmB,UAAU,kBAAkBG,QAASf,EAA1C,8BACE,mBAAGY,UAAU,sBAAb,yBAEF,mBAAGA,UAAU,mBAAb,8BAAiChB,IACjC,sBACEgB,UAAWI,IAAW,CACpB,uBAAuB,EACvB,qBAAsBnB,IAH1B,+BAME,qBAAKe,UAAU,uBAAf,uBACA,qBAAKA,UAAU,uBAAf,uBACA,qBAAKA,UAAU,uBAAf,+B,0HCmDOK,IAtGD,SAAC,GAWR,IAAD,IAVJC,UAUI,MAVC,GAUD,EATJC,EASI,EATJA,KASI,IARJC,aAQI,MARI,EAQJ,MAPJC,cAOI,MAPK,GAOL,MANJC,gBAMI,MANO,EAMP,MALJC,kBAKI,MALS,EAKT,MAJJC,kBAII,aAHJC,aAGI,MAHI,KAGJ,MAFJC,mBAEI,aADJZ,aACI,MADkD,GAClD,IACwBa,oBAAS,GADjC,mBACGC,EADH,KACWC,EADX,OAEgCF,oBAAS,GAFzC,mBAEGG,EAFH,KAEeC,EAFf,OAGwCJ,oBAAS,GAHjD,mBAGGK,EAHH,KAGmBC,EAHnB,OAIwCN,mBAAS,MAJjD,mBAIGO,EAJH,KAImBC,EAJnB,KAMEC,EAAmBnC,uBACvB,SAAAoC,GAGE,GAFAC,aAAaJ,GACbL,EAAUQ,IACLA,GAASP,EAAY,CACxBC,GAAc,GACd,IAAMQ,EAAQC,YAAW,WACvBP,GAAkB,KA1BA,KA4BpBE,EAAkBI,GAGhBF,GACFJ,GAAkB,KAGtB,CACEC,EACAJ,EACAD,EACAE,EACAE,EACAE,IAIEM,EAAaC,mBACjBvB,EAAKwB,UAAUC,QAAQ,YAAa,KAEhCC,EAAc,2BAAQ/B,GAAR,IAAegC,QAASd,EAAiB,EAAI,IAC7DP,IACFoB,EAAepB,MAAQA,GAGzB,IAAMsB,EACJ,qCACE,qBACEnC,UAAS,wCAAmCS,EAAnC,YAA6CH,GACtD8B,IAAI,aACJC,eAAc9B,EAAKwB,UACnBO,gBAAe9B,EACfN,MAAO+B,EACPM,IAAKV,EANP,uBAQA,qBACE7B,UAAS,0CAAqCS,EAArC,YAA+CH,GACxD8B,IAAI,aACJE,gBAAe9B,EACfgC,OAAQ,WACNrB,GAAc,IAEhBjB,MAAO,CACLgC,QAASlB,EAAS,EAAI,EACtByB,QAASzB,EAAS,QAAU,QAE9BuB,IAAKV,EAXP,wBAaEjB,GACA,cAAC,IAAD,CACED,WAAYA,EACZD,SAAUA,EACVM,OAAQA,EAHV,0BASN,OACE,qBAAKhB,UAAU,kBAAf,8BACGc,EACCqB,EAEA,cAAC,IAAD,CACEO,SAAU1B,EACV2B,aAAcnB,EACdoB,oBAAoB,YACpBC,kBAAkB,UAJpB,8BAMGV,Q,kMCrDIW,EAlC2B,SAAC,GAMpC,IAAD,EALJC,EAKI,EALJA,SACAC,EAII,EAJJA,QACAC,EAGI,EAHJA,QACAjE,EAEI,EAFJA,UACAkE,EACI,EADJA,QAEA,GAAIA,GAAaF,EACf,MAAM,IAAIG,MAAJ,4DAFJ,MAKoCC,IAAMrC,SAC5CnC,KANE,mBAKGyE,EALH,KAKiBC,EALjB,KAUJ,OACE,sBACEtD,UAAWuD,IAAEC,IAAOC,WAAR,mBACTD,IAAO,uBAAyBN,GADvB,cAETQ,MAAgBV,GAFP,cAGTU,IAAoC,WAAZV,GAHf,cAITU,MAA2BT,GAJlB,IADd,UAQE,cAAClE,EAAA,EAAD,CAAWC,UAAWA,GAAa,GAAIE,SAAUoE,IAEjD,cAACK,EAAA,EAAD,CAAKC,IAAKP,IAETN,O,oBC5CPc,EAAOC,QAAU,CAAC,UAAY,4BAA4B,oBAAoB,sC,sOC4G/DC,EA1FqD,WAClE,IAAMC,EAAWC,gBADuD,EAE9CC,cAAlB5D,EAFgE,EAEhEA,GAAI6D,EAF4D,EAE5DA,UAF4D,EAGhDf,IAAMrC,SAA0C,MAHA,mBAGjER,EAHiE,KAG3D6D,EAH2D,OAI9ChB,IAAMrC,SAAiB,IAJuB,mBAIjEsD,EAJiE,KAI1DC,EAJ0D,KAMlEC,EAASN,cAAkBA,aAAiBE,IAElDf,IAAMoB,WAAU,kBAAMR,EAASS,YAAqBN,OAEpDf,IAAMoB,WAAU,WACd,GAAIH,EACF,OAAO,aAET,IAAMK,EAAeC,YAAM,CACzBC,MAAM,GAAD,OAAKT,EAAL,oCAA0C7D,EAA1C,QACLuE,QAFyB,SAEjBhF,GACNyE,EAASQ,KAAKC,UAAUlF,EAAG,KAAM,KAEnCmF,OALyB,SAKlBC,GACDC,IAA2BD,GAC7Bb,EAAQa,GAER9F,IAAagG,KAAb,8EACyEhB,EAAUiB,OAC9E,GAFL,yEAGoEN,KAAKC,UACrEE,EACA,KACA,QAOV,OAAO,WACLP,EAAaW,MAAK,SAAAC,GAAG,OAAIA,EAAIC,YAE9B,CAAClB,EAAO/D,EAAI6D,IAEf,IAAMqB,EAAUpC,IAAM/D,aAAY,WAChCiF,EAAS,MACR,IAEH,OAAID,EAEA,eAACvB,EAAA,EAAD,CAAU9D,UAAU,QAAQgE,QAAQ,SAApC,+BACE,oDAAOqB,IAEP,cAACV,EAAA,EAAD,CAAKC,IAAK,GAAV,uBAEA,wBAAQ5D,UAAU,uBAAuBG,QAASqF,EAAlD,2CAODjF,EAKH,eAACuC,EAAA,EAAD,CAAUI,SAAO,EAAjB,+BACE,kDAAK3C,EAAKkF,QAEK,mBAAdlF,EAAKmF,MAA6B,cAACrF,EAAA,EAAD,CAAOE,KAAMA,EAAb,uBAEpB,mBAAdA,EAAKmF,MAA6B,KAEnC,sBAAK1F,UAAU,OAAf,+BACE,sBAAKA,UAAU,YAAf,+BACE,cAAC2F,EAAA,EAAD,CAAa/F,OAAQ,GAAIuE,UAAWA,EAApC,uBAEA,cAACR,EAAA,EAAD,CAAKC,IAAK,GAAIgC,WAAS,EAAvB,uBAEA,oDAAOrB,EAAOsB,iBAGhB,oDAAO1G,IAAsBoB,EAAKuF,gBAGpC,mBAAG9F,UAAU,cAAb,8BAA4BO,EAAKwF,cAEjC,cAACpC,EAAA,EAAD,CAAKC,IAAK,IAAV,0BAzBK,cAACd,EAAA,EAAD,CAAU9D,UAAU,aAApB","file":"static/js/23.10a8f423.chunk.js","sourcesContent":["// @ts-check\nimport { useCallback } from \"react\";\nimport classNames from \"classnames\";\n/**\n * @typedef {import('react').RefCallback<HTMLElement>} DivRefCallback\n */\n\nimport * as Utils from \"../../utils\";\n\nimport \"./css/index.scoped.css\";\n\nexport const DIALOG_NAV_MIN_HEIGHT_PX = 73;\n/** @type {import('react').CSSProperties} */\nconst CONTAINER_STYLE = {\n  minHeight: DIALOG_NAV_MIN_HEIGHT_PX\n};\n\nconst DialogNav = ({\n  pageTitle,\n  drawerVisible = false,\n  onHeight = Utils.EMPTY_FN\n}) => {\n  const goBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  /** @type {DivRefCallback} */\n  const divRefCb = useCallback(\n    el => {\n      // https://www.pluralsight.com/tech-blog/getting-size-and-position-of-an-element-in-react/\n      if (!el) return;\n      try {\n        onHeight(el.getBoundingClientRect().height);\n      } catch (e) {\n        console.log(`Error inside onHeight mechanism in DialogNav:`);\n        console.log(e);\n      }\n    },\n    [onHeight]\n  );\n\n  return (\n    <div\n      className=\"dialog-nav-container\"\n      ref={divRefCb}\n      style={CONTAINER_STYLE}\n    >\n      <div className=\"dialog-nav-back\" onClick={goBack}>\n        <i className=\"icon icon-thin-back\"></i>\n      </div>\n      <p className=\"dialog-nav-title\">{pageTitle}</p>\n      <div\n        className={classNames({\n          \"dialog-nav-menu-btn\": true,\n          \"dialog-nav-hidden\": !drawerVisible\n        })}\n      >\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n      </div>\n    </div>\n  );\n};\n\nexport default DialogNav;\n","import React, { useState, useCallback } from \"react\";\nimport { Controlled as ControlledZoom } from \"react-medium-image-zoom\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"react-medium-image-zoom/dist/styles.css\";\nimport \"./css/index.scoped.css\";\n\nconst IMAGE_TRANSITION_MS = 200;\n\nconst Image = ({\n  id = \"\",\n  item,\n  index = 0,\n  postId = \"\",\n  tipValue = 0,\n  tipCounter = 0,\n  hideRibbon = false,\n  width = null,\n  disableZoom = false,\n  style = /** @type {import('react').CSSProperties} */ ({})\n}) => {\n  const [zoomed, setZoomed] = useState(false);\n  const [zoomLoaded, setZoomLoaded] = useState(false);\n  const [previewVisible, setPreviewVisible] = useState(true);\n  const [animationTimer, setAnimationTimer] = useState(null);\n\n  const handleZoomChange = useCallback(\n    value => {\n      clearTimeout(animationTimer);\n      setZoomed(value);\n      if (!value && zoomLoaded) {\n        setZoomLoaded(false);\n        const timer = setTimeout(() => {\n          setPreviewVisible(true);\n        }, IMAGE_TRANSITION_MS);\n        setAnimationTimer(timer);\n      }\n\n      if (value) {\n        setPreviewVisible(false);\n      }\n    },\n    [\n      animationTimer,\n      zoomLoaded,\n      setZoomed,\n      setZoomLoaded,\n      setPreviewVisible,\n      setAnimationTimer\n    ]\n  );\n\n  const contentURL = decodeURIComponent(\n    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n  );\n  const mainImageStyle = { ...style, opacity: previewVisible ? 1 : 0 };\n  if (width) {\n    mainImageStyle.width = width;\n  }\n\n  const imgNode = (\n    <>\n      <img\n        className={`image torrent-img torrent-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-torrent={item.magnetURI}\n        data-file-key={index}\n        style={mainImageStyle}\n        src={contentURL}\n      />\n      <img\n        className={`image enlarged-img enlarged-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-file-key={index}\n        onLoad={() => {\n          setZoomLoaded(true);\n        }}\n        style={{\n          opacity: zoomed ? 1 : 0,\n          display: zoomed ? \"block\" : \"none\"\n        }}\n        src={contentURL}\n      />\n      {!hideRibbon && (\n        <TipRibbon\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          zoomed={zoomed}\n        />\n      )}\n    </>\n  );\n\n  return (\n    <div className=\"media-container\">\n      {disableZoom ? (\n        imgNode\n      ) : (\n        <ControlledZoom\n          isZoomed={zoomed}\n          onZoomChange={handleZoomChange}\n          overlayBgColorStart=\"#16191c00\"\n          overlayBgColorEnd=\"#16191c\"\n        >\n          {imgNode}\n        </ControlledZoom>\n      )}\n    </div>\n  );\n};\n\nexport default Image;\n","import React from \"react\";\nimport c from \"classnames\";\n\nimport DialogNav, { DIALOG_NAV_MIN_HEIGHT_PX } from \"../DialogNav\";\nimport Pad from \"../Pad\";\nimport * as gStyles from \"../../styles\";\n\nimport styles from \"./css/DarkPage.module.css\";\n\nexport interface DarkPageProps {\n  justify?: \"start\" | \"center\";\n  padding?: boolean;\n  pageTitle?: string;\n  scrolls?: boolean;\n}\n\nconst DarkPage: React.FC<DarkPageProps> = ({\n  children,\n  justify,\n  padding,\n  pageTitle,\n  scrolls\n}) => {\n  if (scrolls && !!justify) {\n    throw new Error(`Can not both set \"scrolls\" and \"justify\" at <DarkPage />`);\n  }\n  //#region controller\n  const [headerHeight, setHeaderHeight] = React.useState(\n    DIALOG_NAV_MIN_HEIGHT_PX\n  );\n  //#endregion controller\n\n  return (\n    <div\n      className={c(styles.container, {\n        [styles[\"container-scrolls\"]]: !!scrolls,\n        [gStyles.col]: !!justify,\n        [gStyles.centerJustify]: justify === \"center\",\n        [gStyles.commonPaddingH]: !!padding\n      })}\n    >\n      <DialogNav pageTitle={pageTitle || \"\"} onHeight={setHeaderHeight} />\n\n      <Pad amt={headerHeight} />\n\n      {children}\n    </div>\n  );\n};\n\nexport default DarkPage;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"DarkPage_container__1so-g\",\"container-scrolls\":\"DarkPage_container-scrolls__3t0tO\"};","import React from \"react\";\nimport { useParams } from \"react-router-dom\";\n\nimport * as Schema from \"../../schema\";\nimport * as Utils from \"../../utils\";\nimport * as Store from \"../../store\";\nimport DarkPage from \"../../common/DarkPage\";\nimport Pad from \"../../common/Pad\";\nimport Image from \"../../common/Post/components/Image\";\nimport ShockAvatar from \"../../common/ShockAvatar\";\nimport { rifle } from \"../../utils/WebSocket\";\nimport { subscribeUserProfile } from \"../../actions/UserProfilesActions\";\n\nimport \"./css/PublicContentItemPage.scoped.css\";\n\nexport interface PublicContentItemPageProps {\n  id: string;\n}\n\nconst PublicContentItemPage: React.FC<PublicContentItemPageProps> = () => {\n  const dispatch = Store.useDispatch();\n  const { id, publicKey } = useParams<{ id: string; publicKey: string }>();\n  const [item, setItem] = React.useState<Schema.PublicContentItem | null>(null);\n  const [error, setError] = React.useState<string>(\"\");\n\n  const author = Store.useSelector(Store.selectUser(publicKey));\n\n  React.useEffect(() => dispatch(subscribeUserProfile(publicKey)));\n\n  React.useEffect(() => {\n    if (error) {\n      return () => {};\n    }\n    const subscription = rifle({\n      query: `${publicKey}::publishedContentPublic>${id}::on`,\n      onError(e) {\n        setError(JSON.stringify(e, null, 4));\n      },\n      onData(data) {\n        if (Schema.isPublicContentItem(data)) {\n          setItem(data);\n        } else {\n          Utils.logger.warn(\n            `Invalid/incomplete public published content found for public key ...${publicKey.slice(\n              -8\n            )}, might be due to pending replication or was deleted if null: ${JSON.stringify(\n              data,\n              null,\n              4\n            )}`\n          );\n        }\n      }\n    });\n\n    return () => {\n      subscription.then(sub => sub.off());\n    };\n  }, [error, id, publicKey]);\n\n  const onRetry = React.useCallback(() => {\n    setError(\"\");\n  }, []);\n\n  if (error) {\n    return (\n      <DarkPage pageTitle=\"Error\" justify=\"center\">\n        <span>{error}</span>\n\n        <Pad amt={32} />\n\n        <button className=\"submit-btn retry-btn\" onClick={onRetry}>\n          Retry\n        </button>\n      </DarkPage>\n    );\n  }\n\n  if (!item) {\n    return <DarkPage pageTitle=\"Loading...\" />;\n  }\n\n  return (\n    <DarkPage scrolls>\n      <h1>{item.title}</h1>\n\n      {item.type === \"image/embedded\" && <Image item={item} />}\n\n      {item.type === \"video/embedded\" && null}\n\n      <div className=\"info\">\n        <div className=\"user-info\">\n          <ShockAvatar height={48} publicKey={publicKey} />\n\n          <Pad amt={12} insideRow />\n\n          <span>{author.displayName}</span>\n        </div>\n\n        <span>{Utils.formatTimestamp(item.timestamp)}</span>\n      </div>\n\n      <p className=\"description\">{item.description}</p>\n\n      <Pad amt={160} />\n    </DarkPage>\n  );\n};\n\nexport default PublicContentItemPage;\n"],"sourceRoot":""}