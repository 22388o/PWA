{"version":3,"sources":["common/Post/components/Image/index.js","common/Post/components/Video/index.js","images/share.svg","common/Post/index.tsx","utils/Cache.js","utils/Promise.js","utils/Torrents.js","common/Post/SharedPost.tsx"],"names":["Image","id","item","index","postId","tipValue","tipCounter","hideRibbon","width","disableZoom","style","useState","zoomed","setZoomed","zoomLoaded","setZoomLoaded","previewVisible","setPreviewVisible","animationTimer","setAnimationTimer","handleZoomChange","useCallback","value","clearTimeout","timer","setTimeout","contentURL","decodeURIComponent","magnetURI","replace","mainImageStyle","opacity","imgNode","className","alt","data-torrent","data-file-key","src","onLoad","display","isZoomed","onZoomChange","overlayBgColorStart","overlayBgColorEnd","Video","videoRef","useRef","playing","setPlaying","observe","useInView","trackVisibility","delay","onEnter","current","play","onLeave","pause","togglePlayingStatus","updatedPlaying","console","log","videoHeight","useMemo","CSS","supports","aspectRatio","height","onPause","readyState","ref","classNames","onClick","data-played","controls","muted","TipRibbon","Post","publicKey","openTipModal","openUnlockModal","openDeleteModal","undefined","openShareModal","_","dispatch","Store","unlockedContent","content","authenticated","auth","useEmblaCarousel","slidesToScroll","align","carouselRef","carouselAPI","author","post","React","tips","Object","values","length","sum","sliderLength","setSliderLength","activeSlide","setActiveSlide","isPrivate","setIsPrivate","isOnlineNode","useEffect","subPostContent","subPostTips","liveStatus","stream","contentItems","find","type","viewersCounter","getMediaContent","entries","filter","forEach","k","e","path","parseContent","key","text","finalMagnetURI","cached","Common","playbackMagnet","Stream","nextSlide","canScrollNext","scrollNext","prevSlide","canScrollPrev","scrollPrev","handleUserKeyDown","updateActiveSlide","selectedScrollSnap","on","scrollSnapList","window","addEventListener","removeEventListener","off","tipPost","targetType","postID","unlockPost","deletePost","shared","sharePost","url","location","host","navigator","share","displayName","clipboard","writeText","Tooltip","rebuild","ShockAvatar","Pad","amt","insideRow","to","live","waiting","wasLive","DateTime","fromMillis","date","toRelative","getTextContent","map","Array","from","scrollTo","data-tip","ShareIcon","color","marginLeft","getCachedFile","fileName","a","FileCache","_init","Promise","resolve","reject","init","then","persist","status","persistent","load","cachedFile","createURL","warn","renderCachedFile","fileURL","selector","elements","document","querySelectorAll","element","autoplay","saveFile","buffer","save","runSerial","tasks","result","task","supportedFileTypes","formats","options","_getFileType","reduce","supportedFormats","fileType","file","extension","name","split","slice","includes","supportedFileType","webTorrentClient","initializeClient","WebTorrent","default","showDynamicThumbnail","thumbnailFile","thumbnailFileType","thumbnailTarget","dynamicThumbnailTarget","querySelector","classList","add","remove","getCacheId","renderTorrent","torrentMode","torrent","target","torrentElements","torrentElement","contains","format","toLowerCase","endsWith","compatibleURL","setAttribute","renderTo","getThumbnailRenderer","thumbnailFileNames","getCacheFileName","thumbnails","sanitizedName","join","thumbnailName","thumbnailIndex","indexOf","cachedThumbnail","attachMedia","posts","all","supportedItems","get","files","match","renderThumbnail","destroy","getBlob","err","blob","dataset","played","getAttribute","torrentTasks","torrents","SharedPost","sharerPublicKey","Utils","sharerProfile","sharedPost","originalPost","originalAuthor","loadPostMedia","subscribeUserProfile","subSinglePost","useLayoutEffect","shareDate"],"mappings":"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","file":"static/js/28.1e899e25.chunk.js","sourcesContent":["import React, { useState, useCallback } from \"react\";\nimport { Controlled as ControlledZoom } from \"react-medium-image-zoom\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"react-medium-image-zoom/dist/styles.css\";\nimport \"./css/index.scoped.css\";\n\nconst IMAGE_TRANSITION_MS = 200;\n\nconst Image = ({\n  id = \"\",\n  item,\n  index = 0,\n  postId = \"\",\n  tipValue = 0,\n  tipCounter = 0,\n  hideRibbon = false,\n  width = null,\n  disableZoom = false,\n  style = /** @type {import('react').CSSProperties} */ ({})\n}) => {\n  const [zoomed, setZoomed] = useState(false);\n  const [zoomLoaded, setZoomLoaded] = useState(false);\n  const [previewVisible, setPreviewVisible] = useState(true);\n  const [animationTimer, setAnimationTimer] = useState(null);\n\n  const handleZoomChange = useCallback(\n    value => {\n      clearTimeout(animationTimer);\n      setZoomed(value);\n      if (!value && zoomLoaded) {\n        setZoomLoaded(false);\n        const timer = setTimeout(() => {\n          setPreviewVisible(true);\n        }, IMAGE_TRANSITION_MS);\n        setAnimationTimer(timer);\n      }\n\n      if (value) {\n        setPreviewVisible(false);\n      }\n    },\n    [\n      animationTimer,\n      zoomLoaded,\n      setZoomed,\n      setZoomLoaded,\n      setPreviewVisible,\n      setAnimationTimer\n    ]\n  );\n\n  const contentURL = decodeURIComponent(\n    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n  );\n  const mainImageStyle = { ...style, opacity: previewVisible ? 1 : 0 };\n  if (width) {\n    mainImageStyle.width = width;\n  }\n\n  const imgNode = (\n    <>\n      <img\n        className={`image torrent-img torrent-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-torrent={item.magnetURI}\n        data-file-key={index}\n        style={mainImageStyle}\n        src={contentURL}\n      />\n      <img\n        className={`image enlarged-img enlarged-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-file-key={index}\n        onLoad={() => {\n          setZoomLoaded(true);\n        }}\n        style={{\n          opacity: zoomed ? 1 : 0,\n          display: zoomed ? \"block\" : \"none\"\n        }}\n        src={contentURL}\n      />\n      {!hideRibbon && (\n        <TipRibbon\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          zoomed={zoomed}\n        />\n      )}\n    </>\n  );\n\n  return (\n    <div className=\"media-container\">\n      {disableZoom ? (\n        imgNode\n      ) : (\n        <ControlledZoom\n          isZoomed={zoomed}\n          onZoomChange={handleZoomChange}\n          overlayBgColorStart=\"#16191c00\"\n          overlayBgColorEnd=\"#16191c\"\n        >\n          {imgNode}\n        </ControlledZoom>\n      )}\n    </div>\n  );\n};\n\nexport default Image;\n","import classNames from \"classnames\";\nimport { useCallback, useMemo, useRef, useState } from \"react\";\nimport useInView from \"react-cool-inview\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"./css/index.scoped.css\";\n\nconst Video = ({\n  id = \"\",\n  item,\n  index = 0,\n  postId = \"\",\n  tipValue = 0,\n  tipCounter = 0,\n  hideRibbon = false\n}) => {\n  const videoRef = useRef(null);\n  const [playing, setPlaying] = useState(false);\n  const { observe } = useInView({\n    trackVisibility: false,\n    delay: 100,\n    onEnter: () => {\n      if (videoRef.current) {\n        setPlaying(true);\n        videoRef.current.play();\n      }\n    },\n    onLeave: () => {\n      if (!videoRef.current) {\n        return;\n      }\n\n      setPlaying(false);\n      videoRef.current.pause();\n    }\n  });\n\n  const togglePlayingStatus = useCallback(() => {\n    const updatedPlaying = !playing;\n    setPlaying(updatedPlaying);\n    if (videoRef.current) {\n      if (!updatedPlaying) {\n        videoRef.current.pause();\n        return;\n      }\n\n      console.log(\"Playing video\", updatedPlaying);\n      videoRef.current.play();\n    }\n  }, [playing]);\n\n  const videoHeight = useMemo(() => {\n    if (CSS.supports(\"aspect-ratio: 16 / 9\")) {\n      return {\n        aspectRatio: \"16 / 9\"\n      };\n    }\n\n    return {\n      height: 400\n    };\n  }, []);\n\n  const onPause = useCallback(() => {\n    if (videoRef.current?.readyState === 4) {\n      setPlaying(false);\n    }\n  }, [videoRef]);\n\n  return (\n    <div className=\"media-container\" ref={observe}>\n      <div className=\"video-container\" style={videoHeight}>\n        <div\n          className={classNames({\n            \"thumbnail-container\": true,\n            \"video-hidden\": playing\n          })}\n          onClick={togglePlayingStatus}\n        >\n          <div className=\"play-btn\">\n            <i className=\"fas fa-play\" />\n          </div>\n          <img\n            className=\"video-thumbnail hidden\"\n            data-torrent={item.magnetURI}\n            data-file-key={index}\n            alt=\"Video thumbnail\"\n          />\n          <video\n            className=\"dynamic-thumbnail hidden\"\n            data-torrent={item.magnetURI}\n            data-file-key={index}\n            data-played=\"false\"\n            controls={false}\n            muted\n          />\n        </div>\n        <video\n          className={classNames({\n            \"torrent-video video-js vjs-default-skin\": true,\n            \"video-hidden\": !playing\n          })}\n          data-torrent={item.magnetURI}\n          data-file-key={index}\n          data-played=\"false\"\n          controls\n          ref={videoRef}\n          muted\n          onPause={onPause}\n        />\n        <TipRibbon tipCounter={tipCounter} tipValue={tipValue} />\n      </div>\n    </div>\n  );\n};\n\nexport default Video;\n","export default __webpack_public_path__ + \"static/media/share.8ed36b2d.svg\";","import React, { useEffect, useState, useCallback } from \"react\";\nimport * as Common from \"shock-common\";\nimport { Link } from \"react-router-dom\";\nimport { useEmblaCarousel } from \"embla-carousel/react\";\nimport Tooltip from \"react-tooltip\";\nimport classNames from \"classnames\";\nimport sum from \"lodash/sum\";\nimport { DateTime } from \"luxon\";\n\nimport * as Store from \"../../store\";\nimport ShockAvatar from \"../ShockAvatar\";\nimport Pad from \"../Pad\";\nimport { subPostContent, subPostTips } from \"../../actions/FeedActions\";\n\nimport Video from \"./components/Video\";\nimport Image from \"./components/Image\";\nimport Stream from \"./components/Stream\";\nimport \"./css/index.scoped.css\";\n\nimport ShareIcon from \"../../images/share.svg\";\n\nconst Post = ({\n  id,\n  publicKey,\n  openTipModal,\n  openUnlockModal,\n  openDeleteModal = undefined,\n  openShareModal = _ => {}\n}) => {\n  const dispatch = Store.useDispatch();\n  const unlockedContent = Store.useSelector(\n    ({ content }) => content.unlockedContent\n  );\n  const authenticated = Store.useSelector(({ auth }) => auth.authenticated);\n  const [carouselRef, carouselAPI] = useEmblaCarousel({\n    slidesToScroll: 1,\n    align: \"center\"\n  });\n  const author = Store.useSelector(Store.selectUser(publicKey));\n  const post = Store.useSelector(Store.selectSinglePost(publicKey, id));\n  const [tipCounter, tipValue] = React.useMemo(() => {\n    const tips = Object.values(\n      post.tips ||\n        {} /* cached data from previous app version won't have the tips object */\n    );\n\n    return [tips.length, sum(tips)];\n  }, [post]);\n\n  const [sliderLength, setSliderLength] = useState(0);\n  const [activeSlide, setActiveSlide] = useState(0);\n  const [isPrivate, setIsPrivate] = useState(false);\n\n  const isOnlineNode = /*Utils.isOnline(\n    Store.useSelector(Store.selectUser(publicKey)).lastSeenApp\n  );*/ true;\n\n  useEffect(() => {\n    const subscription = dispatch(subPostContent(publicKey, id));\n    return subscription;\n  }, [dispatch, id, publicKey]);\n\n  useEffect(() => {\n    const subscription = dispatch(subPostTips(publicKey, id));\n    return subscription;\n  }, [dispatch, id, publicKey]);\n\n  const liveStatus = React.useMemo<Common.LiveStatus | null>(() => {\n    const stream = Object.values(post.contentItems ?? {}).find(\n      item => item.type === \"stream/embedded\"\n    ) as Common.EmbeddedStream;\n\n    if (stream) {\n      return stream.liveStatus;\n    }\n\n    return null;\n  }, [post.contentItems]);\n\n  const viewersCounter = React.useMemo<number | null>(() => {\n    const stream = Object.values(post.contentItems ?? {}).find(\n      item => item.type === \"stream/embedded\"\n    ) as Common.EmbeddedStream;\n\n    if (stream && stream.liveStatus === \"live\") {\n      return stream.viewersCounter;\n    }\n\n    return null;\n  }, [post.contentItems]);\n\n  const getMediaContent = useCallback(() => {\n    return Object.entries(post.contentItems ?? {}).filter(\n      ([_, item]) => item.type !== \"text/paragraph\"\n    );\n  }, [post.contentItems]);\n\n  const getTextContent = () => {\n    return Object.entries(post.contentItems ?? {}).filter(\n      ([_, item]) => item.type === \"text/paragraph\"\n    );\n  };\n\n  useEffect(() => {\n    getMediaContent().forEach(([k, e]) => {\n      const path = `${publicKey}>posts>${k}`;\n      // @ts-expect-error\n      if (e.isPrivate && !unlockedContent[path]) {\n        setIsPrivate(true);\n      }\n    });\n  }, [getMediaContent, publicKey, unlockedContent]);\n\n  const parseContent = ([key, item]: [string, Common.ContentItem], index) => {\n    if (item.type === \"text/paragraph\") {\n      return <p key={key}>{item.text}</p>;\n    }\n\n    let finalMagnetURI = \"\";\n    if (item.isPrivate) {\n      const path = `${publicKey}>posts>${id}`;\n      const cached = unlockedContent[path];\n      if (cached) {\n        finalMagnetURI = cached;\n      } else {\n        return (\n          <div key={key}>\n            <i className=\"fas fa-lock fa-10x\"></i>\n          </div>\n        );\n      }\n    }\n\n    if (item.type === \"image/embedded\") {\n      return (\n        <Image\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n          hideRibbon={undefined}\n          width={undefined}\n        />\n      );\n    }\n\n    if (item.type === \"video/embedded\") {\n      return (\n        <Video\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n        />\n      );\n    }\n    if (Common.isEmbeddedStream(item)) {\n      if (item.playbackMagnet) {\n        return (\n          <Video\n            id={key}\n            item={{\n              ...item,\n              magnetURI: item.playbackMagnet\n            }}\n            index={index}\n            postId={id}\n            tipCounter={tipCounter}\n            tipValue={tipValue}\n            key={`${id}-${index}`}\n          />\n        );\n      }\n      return (\n        <Stream\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n          hideRibbon={undefined}\n          width={undefined}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  const nextSlide = useCallback(() => {\n    if (!carouselAPI) return;\n\n    if (carouselAPI.canScrollNext()) {\n      carouselAPI.scrollNext();\n    }\n  }, [carouselAPI]);\n\n  const prevSlide = useCallback(() => {\n    if (!carouselAPI) return;\n\n    if (carouselAPI.canScrollPrev()) {\n      carouselAPI.scrollPrev();\n    }\n  }, [carouselAPI]);\n\n  const handleUserKeyDown = useCallback(\n    e => {\n      if (sliderLength === 0) return;\n      const { key } = e;\n\n      if (key === \"ArrowRight\") {\n        nextSlide();\n      }\n\n      if (key === \"ArrowLeft\") {\n        prevSlide();\n      }\n    },\n    [sliderLength, prevSlide, nextSlide]\n  );\n\n  const updateActiveSlide = useCallback(() => {\n    setActiveSlide(carouselAPI.selectedScrollSnap());\n  }, [carouselAPI, setActiveSlide]);\n\n  useEffect(() => {\n    if (!carouselAPI) return;\n\n    carouselAPI.on(\"scroll\", updateActiveSlide);\n    setSliderLength(carouselAPI.scrollSnapList().length);\n    window.addEventListener(\"keydown\", handleUserKeyDown);\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleUserKeyDown);\n      carouselAPI.off(\"scroll\", updateActiveSlide);\n    };\n  }, [carouselAPI, sliderLength, handleUserKeyDown, updateActiveSlide]);\n\n  const tipPost = useCallback(() => {\n    if (!isOnlineNode) {\n      return;\n    }\n\n    openTipModal({\n      targetType: \"post\",\n      postID: id,\n      publicKey\n    });\n  }, [id, isOnlineNode, openTipModal, publicKey]);\n\n  const unlockPost = useCallback(() => {\n    if (!isOnlineNode) {\n      return;\n    }\n\n    openUnlockModal({\n      targetType: \"unlock\",\n      postID: id,\n      publicKey\n    });\n  }, [id, isOnlineNode, openUnlockModal, publicKey]);\n\n  const deletePost = useCallback(() => {\n    openDeleteModal({ id, shared: false });\n  }, [id, openDeleteModal]);\n\n  const sharePost = useCallback(() => {\n    if (!authenticated) {\n      const url = `https://${window.location.host}/${publicKey}/post/${id}`;\n\n      if (navigator.share) {\n        navigator.share({\n          text: `Check out ${author.displayName}'s post on Lightning.Page!`,\n          url\n        });\n        return;\n      }\n\n      navigator.clipboard.writeText(url);\n      return;\n    }\n\n    openShareModal({\n      targetType: \"share\",\n      postID: id,\n      publicKey\n    });\n  }, [publicKey, id, openShareModal]);\n\n  useEffect(() => {\n    try {\n      Tooltip.rebuild();\n    } catch (e) {\n      console.log(`Error inside <Post />: `, e);\n    }\n  }, []);\n\n  const readableLiveStatus: Record<Common.LiveStatus, string> = {\n    live: \"Is Live\",\n    waiting: \"Waiting\",\n    wasLive: \"Was Live\"\n  };\n\n  return (\n    <div className=\"post\">\n      <div className=\"head\">\n        <div className=\"user\">\n          <ShockAvatar height={50} publicKey={publicKey} />\n\n          <Pad amt={10} insideRow />\n\n          <div className=\"details\">\n            <div className=\"username\">\n              <Link to={`/otherUser/${publicKey}`}>{author.displayName}</Link>\n              {liveStatus && (\n                <p className=\"liveStatus\">\n                  {readableLiveStatus[liveStatus]}\n                  <i\n                    className={`fas fa-circle liveStatusIcon ${\n                      liveStatus === \"live\" ? \"liveIcon\" : \"\"\n                    }`}\n                  ></i>\n                  {liveStatus === \"live\" && (\n                    <span> | {viewersCounter} watching</span>\n                  )}\n                </p>\n              )}\n            </div>\n            <p>{DateTime.fromMillis(post.date).toRelative()}</p>\n          </div>\n        </div>\n        {openDeleteModal && (\n          <i className=\"fas fa-trash trash-icon\" onClick={deletePost}></i>\n        )}\n      </div>\n\n      <div className=\"content\">\n        {getTextContent().map(parseContent)}\n        <div className=\"media-content-carousel\">\n          {sliderLength > 1 ? (\n            <div className=\"media-carousel-controls-container\">\n              <div\n                className=\"media-carousel-arrow fas fa-angle-left\"\n                onClick={prevSlide}\n              ></div>\n              <div className=\"media-carousel-pages\">\n                {Array.from({ length: sliderLength }).map((_, key) => (\n                  <div\n                    // TODO: Get the actual ID here. However posts can't be\n                    // edited so index is stable.\n                    key={key}\n                    className={classNames({\n                      \"media-carousel-page\": true,\n                      \"active-carousel-page\": activeSlide === key\n                    })}\n                    onClick={() => carouselAPI?.scrollTo(key)}\n                  ></div>\n                ))}\n              </div>\n              <div\n                className=\"media-carousel-arrow fas fa-angle-right\"\n                onClick={nextSlide}\n              ></div>\n            </div>\n          ) : null}\n          <div className=\"media-content-root\" ref={carouselRef}>\n            <div className=\"media-content-container\">\n              {getMediaContent().map(parseContent)}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions\">\n        <div></div>\n        <div\n          className=\"icon-tip-btn\"\n          data-tip={isPrivate ? \"Unlock this post\" : \"Tip this post\"}\n          onClick={isPrivate ? unlockPost : tipPost}\n        >\n          <div className=\"tip-icon icon-thin-feed\"></div>\n        </div>\n        {openShareModal && (\n          <div className=\"icon-tip-btn\" data-tip=\"share\" onClick={sharePost}>\n            <img\n              alt=\"Share this post\"\n              src={ShareIcon}\n              style={{ color: \"#4285b9\", marginLeft: \"auto\" }}\n            />\n          </div>\n        )}\n        {!openShareModal && <div></div>}\n      </div>\n    </div>\n  );\n};\n\nexport default Post;\n","import FileCache from \"browser-file-storage\";\n\nexport const DB_NAME = \"ShockWalletStore\";\n\nexport const init = () =>\n  new Promise((resolve, reject) => {\n    FileCache.init(DB_NAME)\n      .then(() => {\n        console.log(\"File cache initialized!\");\n        return FileCache.persist();\n      })\n      .then(status => {\n        if (status.persistent) {\n          resolve(status);\n        } else {\n          reject(status);\n        }\n      });\n  });\n\nexport const getCachedFile = async fileName => {\n  try {\n    if (!FileCache._init) {\n      await init();\n    }\n\n    const cachedFile = await FileCache.load(fileName);\n    return cachedFile.createURL();\n  } catch (err) {\n    console.warn(err);\n    return false;\n  }\n};\n\nexport const renderCachedFile = (fileURL, selector) => {\n  const elements = document.querySelectorAll(selector);\n  if (elements && elements.length) {\n    elements.forEach(element => {\n      if (!element.src) {\n        element.src = fileURL;\n        element.muted = true;\n        element.autoplay = false;\n      }\n    });\n  }\n  return !!elements?.length;\n};\n\nexport const saveFile = (fileName, buffer) => {\n  return FileCache.save(fileName, buffer);\n};\n","export const runSerial = tasks => {\n  let result = Promise.resolve();\n  tasks.forEach(task => {\n    result = result.then(() => task());\n  });\n  return result;\n};\n","import { getCachedFile, renderCachedFile, saveFile } from \"./Cache\";\nimport { runSerial } from \"./Promise\";\n\nexport const supportedFileTypes = {\n  \"video/embedded\": {\n    formats: [\"mp4\", \"webm\"],\n    element: \"video\",\n    options: {\n      autoplay: false,\n      muted: true\n    }\n  },\n  \"image/embedded\": {\n    formats: [\"jpg\", \"png\", \"webp\", \"jpeg\"],\n    element: \"img\",\n    options: {}\n  }\n};\n\nexport const supportedFormats = Object.values(supportedFileTypes).reduce(\n  (supportedFormats, fileType) => [...supportedFormats, ...fileType.formats],\n  []\n);\n\nconst _getFileType = file => {\n  if (!file) {\n    return null;\n  }\n\n  const extension = file.name?.split(\".\")?.slice(-1)[0];\n  const [supportedFileType] = Object.entries(supportedFileTypes).filter(\n    ([type, options]) => options.formats.includes(extension)\n  );\n\n  if (supportedFileType) {\n    const [name, fileType] = supportedFileType;\n    return {\n      name,\n      ...fileType\n    };\n  }\n\n  return null;\n};\n\nexport let webTorrentClient = null;\n\nexport const initializeClient = async () => {\n  if (!webTorrentClient) {\n    const WebTorrent = await import(\"webtorrent\");\n    webTorrentClient = new WebTorrent.default();\n  }\n\n  return webTorrentClient;\n};\n\nconst showDynamicThumbnail = ({ thumbnailFile, fileType, item }) => {\n  const thumbnailFileType = _getFileType(thumbnailFile);\n  const thumbnailTarget = `${\n    thumbnailFileType?.element ?? \"img\"\n  }[data-torrent=\"${item.magnetURI}\"]`;\n  const dynamicThumbnailTarget = `.dynamic-thumbnail[data-torrent=\"${item.magnetURI}\"]`;\n\n  if (!thumbnailFile && fileType.element === \"video\") {\n    document.querySelector(thumbnailTarget)?.classList.add(\"hidden\");\n    document.querySelector(dynamicThumbnailTarget)?.classList.remove(\"hidden\");\n  }\n};\n\nconst getCacheId =\n  ({ id, key }) =>\n  file =>\n    `${id}-${key}-${file.name}`;\n\nconst renderTorrent = ({ file, type, torrentMode, torrent }) => {\n  const element = type.element;\n  const target = `${element}[data-torrent=\"${torrent.magnetURI}\"]`;\n  const torrentElements = document.querySelectorAll(target);\n  console.log(\"Torrent Elements:\", torrentElements);\n  torrentElements.forEach(torrentElement => {\n    // Don't render hidden videos\n    if (torrentElement.classList.contains(\"hidden\")) {\n      return;\n    }\n    const contentURL = decodeURIComponent(\n      torrent.magnetURI.replace(/.*(ws=)/gi, \"\")\n    );\n    const [compatibleURL] = type.formats.filter(format =>\n      contentURL.toLowerCase().endsWith(`.${format.toLowerCase()}`)\n    );\n\n    if (torrentMode || !compatibleURL) {\n      file.renderTo(torrentElement, type.options);\n      return;\n    }\n\n    torrentElement.setAttribute(\"src\", contentURL);\n  });\n};\n\nexport const isURLCompatible = ({ url, type = \"video/embedded\" }) => {\n  const fileType = supportedFileTypes[type];\n  const [compatibleURL] = fileType.formats.filter(format =>\n    url.toLowerCase().endsWith(`.${format.toLowerCase()}`)\n  );\n\n  return !!compatibleURL;\n};\n\nconst getThumbnailRenderer =\n  ({ thumbnailFileNames, getCacheFileName, torrentMode }) =>\n  async ({ fileName, thumbnails, item, fileType }) => {\n    const sanitizedName = fileName.split(\".\").slice(0, -1).join(\".\");\n    const thumbnailName = `${sanitizedName}-thumb`;\n    const thumbnailIndex = thumbnailFileNames.indexOf(thumbnailName);\n    const thumbnailFile = thumbnails[thumbnailIndex];\n    const thumbnailFileType = thumbnailFile\n      ? _getFileType(thumbnailFile)\n      : null;\n    const thumbnailTarget = `${\n      thumbnailFileType?.element ?? \"img\"\n    }[data-torrent=\"${item.magnetURI}\"]`;\n\n    if (fileType.element === \"video\" && thumbnailFile) {\n      const cachedThumbnail = await getCachedFile(\n        getCacheFileName(thumbnailFile)\n      );\n\n      document.querySelector(thumbnailTarget)?.classList.remove(\"hidden\");\n\n      if (cachedThumbnail) {\n        renderCachedFile(cachedThumbnail, thumbnailTarget);\n        return;\n      }\n\n      renderTorrent({\n        file: thumbnailFile,\n        type: thumbnailFileType,\n        torrentMode,\n        torrent: item\n      });\n\n      return;\n    }\n\n    if (fileType.element === \"video\" && !thumbnailFile) {\n      showDynamicThumbnail({\n        thumbnailFile,\n        fileType,\n        item\n      });\n\n      return;\n    }\n\n    return {\n      thumbnailFile\n    };\n  };\n\nexport const attachMedia = async (posts = [], torrentMode = true) => {\n  const torrentTasks = await Promise.all(\n    posts.map(async post => {\n      const { contentItems, id } = post;\n      const supportedItems = Object.entries(contentItems).filter(\n        ([, item]) => supportedFileTypes[item.type]\n      );\n\n      if (!supportedItems) {\n        return [];\n      }\n\n      const webTorrentClient = await initializeClient();\n\n      return supportedItems.map(\n        ([key, item]) =>\n          () =>\n            new Promise(resolve => {\n              const getCacheFileName = getCacheId({ id, key });\n              const torrentExists = webTorrentClient.get(item.magnetURI);\n\n              if (torrentExists) {\n                resolve(true);\n                return;\n              }\n\n              webTorrentClient.add(item.magnetURI, async torrent => {\n                // Proceed to the next torrent in queue\n                resolve(true);\n\n                const files = torrent.files.filter(file => {\n                  const extension = file.name?.split(\".\")?.slice(-1)[0];\n                  const supportedFileType = Object.values(\n                    supportedFileTypes\n                  ).filter(options => options.formats.includes(extension))[0];\n                  if (supportedFileType) {\n                    const fileType = supportedFileType;\n                    const matched = fileType.formats.includes(extension);\n                    return matched;\n                  }\n                  return false;\n                });\n\n                const thumbnails = files.filter(file =>\n                  file.name.match(/-thumb\\.([\\w\\d]){2,4}$/gi)\n                );\n                const thumbnailFileNames = thumbnails.map(file =>\n                  file.name.replace(/\\.([\\w\\d]){2,4}$/gi, \"\")\n                );\n                const renderThumbnail = getThumbnailRenderer({\n                  getCacheFileName,\n                  thumbnailFileNames,\n                  torrentMode\n                });\n\n                files.map(async file => {\n                  // Skip thumbnails\n                  if (thumbnailFileNames.includes(file.name)) {\n                    return;\n                  }\n\n                  const fileType = _getFileType(file);\n\n                  if (!fileType) {\n                    return;\n                  }\n\n                  const fileName = getCacheFileName(file);\n\n                  const element = fileType.element;\n                  const target = `${element}[data-torrent=\"${item.magnetURI}\"]`;\n                  const cachedFile = await getCachedFile(fileName);\n\n                  renderThumbnail({\n                    fileName: file.name,\n                    thumbnails,\n                    fileType,\n                    item\n                  });\n\n                  if (cachedFile) {\n                    const torrent = webTorrentClient.get(item.magnetURI);\n\n                    if (torrent) {\n                      torrent.destroy();\n                    }\n\n                    renderCachedFile(cachedFile, target);\n                    return;\n                  }\n\n                  renderTorrent({\n                    file,\n                    type: fileType,\n                    torrentMode,\n                    torrent: item\n                  });\n                });\n\n                torrent.on(\"done\", () => {\n                  files.map(file => {\n                    const fileType = _getFileType(file);\n                    const fileName = getCacheFileName(file);\n                    const element = fileType.element;\n                    const target = `${element}.torrent-video[data-torrent=\"${item.magnetURI}\"]`;\n\n                    file.getBlob(async (err, blob) => {\n                      if (err) {\n                        console.warn(err);\n                        return;\n                      }\n\n                      console.log(\"Caching loaded file...\", fileName, blob);\n                      await saveFile(fileName, blob);\n                      const element = document.querySelector(target);\n                      if (\n                        element?.dataset.played === \"false\" &&\n                        !element?.getAttribute(\"src\")\n                      ) {\n                        const cachedFile = await getCachedFile(fileName);\n                        renderCachedFile(cachedFile, target);\n                      }\n                    });\n                  });\n                });\n              });\n            })\n      );\n    })\n  );\n  const contentItems = torrentTasks.reduce(\n    (torrents, contentItems) => [...torrents, ...contentItems],\n    []\n  );\n\n  runSerial(contentItems);\n};\n","import React, { useCallback, useLayoutEffect } from \"react\";\nimport { DateTime } from \"luxon\";\nimport Tooltip from \"react-tooltip\";\n\nimport Post from \".\";\n\nimport * as Store from \"../../store\";\nimport * as Utils from \"../../utils\";\nimport Loader from \"../Loader\";\nimport ShockAvatar from \"../ShockAvatar\";\nimport Pad from \"../Pad\";\nimport { attachMedia } from \"../../utils/Torrents\";\nimport { subPostContent, subSinglePost } from \"../../actions/FeedActions\";\nimport { subscribeUserProfile } from \"../../actions/UserProfilesActions\";\nimport \"../Post/css/index.scoped.css\";\n\nexport interface SharedPostProps {\n  postID: string;\n  sharerPublicKey: string;\n  openTipModal?(tipData: any): void;\n  openUnlockModal?(unlockData: any): void;\n  openDeleteModal?(params: { id: string; shared: boolean }): void;\n  openShareModal?(shareData: any): void;\n}\n\nconst SharedPost = ({\n  postID,\n  sharerPublicKey,\n  openTipModal,\n  openUnlockModal,\n  openDeleteModal = Utils.EMPTY_FN,\n  openShareModal = Utils.EMPTY_FN\n}: SharedPostProps) => {\n  const dispatch = Store.useDispatch();\n\n  const sharerProfile = Store.useSelector(Store.selectUser(sharerPublicKey));\n  const sharedPost = Store.useSelector(\n    Store.selectSharedPost(sharerPublicKey, postID)\n  );\n  const originalPost = Store.useSelector(\n    Store.selectSinglePost(sharedPost.originalAuthor, postID)\n  );\n\n  const loadPostMedia = useCallback(async () => {\n    if (originalPost) {\n      attachMedia([originalPost], false);\n    }\n  }, [originalPost]);\n  const deletePost = useCallback(() => {\n    openDeleteModal({ id: originalPost.id, shared: true });\n  }, [originalPost, openDeleteModal]);\n\n  React.useEffect(\n    () => dispatch(subscribeUserProfile(sharedPost.originalAuthor)),\n    [dispatch, sharedPost.originalAuthor]\n  );\n\n  React.useEffect(() => dispatch(subscribeUserProfile(sharerPublicKey)), [\n    dispatch,\n    sharerPublicKey\n  ]);\n\n  React.useEffect(\n    () => dispatch(subSinglePost(sharedPost.originalAuthor, postID)),\n    [dispatch, postID, sharedPost.originalAuthor]\n  );\n\n  React.useEffect(\n    () => dispatch(subPostContent(sharedPost.originalAuthor, postID)),\n    [dispatch, postID, sharedPost.originalAuthor]\n  );\n\n  useLayoutEffect(() => {\n    Tooltip.rebuild();\n    loadPostMedia();\n  }, [loadPostMedia]);\n\n  return (\n    <div className=\"post shared-post\">\n      <div className=\"head\">\n        <div className=\"user\">\n          <ShockAvatar height={50} publicKey={sharerPublicKey} />\n\n          <Pad amt={10} insideRow />\n\n          <div className=\"details\">\n            <p>{sharerProfile?.displayName}</p>\n            <p>\n              {/* @ts-ignore */}\n              Shared {DateTime.fromMillis(sharedPost.shareDate).toRelative()}\n            </p>\n          </div>\n        </div>\n        {openDeleteModal && (\n          <i className=\"fas fa-trash\" onClick={deletePost}></i>\n        )}\n      </div>\n\n      <div className=\"shared-content\">\n        {originalPost ? (\n          <Post\n            id={originalPost.id}\n            publicKey={sharedPost.originalAuthor}\n            openTipModal={openTipModal}\n            openUnlockModal={openUnlockModal}\n            openShareModal={openShareModal}\n          />\n        ) : (\n          <Loader text=\"Loading Post...\" />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SharedPost;\n"],"sourceRoot":""}