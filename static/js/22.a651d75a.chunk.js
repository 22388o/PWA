(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[22],{482:function(e,t,n){"use strict";var a=n(3),c=n(73),r=n.n(c),s=(n(484),n(7)),o=function(e){var t=e.children,n=e.style;return Object(s.jsx)("div",{className:"modal-content",style:n,children:t})},i=(n(485),function(e){var t=e.title,n=e.toggleModal;return t?Object(s.jsxs)("div",{className:"modal-head",children:[Object(s.jsx)("p",{className:"modal-head-title",children:t}),Object(s.jsx)("div",{className:"modal-head-close",onClick:n,children:Object(s.jsx)("i",{className:"fas fa-times"})})]}):null});n(486),t.a=function(e){var t=e.modalOpen,n=void 0!==t&&t,c=e.toggleModal,l=e.modalTitle,u=void 0===l?"":l,d=e.children,b=e.contentStyle,j=void 0===b?{}:b,p=Object(a.useCallback)((function(){c()}),[c]);return Object(s.jsxs)("div",{className:r()({modal:!0,"modal-open":n}),children:[Object(s.jsx)("div",{className:"modal-backdrop",onClick:p}),Object(s.jsxs)("div",{className:"modal-container",children:[Object(s.jsx)(i,{title:u,toggleModal:p}),Object(s.jsx)(o,{style:j,children:d})]})]})}},484:function(e,t,n){},485:function(e,t,n){},486:function(e,t,n){},488:function(e,t,n){"use strict";var a=n(3),c=n(73),r=n.n(c),s=(n(489),n(7));t.a=function(e){var t=e.pageTitle,n=e.drawerVisible,c=Object(a.useCallback)((function(){window.history.back()}),[]);return Object(s.jsxs)("div",{className:"dialog-nav-container",children:[Object(s.jsx)("div",{className:"dialog-nav-back",onClick:c,children:Object(s.jsx)("i",{className:"icon icon-thin-back"})}),Object(s.jsx)("p",{className:"dialog-nav-title",children:t}),Object(s.jsxs)("div",{className:r()({"dialog-nav-menu-btn":!0,"dialog-nav-hidden":!n}),children:[Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"})]})]})}},489:function(e,t,n){},502:function(e,t,n){},569:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),c=n(2),r=n.n(c),s=n(5),o=n(14),i=function(){var e=Object(s.a)(r.a.mark((function e(t,n){var a,c,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Uint8Array(32),window.crypto.getRandomValues(a),c=Array.prototype.map.call(a,(function(e){return("00"+e.toString(16)).slice(-2)})).join(""),s={seed_token:n,wallet_token:c},e.next=6,fetch("".concat(t,"/api/enroll_token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 6:if(200===e.sent.status){e.next=9;break}throw new Error("torrentSeed service currently not available");case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=Object(s.a)(r.a.mark((function e(t){var n,c,s,l,u,d,b,j,p,f,m,h,v,O,x;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.availableTokens,c=t.seedUrl,s=t.seedToken,l=t.seedProviderPub,u=t.serviceID,d=t.servicePrice,b=null,j=!1,p=null,e.t0=r.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=14;break}if(f=e.t1.value,!Object.prototype.hasOwnProperty.call(n,f)){e.next=12;break}if(!(m=n[f])[0]){e.next=12;break}return p={seedUrl:f,tokens:m},e.abrupt("break",14);case 12:e.next=5;break;case 14:if(console.log(l),console.log(u),console.log(d),!c||!s){e.next=27;break}return console.log("USING SELF SEED TOKEN"),e.next=21,i(c,s);case 21:h=e.sent,console.log("token"),console.log(h),b={seedUrl:c,tokens:[h]},e.next=48;break;case 27:if(!p){e.next=33;break}console.log("USING AVAILABLE TOKEN"),b=p,j=!0,e.next=48;break;case 33:if(!(l&&u&&d)){e.next=47;break}return console.log("USING DEFAULT TOKEN PROVIDER"),e.next=37,o.a.post("/api/lnd/unifiedTrx",{type:"service",amt:d,to:l,memo:"",feeLimit:500,ackInfo:u});case 37:if(v=e.sent,O=v.data,200===v.status){e.next=42;break}throw new Error("seed token request failed");case 42:console.log(O),x=O.orderAck,b=JSON.parse(x.response),e.next=48;break;case 47:throw new Error("provide the token data or use default seed provider");case 48:return e.abrupt("return",Object(a.a)(Object(a.a)({},b),{},{deleteToken:j}));case 49:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},748:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n.n(a),r=n(5),s=n(17),o=n(3),i=n(37),l=(n(502),n(150)),u=n(488),d=n(14),b=n(41),j=n(569),p=n(21),f=n(20),m=n(482),h=n(7);t.default=function(){var e=Object(i.c)(),t=Object(p.g)(),n=f.useSelector((function(e){return e.content.seedProviderPub})),a=f.useSelector((function(e){return e.content.seedInfo})),v=a.seedUrl,O=a.seedToken,x=f.useSelector((function(e){return e.content.availableTokens})),g=f.useSelector((function(e){return e.userProfiles})),k=Object(o.useState)(null),y=Object(s.a)(k,2),w=y[0],N=y[1],S=Object(o.useState)(!1),C=Object(s.a)(S,2),P=C[0],T=C[1],I=Object(o.useState)([]),D=Object(s.a)(I,2),E=D[0],U=D[1],A=Object(o.useState)(""),L=Object(s.a)(A,2),R=L[0],F=L[1],M=Object(o.useState)(""),V=Object(s.a)(M,2),B=V[0],J=V[1],W=Object(o.useState)("public"),_=Object(s.a)(W,2),G=_[0],K=_[1],q=Object(o.useState)(!1),z=Object(s.a)(q,2),H=(z[0],z[1]),Q=Object(o.useRef)(null),X=Object(o.useRef)(null),Y=Object(o.useState)(null),Z=Object(s.a)(Y,2),$=Z[0],ee=Z[1],te=Object(o.useState)([]),ne=Object(s.a)(te,2),ae=ne[0],ce=ne[1],re=Object(o.useCallback)(function(){var a=Object(r.a)(c.a.mark((function a(r,o){var i,l,u,d,p,f,m,h,g,k,y,w,S,C,P,I;return c.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(console.log([R,B,ae]),0!==ae.length){a.next=4;break}return N("no selected files"),a.abrupt("return");case 4:return T(!0),a.prev=5,a.next=8,Object(j.a)({availableTokens:x,seedProviderPub:n,seedToken:O,seedUrl:v,serviceID:o,servicePrice:r});case 8:return i=a.sent,l=i.seedUrl,u=i.tokens,d=i.deleteToken,p=new FormData,Array.from(ae).forEach((function(e){return p.append("files",e)})),p.append("info","extraInfo"),p.append("comment","comment"),a.next=18,fetch("".concat(l,"/api/put_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(u[0])},body:p});case 18:return f=a.sent,a.next=21,f.json();case 21:if(m=a.sent,console.log(m),!m.error||!m.error.message){a.next=28;break}return"The provided token has already been used"===(h=m.error.message)?(N("An error occurred, please try again"),Object(b.g)(l,u[0])(e)):N(h),T(!1),a.abrupt("return");case 28:return g=m.data.torrent,k=g.magnet,y=Object(s.a)(E,1),w=y[0],console.log(w),S="image/embedded","video"===w.type&&(S="video/embedded"),C={type:S,magnetURI:k,width:0,height:0},a.next=37,Object(b.c)(C)(e);case 37:P=a.sent,console.log("content publish complete"),console.log(P),T(!1),d&&Object(b.g)(l,u[0])(e),t.push("/profile"),a.next=50;break;case 45:a.prev=45,a.t0=a.catch(5),console.log(a.t0),N(null!==(I=null===a.t0||void 0===a.t0?void 0:a.t0.errorMessage)&&void 0!==I?I:null===a.t0||void 0===a.t0?void 0:a.t0.message),T(!1);case 50:case"end":return a.stop()}}),a,null,[[5,45]])})));return function(e,t){return a.apply(this,arguments)}}(),[R,B,ae,E,x,v,O,t,e,N]),se=Object(o.useCallback)((function(){ee(null)}),[ee]),oe=Object(o.useCallback)((function(){var e=$.servicePrice,t=$.serviceID;re(e,t),ee(null)}),[$,re,ee]),ie=Object(o.useCallback)(function(){var e=Object(r.a)(c.a.mark((function e(t){var a,r,s,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=c.a.keys(x);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(r=e.t1.value,!Object.prototype.hasOwnProperty.call(x,r)){e.next=10;break}if(!x[r][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(s="",g[n]&&(s=g[n].SeedServiceProvided),!(a||v&&O)){e.next=18;break}re(),e.next=29;break;case 18:if(!s||!n){e.next=28;break}return e.next=21,d.a.get("/api/gun/otheruser/".concat(n,"/load/offeredServices>").concat(s));case 21:o=e.sent,i=o.data,l=i.data.servicePrice,console.log(i),ee({servicePrice:l,serviceID:s}),e.next=29;break;case 28:N("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[x,ee,N,re]),le=Object(o.useCallback)(function(){var e=Object(r.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),F(""),J(""),N(null),ee(null),ce([]),U([]);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[J,F,N,ee,ce,U]),ue=Object(o.useCallback)((function(e){var t=e.target,n=t.value,a=t.name;t.checked;switch(a){case"title":return void F(n);case"description":return void J(n);case"postType":return void K(n);case"createPost":return void console.log("create post");default:return}}),[F,J,H]),de=Object(o.useCallback)((function(e){e.preventDefault(),console.log(e.target.files),ce(e.target.files);var t=Array.from(e.target.files).map((function(e,t){return console.log("doing file..."),new Promise((function(n){var a=e.type,c=new FileReader;c.onload=function(e){a.startsWith("image/")&&n({type:"image",uri:e.target.result,index:t}),a.startsWith("video/")&&n({type:"video",uri:e.target.result,index:t})},c.readAsDataURL(e)}))}));Promise.allSettled(t).then((function(e){var t=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value)})),console.log(t),U(t)}))}),[ce,U]),be=Object(o.useCallback)((function(e){e.preventDefault(),Q.current.click()}),[Q]),je=Object(o.useCallback)((function(e){e.preventDefault(),X.current.click()}),[X]);return Object(h.jsxs)("div",{className:"publish-content-form-container m-1",children:[P?Object(h.jsx)(l.a,{overlay:!0,fullScreen:!0,text:"Creating content..."}):null,Object(h.jsx)(u.a,{drawerVisible:!1,pageTitle:"PUBLISH CONTENT"}),Object(h.jsxs)("form",{className:"publish-content-form",onSubmit:ie,onReset:le,children:[Object(h.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:Object(h.jsxs)("h2",{children:["Say Something",Object(h.jsx)("div",{className:"line"})]})}),Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[Object(h.jsx)("div",{className:"publish-content-title",children:Object(h.jsx)("label",{htmlFor:"title",children:Object(h.jsx)("strong",{children:"Title"})})}),Object(h.jsxs)("div",{children:[Object(h.jsxs)("strong",{children:["Audience: ",Object(h.jsx)("i",{className:"fas ".concat("public"===G?"fa-globe-europe":"fa-credit-card")})]}),Object(h.jsxs)("select",{name:"postType",id:"postType",onChange:ue,style:{appearance:"none",backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)",marginLeft:"0.3rem"},children:[Object(h.jsx)("option",{value:"public",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},children:"Public"}),Object(h.jsx)("option",{value:"private",children:"Paywall"})]})]})]}),Object(h.jsx)("input",{type:"text",name:"title",placeholder:"How I monetized my content with ShockWallet",value:R,onChange:ue,className:"input-field"}),Object(h.jsx)("div",{className:"publish-content-title",children:Object(h.jsx)("label",{htmlFor:"contents",children:Object(h.jsx)("strong",{children:"Contents"})})}),Object(h.jsxs)("div",{className:"m-b-1",children:[Object(h.jsx)("input",{type:"file",id:"file",ref:Q,style:{display:"none"},accept:"image/*",multiple:!0,onChange:de}),Object(h.jsx)("input",{type:"file",id:"file",ref:X,style:{display:"none"},accept:"video/*",multiple:!0,onChange:de}),Object(h.jsx)("i",{className:"fas fa-images publish-content-icon",onClick:be}),Object(h.jsx)("i",{className:"fas fa-video publish-content-icon",onClick:je}),Object(h.jsx)("div",{children:E.length>0&&E.map((function(e){return"image"===e.type?Object(h.jsx)("img",{src:e.uri,width:100,className:"m-1"},e.index.toString()):"video"===e.type?Object(h.jsx)("video",{src:e.uri,controls:!0,width:100,className:"m-1"},e.index.toString()):void 0}))})]}),Object(h.jsx)("div",{className:"publish-content-title",children:Object(h.jsx)("label",{htmlFor:"description",children:Object(h.jsx)("strong",{children:"Description"})})}),Object(h.jsx)("textarea",{name:"description",placeholder:"I made a quick video to show you guys how easy it is to run your own social platform on ShockWallet, and start earning Bitcoin",rows:3,value:B,onChange:ue,className:"input-field"}),Object(h.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto"},children:[Object(h.jsx)("label",{htmlFor:"createPost",children:"Create Post/Teaser?"}),Object(h.jsx)("input",{type:"checkbox",name:"createPost",style:{marginLeft:"0.2em"}})]}),w?Object(h.jsx)("p",{className:"error-container",children:w}):null,Object(h.jsxs)("div",{className:"flex-center",children:[Object(h.jsx)("input",{type:"reset",value:"reset",className:"shock-form-button m-1"}),Object(h.jsx)("input",{type:"submit",value:"submit",className:"shock-form-button-confirm m-1"})]})]}),$&&Object(h.jsx)(m.a,{modalOpen:$&&!P,toggleModal:se,children:Object(h.jsxs)("div",{style:{padding:"1rem"},children:[Object(h.jsxs)("p",{children:["The service from the default service provider will cost: ",Object(h.jsxs)("strong",{children:[$.servicePrice," sats"]})]}),Object(h.jsx)("button",{className:"shock-form-button m-1",onClick:le,children:"cancel"}),Object(h.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:oe,children:"confirm"})]})})]})}}}]);
//# sourceMappingURL=22.a651d75a.chunk.js.map