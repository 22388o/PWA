(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[17],{438:function(e,t,a){"use strict";var n=a(3),c=a(77),r=a.n(c),s=(a(440),a(8)),o=function(e){var t=e.children,a=e.style;return Object(s.jsx)("div",{className:"modal-content",style:a,children:t})},i=(a(441),function(e){var t=e.title,a=e.toggleModal;return t?Object(s.jsxs)("div",{className:"modal-head",children:[Object(s.jsx)("p",{className:"modal-head-title",children:t}),Object(s.jsx)("div",{className:"modal-head-close",onClick:a,children:Object(s.jsx)("i",{className:"fas fa-times"})})]}):null});a(442),t.a=function(e){var t=e.modalOpen,a=void 0!==t&&t,c=e.toggleModal,l=e.modalTitle,u=void 0===l?"":l,d=e.children,b=e.contentStyle,j=void 0===b?{}:b,p=Object(n.useCallback)((function(){c()}),[c]);return Object(s.jsxs)("div",{className:r()({modal:!0,"modal-open":a}),children:[Object(s.jsx)("div",{className:"modal-backdrop",onClick:p}),Object(s.jsxs)("div",{className:"modal-container",children:[Object(s.jsx)(i,{title:u,toggleModal:p}),Object(s.jsx)(o,{style:j,children:d})]})]})}},439:function(e,t,a){"use strict";a(3),a(449);var n=a(8);t.a=function(e){var t=e.tipCounter,a=e.tipValue,c=e.zoomed;return a>0?Object(n.jsxs)("div",{className:"ribbon-container",style:{opacity:c?0:1},children:[Object(n.jsx)("p",{className:"ribbon-title",children:"Total Tips"}),Object(n.jsxs)("p",{className:"ribbon-value",children:[t," ",1===t?"Tip":"Tips"]})]}):null}},440:function(e,t,a){},441:function(e,t,a){},442:function(e,t,a){},444:function(e,t,a){"use strict";var n=a(3),c=a(77),r=a.n(c),s=(a(445),a(8));t.a=function(e){var t=e.pageTitle,a=e.drawerVisible,c=Object(n.useCallback)((function(){window.history.back()}),[]);return Object(s.jsxs)("div",{className:"dialog-nav-container",children:[Object(s.jsx)("div",{className:"dialog-nav-back",onClick:c,children:Object(s.jsx)("i",{className:"icon icon-thin-back"})}),Object(s.jsx)("p",{className:"dialog-nav-title",children:t}),Object(s.jsxs)("div",{className:r()({"dialog-nav-menu-btn":!0,"dialog-nav-hidden":!a}),children:[Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"})]})]})}},445:function(e,t,a){},449:function(e,t,a){},454:function(e,t,a){},456:function(e,t,a){"use strict";var n=a(2),c=a.n(n),r=a(6),s=a(20),o=a(3),i=a(439),l=(a(457),a(151)),u=a(18),d=a(8),b="".concat("https://webtorrent.shock.network","/rtmpapi/api/streams/live");t.a=function(e){e.id;var t=e.item,a=(e.index,e.postId,e.tipValue),n=e.tipCounter,j=e.hideRibbon,p=e.width,v=Object(o.useRef)(null),m=Object(o.useState)(!1),f=Object(s.a)(m,2),h=f[0],O=f[1],x={width:"100%"};return p&&(x.width=p),Object(o.useEffect)((function(){var e=null,a=function(){var e=Object(r.a)(c.a.mark((function e(){var a,n,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.magnetURI.split("/live/")[1].split("/index.m3u8"),n=Object(s.a)(a,1),r=n[0],e.next=4,u.a.get("".concat(b,"/").concat(r));case 4:if(e.sent.data.isLive){e.next=7;break}return e.abrupt("return",!1);case 7:return(o=Object(l.a)(v.current,{autoplay:!0,muted:!0,aspectRatio:"16:9"})).src({src:t.magnetURI,type:"application/x-mpegURL"}),o.play(),e.abrupt("return",!0);case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();return a().then((function(t){t?O(!0):e=setInterval(Object(r.a)(c.a.mark((function t(){return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a();case 2:if(!t.sent){t.next=7;break}return O(!0),clearInterval(e),t.abrupt("return");case 7:case"end":return t.stop()}}),t)}))),1e4)})),function(){clearInterval(e)}}),[t]),Object(d.jsx)("div",{className:"media-container w-100",children:Object(d.jsxs)("div",{className:"video-container w-100",style:{cursor:"pointer",width:"100%"},children:[!h&&Object(d.jsx)("p",{children:"The streamer has disconnected."}),Object(d.jsx)("div",{style:h?{width:"100%"}:{display:"none",width:"100%"},children:Object(d.jsx)("video",{className:"video-js vjs-default-skin",ref:v,style:x,preload:"auto",controls:!0,muted:!0,autoPlay:!0})}),!j&&Object(d.jsx)(i.a,{tipCounter:n,tipValue:a,zoomed:!1})]})})}},457:function(e,t,a){},522:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(0),c=a(2),r=a.n(c),s=a(6),o=a(18),i=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,c,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(32),window.crypto.getRandomValues(n),c=Array.prototype.map.call(n,(function(e){return("00"+e.toString(16)).slice(-2)})).join(""),s={seed_token:a,wallet_token:c},e.next=6,fetch("".concat(t,"/api/enroll_token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 6:if(200===e.sent.status){e.next=9;break}throw new Error("torrentSeed service currently not available");case 9:return e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),l=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,c,s,l,u,d,b,j,p,v,m,f,h,O,x;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.availableTokens,c=t.seedUrl,s=t.seedToken,l=t.seedProviderPub,u=t.serviceID,d=t.servicePrice,b=null,j=!1,p=null,e.t0=r.a.keys(a);case 5:if((e.t1=e.t0()).done){e.next=14;break}if(v=e.t1.value,!Object.prototype.hasOwnProperty.call(a,v)){e.next=12;break}if(!(m=a[v])[0]){e.next=12;break}return p={seedUrl:v,tokens:m},e.abrupt("break",14);case 12:e.next=5;break;case 14:if(console.log(l),console.log(u),console.log(d),!c||!s){e.next=27;break}return console.log("USING SELF SEED TOKEN"),e.next=21,i(c,s);case 21:f=e.sent,console.log("token"),console.log(f),b={seedUrl:c,tokens:[f]},e.next=48;break;case 27:if(!p){e.next=33;break}console.log("USING AVAILABLE TOKEN"),b=p,j=!0,e.next=48;break;case 33:if(!(l&&u&&d)){e.next=47;break}return console.log("USING DEFAULT TOKEN PROVIDER"),e.next=37,o.a.post("/api/lnd/unifiedTrx",{type:"service",amt:d,to:l,memo:"",feeLimit:500,ackInfo:u});case 37:if(h=e.sent,O=h.data,200===h.status){e.next=42;break}throw new Error("seed token request failed");case 42:console.log(O),x=O.orderAck,b=JSON.parse(x.response),e.next=48;break;case 47:throw new Error("provide the token data or use default seed provider");case 48:return e.abrupt("return",Object(n.a)(Object(n.a)({},b),{},{deleteToken:j}));case 49:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},707:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a.n(n),r=a(6),s=a(20),o=a(3),i=a(45),l=a(43),u=(a(454),a(149)),d=a(18),b=a(444),j=a.p+"static/media/obs-2.7c61e78e.svg",p=a(456),v=a(522),m=a(24),f=a(438),h=a(27),O=a(8);t.default=function(){var e=Object(i.b)(),t=Object(m.g)(),a=h.useSelector((function(e){return e.content.seedProviderPub})),n=h.useSelector((function(e){return e.content.seedInfo})),x=n.seedUrl,k=n.seedToken,g=h.useSelector((function(e){return e.content.streamLiveToken})),y=h.useSelector((function(e){return e.content.streamUserToken})),w=h.useSelector((function(e){return e.content.availableTokens})),N=h.useSelector((function(e){return e.userProfiles})),S=Object(o.useState)("obs"),C=Object(s.a)(S,2),T=C[0],P=C[1],I=Object(o.useState)(!1),U=Object(s.a)(I,2),E=U[0],R=U[1],L=Object(o.useState)(g),V=Object(s.a)(L,2),A=V[0],D=V[1],B=Object(o.useState)(y),M=Object(s.a)(B,2),G=M[0],J=M[1],K=Object(o.useState)("Look I'm streaming!"),z=Object(s.a)(K,2),_=z[0],F=z[1],q=Object(o.useState)(!0),W=Object(s.a)(q,2),Y=W[0],H=(W[1],Object(o.useState)(null)),Q=Object(s.a)(H,2),X=Q[0],Z=Q[1],$=Object(o.useState)(""),ee=Object(s.a)($,2),te=ee[0],ae=ee[1],ne=Object(o.useState)(""),ce=Object(s.a)(ne,2),re=ce[0],se=ce[1],oe=Object(o.useState)(null),ie=Object(s.a)(oe,2),le=ie[0],ue=ie[1],de=Object(o.useCallback)(function(){var t=Object(r.a)(c.a.mark((function t(n,r){var o,i,u,b,j,p,m,f,h,O,g,y;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,R(!0),t.next=4,Object(v.a)({availableTokens:w,seedProviderPub:a,seedToken:k,seedUrl:x,serviceID:r,servicePrice:n});case 4:return o=t.sent,i=o.seedUrl,u=o.tokens,b=Object(s.a)(u,1),j=b[0],J(j),t.next=11,d.a.post("".concat(i,"/api/stream/auth"),{token:j});case 11:return p=t.sent,m=p.data,f=m.data.token,console.log(f),h="".concat(j,"?key=").concat(f),D("".concat(j,"?key=").concat(f)),O=i.replace("https","rtmp"),ae("".concat(O,"/live")),se("".concat(i,"/rtmpapi")),Object(l.d)(j,h)(e),g=[],""!==_&&g.push({type:"text/paragraph",text:_}),g.push({type:"stream/embedded",width:0,height:0,magnetURI:"".concat(i,"/rtmpapi/live/").concat(j,"/index.m3u8"),isPreview:!1,isPrivate:!1,userToken:j}),t.next=26,d.a.post("/api/gun/wall",{tags:[],title:"Post",contentItems:g});case 26:200===t.sent.status?(console.log("post created successfully"),R(!1)):(Z("invalid response status"),R(!1)),t.next=35;break;case 30:t.prev=30,t.t0=t.catch(0),console.log(t.t0),Z(null!==(y=null===t.t0||void 0===t.t0?void 0:t.t0.errorMessage)&&void 0!==y?y:null===t.t0||void 0===t.t0?void 0:t.t0.message),R(!1);case 35:case"end":return t.stop()}}),t,null,[[0,30]])})));return function(e,a){return t.apply(this,arguments)}}(),[_,a,x,k,R,D,Z,J,ae,se,l.d]),be=Object(o.useCallback)((function(){ue(null)}),[ue]),je=Object(o.useCallback)((function(){var e=le.servicePrice,t=le.serviceID;de(e,t),ue(null)}),[le,de,ue]),pe=Object(o.useCallback)(function(){var e=Object(r.a)(c.a.mark((function e(t){var n,r,s,o,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),n=!1,e.t0=c.a.keys(w);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(r=e.t1.value,!Object.prototype.hasOwnProperty.call(w,r)){e.next=10;break}if(!w[r][0]){e.next=10;break}return n=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(s="",N[a]&&(s=N[a].SeedServiceProvided),!(n||x&&k)){e.next=18;break}de(),e.next=29;break;case 18:if(!s||!a){e.next=28;break}return e.next=21,d.a.get("/api/gun/otheruser/".concat(a,"/load/offeredServices>").concat(s));case 21:o=e.sent,i=o.data,l=i.data.servicePrice,console.log(i),ue({servicePrice:l,serviceID:s}),e.next=29;break;case 28:Z("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[w,ue,Z,de]),ve=Object(o.useCallback)((function(){navigator.clipboard.writeText(A)}),[A]),me=Object(o.useCallback)((function(){navigator.clipboard.writeText(te)}),[]),fe=Object(o.useCallback)((function(e){var t=e.target,a=t.value,n=t.name;t.checked;switch(n){case"paragraph":return void F(a);case"source":return void P(a);default:return}}),[F,P]),he=Object(o.useCallback)((function(){Object(l.f)()(e),t.push("/profile")}),[t]);return Object(O.jsxs)("div",{className:"h-100 m-1",children:[E?Object(O.jsx)(u.a,{overlay:!0,fullScreen:!0,text:""}):null,Object(O.jsx)(b.a,{drawerVisible:!1,pageTitle:"GO LIVE"}),Y&&Object(O.jsx)("div",{children:Object(O.jsx)(p.a,{hideRibbon:!0,item:{magnetURI:"".concat(re,"/live/").concat(G,"/index.m3u8")}})}),Object(O.jsxs)("select",{value:T,onChange:fe,name:"source",id:"source",style:{backgroundColor:"rgba(0,0,0,0)",color:"white",width:"100%",border:"0",marginBottom:"1em"},children:[Object(O.jsx)("option",{value:"camera",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},children:"Camera"}),Object(O.jsx)("option",{value:"obs",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},children:"OBS"})]}),Object(O.jsxs)("div",{className:"flex-center m-b-1",children:["obs"===T&&Object(O.jsx)("img",{src:j,style:{width:"10em",height:"10em"},alt:""}),"camera"===T&&Object(O.jsx)("i",{className:"fas fa-camera",style:{fontSize:"10em"}})]}),A?Object(O.jsxs)("div",{children:["obs"===T&&Object(O.jsx)("p",{className:"m-b-1",children:"You are ready to go! setup the stream with OBS and watch it from your profile"}),Object(O.jsx)("p",{children:"Broadcaster:"}),Object(O.jsxs)("div",{style:{border:"1px solid var(--main-blue)",padding:"0.5rem",display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[Object(O.jsx)("p",{children:te.substring(0,20)+(te.length>21?"...":"")}),Object(O.jsx)("i",{className:"far fa-copy",onClick:me})]}),Object(O.jsx)("p",{children:"Stream Key:"}),Object(O.jsxs)("div",{style:{border:"1px solid var(--main-blue)",padding:"0.5rem",display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[Object(O.jsx)("p",{children:A.substring(0,20)+(A.length>21?"...":"")}),Object(O.jsx)("i",{className:"far fa-copy",onClick:ve})]}),Object(O.jsx)("div",{className:"flex-center",children:Object(O.jsx)("button",{onClick:he,className:"shock-form-button-confirm",children:"STOP"})})]}):Object(O.jsxs)("div",{className:"vertical-flex-center",children:[Object(O.jsx)("input",{className:"input-field",type:"text",name:"paragraph",id:"paragraph",value:_,onChange:fe}),Object(O.jsx)("button",{onClick:pe,className:"shock-form-button-confirm",children:"START NOW"})]}),X?Object(O.jsx)("p",{className:"error-container",children:X}):null,le&&Object(O.jsx)(f.a,{modalOpen:le&&!E,toggleModal:be,children:Object(O.jsxs)("div",{style:{padding:"1rem"},children:[Object(O.jsxs)("p",{children:["The service from the default service provider will cost: ",Object(O.jsxs)("strong",{children:[le.servicePrice," sats"]})]}),Object(O.jsx)("button",{className:"shock-form-button m-1",onClick:be,children:"cancel"}),Object(O.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:je,children:"confirm"})]})})]})}}}]);
//# sourceMappingURL=17.d95038d1.chunk.js.map