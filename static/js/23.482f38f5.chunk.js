(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[23],{526:function(e,t,n){"use strict";t.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},571:function(e,t,n){"use strict";var r=n(3),i=r.useLayoutEffect;t.a=function(e){var t=Object(r.useRef)(e);return i((function(){t.current=e})),t}},630:function(e,t,n){var r=n(153),i=n(631),o=n(632),a=Math.max,c=Math.min;e.exports=function(e,t,n){var s,u,l,d,f,h,b=0,p=!1,v=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function j(t){var n=s,r=u;return s=u=void 0,b=t,d=e.apply(r,n)}function g(e){return b=e,f=setTimeout(O,t),p?j(e):d}function y(e){var n=e-h;return void 0===h||n>=t||n<0||v&&e-b>=l}function O(){var e=i();if(y(e))return x(e);f=setTimeout(O,function(e){var n=t-(e-h);return v?c(n,l-(e-b)):n}(e))}function x(e){return f=void 0,m&&s?j(e):(s=u=void 0,d)}function w(){var e=i(),n=y(e);if(s=arguments,u=this,h=e,n){if(void 0===f)return g(h);if(v)return clearTimeout(f),f=setTimeout(O,t),j(h)}return void 0===f&&(f=setTimeout(O,t)),d}return t=o(t)||0,r(n)&&(p=!!n.leading,l=(v="maxWait"in n)?a(o(n.maxWait)||0,t):l,m="trailing"in n?!!n.trailing:m),w.cancel=function(){void 0!==f&&clearTimeout(f),b=0,s=h=u=f=void 0},w.flush=function(){return void 0===f?d:x(i())},w}},631:function(e,t,n){var r=n(76);e.exports=function(){return r.Date.now()}},632:function(e,t,n){var r=n(633),i=n(153),o=n(635),a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=c.test(e);return n||s.test(e)?u(e.slice(2),n?2:8):a.test(e)?NaN:+e}},633:function(e,t,n){var r=n(634),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},634:function(e,t){var n=/\s/;e.exports=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},635:function(e,t,n){var r=n(155),i=n(257);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==r(e)}},636:function(e,t,n){},637:function(e,t,n){},760:function(e,t,n){"use strict";n.r(t);var r=n(16),i=n(3),o=n(22),a=n(40),c=n(12),s=n(31),u=n(571),l=function(e,t){"function"!==typeof e?e.current=t:e(t)},d=function(e,t){var n=Object(i.useRef)();return Object(i.useCallback)((function(r){e.current=r,n.current&&l(n.current,null),n.current=t,t&&l(t,r)}),[t])},f={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},h=function(e){Object.keys(f).forEach((function(t){e.style.setProperty(t,f[t],"important")}))},b=null;var p=function(){},v=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],m=!!document.documentElement.currentStyle,j=function(e,t){var n=e.cacheMeasurements,r=e.maxRows,o=e.minRows,a=e.onChange,l=void 0===a?p:a,f=e.onHeightChange,j=void 0===f?p:f,g=Object(s.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var y=void 0!==g.value,O=Object(i.useRef)(null),x=d(O,t),w=Object(i.useRef)(0),S=Object(i.useRef)(),L=function(){var e=O.current,t=n&&S.current?S.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,r=(n=t,v.reduce((function(e,t){return e[t]=n[t],e}),{})),i=r.boxSizing;return""===i?null:(m&&"border-box"===i&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})}(e);if(t){S.current=t;var i=function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),b||((b=document.createElement("textarea")).setAttribute("tab-index","-1"),b.setAttribute("aria-hidden","true"),h(b)),null===b.parentNode&&document.body.appendChild(b);var i=e.paddingSize,o=e.borderSize,a=e.sizingStyle,c=a.boxSizing;Object.keys(a).forEach((function(e){var t=e;b.style[t]=a[t]})),h(b),b.value=t;var s=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(b,e);b.value="x";var u=b.scrollHeight-i,l=u*n;"border-box"===c&&(l=l+i+o),s=Math.max(l,s);var d=u*r;return"border-box"===c&&(d=d+i+o),[s=Math.min(d,s),u]}(t,e.value||e.placeholder||"x",o,r),a=i[0],c=i[1];w.current!==a&&(w.current=a,e.style.setProperty("height",a+"px","important"),j(a,{rowHeight:c}))}};return Object(i.useLayoutEffect)(L),function(e){var t=Object(u.a)(e);Object(i.useLayoutEffect)((function(){var e=function(e){t.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[])}(L),Object(i.createElement)("textarea",Object(c.a)({},g,{onChange:function(e){y||L(),l(e)},ref:x}))},g=Object(i.forwardRef)(j),y=n(72),O=n.n(y),x=n(630),w=n.n(x),S=n(112),L=n(83),k=n(509),N=n(25);function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var C=new Map,F=new Map,M=0;function T(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(F.has(n)||(M+=1,F.set(n,M.toString())),F.get(n)):"0":e[t]);var n})).toString()}function E(e,t,n){if(void 0===n&&(n={}),!e)return function(){};var r=function(e){var t=T(e),n=C.get(t);if(!n){var r,i=new Map,o=new IntersectionObserver((function(t){t.forEach((function(t){var n,o=t.isIntersecting&&r.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=o),null==(n=i.get(t.target))||n.forEach((function(e){e(o,t)}))}))}),e);r=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:o,elements:i},C.set(t,n)}return n}(n),i=r.id,o=r.observer,a=r.elements,c=a.get(e)||[];return a.has(e)||a.set(e,c),c.push(t),o.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(a.delete(e),o.unobserve(e)),0===a.size&&(o.disconnect(),C.delete(i))}}function R(e){return"function"!==typeof e.children}var z=function(e){var t,n;function r(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),R(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var o=r.prototype;return o.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},o.componentWillUnmount=function(){this.unobserve(),this.node=null},o.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,r=e.rootMargin,i=e.trackVisibility,o=e.delay;this._unobserveCb=E(this.node,this.handleChange,{threshold:t,root:n,rootMargin:r,trackVisibility:i,delay:o})}},o.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},o.render=function(){if(!R(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var r=this.props,o=r.children,a=r.as,c=r.tag,s=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(r,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(i.createElement)(a||c||"div",V({ref:this.handleNode},s),o)},r}(i.Component);z.displayName="InView",z.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var I=n(485),D=n(497),W=n(482),_=n(89),A=(n(636),n(7)),K={threshold:.2},H=function(e){var t=e.text,n=void 0===t?"":t,r=e.receivedMessage,o=void 0!==r&&r,a=e.publicKey,c=void 0===a?"":a,s=e.timestamp,u=e.onInView,l=void 0===u?_.a:u,d=e.onOutView,f=void 0===d?_.a:d,h=e.id,b=function(e){var t=void 0===e?{}:e,n=t.threshold,r=t.delay,o=t.trackVisibility,a=t.rootMargin,c=t.root,s=t.triggerOnce,u=t.skip,l=t.initialInView,d=Object(i.useRef)(),f=Object(i.useState)({inView:!!l}),h=f[0],b=f[1],p=Object(i.useCallback)((function(e){void 0!==d.current&&(d.current(),d.current=void 0),u||e&&(d.current=E(e,(function(e,t){b({inView:e,entry:t}),t.isIntersecting&&s&&d.current&&(d.current(),d.current=void 0)}),{root:c,rootMargin:a,threshold:n,trackVisibility:o,delay:r}))}),[Array.isArray(n)?n.toString():n,c,a,s,u,o,r]);Object(i.useEffect)((function(){d.current||!h.entry||s||u||b({inView:!!l})}));var v=[p,h.inView,h.entry];return v.ref=v[0],v.inView=v[1],v.entry=v[2],v}(K),p=b.inView,v=b.ref;return Object(i.useEffect)((function(){p?l(h):f(h)}),[h,p,l,f]),Object(A.jsxs)("div",{className:O()({"chat-message":!0,"chat-message-received":o}),ref:v,children:[o&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(D.a,{height:48,publicKey:c}),Object(A.jsx)(I.a,{amt:16,insideRow:!0})]}),Object(A.jsx)("p",{className:"chat-message-text",children:n}),Object(A.jsx)(I.a,{amt:8,insideRow:!0}),function(){try{var e=N.k(s),t=S.DateTime.fromMillis(e).toLocaleString(S.DateTime.TIME_SIMPLE);return Object(A.jsx)("div",{className:O()(W.u),children:Object(A.jsx)("p",{className:W.n,children:t})})}catch(n){return console.log(n),null}}()]})},q=n(24),P=n(526),B=(n(637),n(18)),U=n(20);Object(L.b)();t.default=function(){var e=Object(a.b)(),t=Object(o.i)().publicKey,n=B.useSelector(B.selectUser(t)),c=Object(i.useState)(""),s=Object(r.a)(c,2),u=s[0],l=s[1],d=Object(i.useState)(!1),f=Object(r.a)(d,2),h=f[0],b=f[1],p=Object(i.useState)(-1),v=Object(r.a)(p,2),m=v[0],j=v[1],y=Object(i.useMemo)((function(){return{top:m+8+"px"}}),[m]),x=Object(i.useCallback)((function(e){j(e)}),[j]),N=w()((function(){h||(b(!0),setTimeout((function(){b(!1)}),1500))})),V=B.useSelector((function(e){return e.chat.messages[t]})),C=B.useSelector((function(e){var n=e.chat;return Object(_.c)(n.contacts,t)})),F=B.useSelector((function(e){var n=e.chat;return Object(_.c)(n.sentRequests,t)})),M=B.useSelector((function(e){var n=e.chat;return Object(_.c)(n.receivedRequests,t)})),T=B.useSelector((function(e){return e.node.publicKey})),E=!C&&F,R=!C&&M,z=Object(i.useCallback)((function(e){l(e.target.value)}),[]),I=Object(i.useCallback)((function(){console.log(M),M&&Object(q.b)(M.id)(e)}),[M,e]),D=Object(i.useCallback)((function(n){if("Enter"!==n.key||!n.ctrlKey)return"Enter"===n.key?(n.preventDefault(),e(Object(q.g)({message:u,publicKey:t})),void l("")):void 0;l(u+"\r\n")}),[u,t,e]),K=Object(i.useCallback)((function(){var n=e(Object(q.h)(T,t));return Object(U.f)(n)}),[e,T,t]);Object(i.useEffect)((function(){return K()}),[K]);var $=Object(i.useState)(new Set),J=Object(r.a)($,2),Y=J[0],G=J[1],Q=Object(i.useMemo)((function(){if(0===Y.size)return[S.DateTime.now().valueOf(),Date.now().valueOf()];var e=Array.from(Y).map((function(e){return V.find((function(t){return t.id===e}))})).filter((function(e){return!!e})).sort((function(e,t){return t.timestamp-e.timestamp}));return[e[0].timestamp,e[e.length-1].timestamp]}),[V,Y]),X=Object(r.a)(Q,2),Z=X[0],ee=X[1],te=Object(i.useCallback)((function(e){G(Object(L.a)((function(t){t.add(e)})))}),[G]),ne=Object(i.useCallback)((function(e){G(Object(L.a)((function(t){t.delete(e)})))}),[G]),re=n.displayName;return Object(A.jsxs)("div",{className:"page-container",children:[Object(A.jsx)(k.a,{solid:!0,pageTitle:re,enableBackButton:!0,onHeight:x}),Object(A.jsx)("div",{className:"chat-messages-container",onScroll:N,children:null===V||void 0===V?void 0:V.map((function(e){return Object(A.jsx)(H,{text:e.body,receivedMessage:!e.outgoing,publicKey:e.recipientPublicKey,timestamp:e.timestamp,onInView:te,onOutView:ne,id:e.id})}))}),Object(A.jsx)("div",{className:O()(W.p,W.b,W.c,W.d),style:y,children:Object(A.jsx)("span",{className:O()(W.n,"chat-date-bubble",h?W.r:W.q),children:function(){var e=S.DateTime.fromMillis(Z).startOf("day"),t=S.DateTime.fromMillis(ee).startOf("day"),n=S.DateTime.now().startOf("day"),r=S.DateTime.now().minus({day:1}).startOf("day"),i=e.hasSame(n,"year")&&t.hasSame(n,"year");if((e||t).hasSame(t,"day"))return e.hasSame(n,"day")?"Today":e.hasSame(r,"day")?"Yesterday":i?e.toFormat("LLLL d"):e.toLocaleString(S.DateTime.DATE_FULL);if(e.hasSame(t,"month")){var o=t.toFormat("d"),a=e.toFormat("d"),c=(e||t).toFormat("LLLL");if(i)return"".concat(c," ").concat(o," - ").concat(a);var s=e.toFormat("y");return"".concat(c," ").concat(o," - ").concat(a,", ").concat(s)}if(i){var u=t.toFormat("d"),l=e.toFormat("d"),d=t.toFormat("LLLL"),f=e.toFormat("LLLL");return"".concat(d," ").concat(u," - ").concat(f," ").concat(l)}var h=t.toFormat("d"),b=e.toFormat("d"),p=t.toFormat("LLLL"),v=e.toFormat("LLLL"),m=t.toFormat("y"),j=e.toFormat("y");return"".concat(p," ").concat(h,", ").concat(m," - ").concat(v," ").concat(b,", ").concat(j)}()})}),R?Object(A.jsxs)("div",{className:"chat-permission-bar",children:[Object(A.jsxs)("p",{className:"chat-permission-bar-title unselectable",children:[re," has sent you a chat request!"]}),Object(A.jsxs)("p",{className:"chat-permission-bar-text",children:["Once you accept the request, you'll be able to chat and send invoices to ",re]}),Object(A.jsxs)("div",{className:"chat-permission-bar-actions unselectable",children:[Object(A.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:I,children:"Accept"}),Object(A.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline",children:"Decline"})]})]}):E?Object(A.jsxs)("div",{className:"chat-permission-bar",children:[Object(A.jsxs)("p",{className:"chat-permission-bar-title",children:["Your request has been sent to ",re," successfully"]}),Object(A.jsxs)("p",{className:"chat-permission-bar-text unselectable",children:["Once ",re," accepts the request, you'll be able to chat with them"]})]}):Object(A.jsx)("div",{className:"chat-bottom-bar",children:Object(A.jsxs)("div",{className:"chat-input-container",children:[Object(A.jsx)("div",{className:"chat-input-btn unselectable",children:Object(A.jsx)("img",{src:P.a,alt:"Menu"})}),Object(A.jsx)(g,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:D,onChange:z,value:u,height:20})]})})]})}}}]);
//# sourceMappingURL=23.482f38f5.chunk.js.map