{"version":3,"sources":["utils/Platform.ts","pages/Send/index.tsx"],"names":["isDesktop","navigator","userAgent","match","SendPage","location","useLocation","history","useHistory","useState","amount","setAmount","description","setDescription","unit","setUnit","contact","setContact","error","setError","paymentLoading","setPaymentLoading","isDesktopDevice","useMemo","onInputChange","useCallback","e","target","name","value","selectContact","a","console","log","type","Http","post","payReq","paymentRequest","data","decodedRequest","num_satoshis","useEffect","routerState","state","address","request","dest","sendBTCPayment","addr","payment","sendLightningPayment","payreq","amt","feeLimit","keysend","sendGunPayment","recipientPub","pk","Number","memo","onSubmit","includes","push","response","errorMessage","message","containerClassName","title","className","fullScreen","overlay","text","to","selected","style","undefined","features","label","onChange","disabled","inputMode","element","onClick","onSuccess"],"mappings":"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","file":"static/js/37.785b2907.chunk.js","sourcesContent":["export const isMobile = (): boolean =>\n  !!navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);\n\nexport const isDesktop = (): boolean => (!isMobile() ? true : false);\n","import { memo, useCallback, useState, useEffect, useMemo } from \"react\";\nimport { useHistory, useLocation } from \"react-router\";\nimport { Link } from \"react-router-dom\";\nimport Http from \"../../utils/Http\";\nimport SlidePay from \"../../common/SlidePay\";\nimport InputGroup from \"../../common/InputGroup\";\nimport ContactSearch from \"../../common/ContactsSearch\";\nimport DialogPageContainer from \"../../common/DialogPageContainer\";\nimport Suggestion from \"../../common/ContactsSearch/components/Suggestion\";\nimport Loader from \"../../common/Loader\";\nimport \"./css/index.scoped.css\";\nimport { isDesktop } from \"../../utils/Platform\";\n\ninterface properties {\n  [key: string]: any;\n}\n\ninterface LocationState {\n  data?: {\n    type: \"btc\" | \"ln\" | \"keysend\";\n    address: string;\n    amount: number;\n    request: string;\n  };\n}\n\nconst SendPage = () => {\n  const location = useLocation<LocationState>();\n  const history = useHistory();\n\n  const [amount, setAmount] = useState(0);\n  const [description, setDescription] = useState(\"\");\n  const [unit, setUnit] = useState(\"sats\");\n  const [contact, setContact] = useState<properties>({});\n  const [error, setError] = useState(\"\");\n  const [paymentLoading, setPaymentLoading] = useState(false);\n\n  const isDesktopDevice = useMemo(() => {\n    return isDesktop();\n  }, []);\n\n  const onInputChange = useCallback(e => {\n    if (e.target.name === \"amount\") {\n      setAmount(e.target.value);\n    }\n\n    if (e.target.name === \"description\") {\n      setDescription(e.target.value);\n    }\n\n    if (e.target.name === \"unit\") {\n      setUnit(e.target.value);\n    }\n  }, []);\n\n  const selectContact = useCallback(async contact => {\n    console.log(\"selectContact:\", contact);\n    setContact(contact);\n\n    if (contact && contact.type === \"invoice\") {\n      // Do invoice decoding\n      const { data } = await Http.post(\"/api/lnd/decodePayReq\", {\n        payReq: contact.paymentRequest\n      });\n\n      const { decodedRequest } = data;\n\n      setAmount(decodedRequest.num_satoshis);\n      setUnit(\"sats\");\n      setDescription(decodedRequest.description);\n    }\n\n  }, []);\n  //effect for incoming redirects with data\n  useEffect(() => {\n    const { state: routerState } = location;\n\n    // @ts-ignore\n    if (routerState && routerState.data && routerState.data.type) {\n      // @ts-ignore\n      const { data } = routerState;\n      switch (data.type) {\n        case \"btc\": {\n          selectContact({\n            type: \"btc\",\n            address: data.address\n          });\n          if (data.amount) {\n            setAmount(data.amount);\n          }\n          break;\n        }\n        case \"ln\": {\n          selectContact({\n            type: \"invoice\",\n            paymentRequest: data.request\n          });\n          break;\n        }\n        case \"keysend\": {\n          selectContact({\n            type: \"keysend\",\n            dest: data.address\n          });\n          break;\n        }\n        default:\n          break;\n      }\n      location.state = {};\n    }\n  }, [location, selectContact, setAmount]);\n  const sendBTCPayment = useCallback(async () => {\n    if (contact) {\n      const { data: payment } = await Http.post(\"/api/lnd/sendcoins\", {\n        addr: contact.address,\n        amount: amount\n      });\n      console.log(payment);\n    }\n  }, [amount, contact]);\n\n  const sendLightningPayment = useCallback(async () => {\n    if (contact) {\n      const { data: payment } = await Http.post(\"/api/lnd/sendpayment\", {\n        dest: contact.dest,\n        payreq: contact.paymentRequest,\n        amt: contact.paymentRequest ? \"0\" : amount,\n        feeLimit: amount * 0.006 + 10, // TODO: Hardcoded fees for now\n        keysend: contact.type === \"keysend\"\n      });\n      console.log(payment);\n    }\n  }, [amount, contact]);\n\n  const sendGunPayment = useCallback(async () => {\n    if (contact) {\n      await Http.post(\"/api/gun/sendpayment\", {\n        recipientPub: contact.pk,\n        amount: Number(amount),\n        feeLimit: amount * 0.006 + 10, // TODO: Hardcoded fees for now\n        memo: description\n      });\n    }\n  }, [amount, contact, description]);\n\n  const onSubmit = useCallback(async () => {\n    try {\n      setError(\"\");\n      setPaymentLoading(true);\n\n      if (contact?.type === \"btc\") {\n        await sendBTCPayment();\n      }\n\n      if ([\"invoice\", \"keysend\"].includes(contact?.type)) {\n        await sendLightningPayment();\n      }\n\n      if (contact?.type === \"contact\") {\n        await sendGunPayment();\n      }\n      history.push(\"/overview\");\n      setPaymentLoading(false);\n    } catch (err) {\n      console.error(err);\n      setError(err.response?.data.errorMessage ?? err.message);\n      setPaymentLoading(false);\n      throw err;\n    }\n  }, [contact, history, sendBTCPayment, sendGunPayment, sendLightningPayment]);\n\n  return (\n    <DialogPageContainer containerClassName=\"send-page\" title=\"SEND\">\n      <div className=\"send-form-container\">\n        {paymentLoading ? (\n          <Loader fullScreen overlay text=\"Processing Payment...\" />\n        ) : null}\n        {error ? <p className=\"form-error\">{error}</p> : null}\n        {!contact ? (\n          <Link className=\"scan-qr-btn\" to=\"/QRScanner\">\n            <i className=\"scan-qr-icon icon icon-solid-scan\"></i>\n            <p className=\"scan-qr-text\">Scan QR</p>\n          </Link>\n        ) : null}\n        {contact ? (\n          <Suggestion\n            selected\n            contact={contact}\n            selectContact={selectContact}\n            style={undefined}\n          />\n        ) : (\n          <ContactSearch\n            selectContact={selectContact}\n            features={[\"btc\", \"keysend\", \"contact\", \"invoice\"]}\n          />\n        )}\n        <div className=\"inputs-group\">\n          <InputGroup\n            name=\"amount\"\n            label=\"Enter Amount\"\n            onChange={onInputChange}\n            value={amount}\n            disabled={contact?.type === \"invoice\"}\n            inputMode=\"decimal\"\n          />\n          <select\n            name=\"unit\"\n            className=\"unit-dropdown\"\n            onChange={onInputChange}\n            value={unit}\n            disabled={contact?.type === \"invoice\"}\n          >\n            <option value=\"sats\">sats</option>\n            <option value=\"btc\">BTC</option>\n          </select>\n        </div>\n        <InputGroup\n          name=\"description\"\n          label=\"Description\"\n          element=\"textarea\"\n          onChange={onInputChange}\n          type=\"textarea\"\n          value={description}\n          disabled={contact?.type === \"invoice\"}\n        />\n      </div>\n      {isDesktopDevice && (\n        <div className=\"w-100 flex-center m-b-3\">\n          <button\n            disabled={!contact}\n            onClick={onSubmit}\n            className=\"shock-form-button-confirm\"\n          >\n            SEND\n          </button>\n        </div>\n      )}\n      {!isDesktopDevice && (\n        <SlidePay disabled={!contact} onSuccess={onSubmit} />\n      )}\n    </DialogPageContainer>\n  );\n};\n\nexport default memo(SendPage);\n"],"sourceRoot":""}