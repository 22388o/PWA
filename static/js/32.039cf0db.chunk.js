(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[32],{669:function(e,t,a){},706:function(e,t,a){"use strict";a.r(t);var c=a(25),n=a(2),r=a.n(n),s=a(6),o=a(14),i=a(3),l=a(41),d=a(73),u=a.n(d),b=(a(669),a(145)),j=a(15),p=a(40),v=a(554),f=a(22),h=a(18),m=a(435),O=a(471),x=a(434),g=a(7);t.default=function(){var e,t=Object(l.b)(),a=Object(f.g)(),n=h.useSelector((function(e){return e.content.seedProviderPub})),d=h.useSelector((function(e){return e.content.seedInfo})),k=d.seedUrl,y=d.seedToken,N=h.useSelector((function(e){return e.content.availableTokens})),w=h.useSelector((function(e){return e.userProfiles})),S=Object(i.useState)(null),C=Object(o.a)(S,2),P=C[0],T=C[1],D=Object(i.useState)(!1),I=Object(o.a)(D,2),R=I[0],U=I[1],A=Object(i.useState)([]),F=Object(o.a)(A,2),M=F[0],W=F[1],B=Object(i.useState)(""),E=Object(o.a)(B,2),H=E[0],L=E[1],z=Object(i.useState)(!1),J=Object(o.a)(z,2),q=J[0],_=J[1],G=Object(i.useState)(""),K=Object(o.a)(G,2),Q=K[0],V=K[1],X=Object(i.useState)("public"),Y=Object(o.a)(X,2),Z=Y[0],$=Y[1],ee=Object(i.useRef)(null),te=Object(i.useRef)(null),ae=Object(i.useState)(null),ce=Object(o.a)(ae,2),ne=ce[0],re=ce[1],se=Object(i.useState)([]),oe=Object(o.a)(se,2),ie=oe[0],le=oe[1],de=Object(i.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(c,s){var i,l,d,u,b,j,f,h,m,O,x,g,w,S,C,P;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log([H,Q,ie]),H){e.next=5;break}return T("Please input a title"),_(!0),e.abrupt("return");case 5:if(0!==ie.length){e.next=8;break}return T("No selected files"),e.abrupt("return");case 8:return U(!0),i=null,e.prev=10,e.next=13,Object(v.a)({availableTokens:N,seedProviderPub:n,seedToken:y,seedUrl:k,serviceID:s,servicePrice:c});case 13:return l=e.sent,d=l.seedUrl,u=l.tokens,b=l.deleteToken,j=new FormData,Array.from(ie).forEach((function(e){return j.append("files",e)})),j.append("info","extraInfo"),j.append("comment","comment"),e.next=23,fetch("".concat(d,"/api/put_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(u[0])},body:j});case 23:return i=e.sent,e.next=26,i.json();case 26:if(f=e.sent,console.log(f),!f.error||!f.error.message){e.next=33;break}return"The provided token has already been used"===(h=f.error.message)?(T("An error occurred, please try again"),Object(p.g)(d,u[0])(t)):T(h),U(!1),e.abrupt("return");case 33:return m=f.data.torrent,O=m.magnet,x=Object(o.a)(M,1),g=x[0],console.log(g),w="image/embedded","video"===g.type&&(w="video/embedded"),S={type:w,magnetURI:O,width:0,height:0,title:H,description:Q},e.next=42,Object(p.c)(S)(t);case 42:C=e.sent,console.log("content publish complete"),console.log(C),U(!1),b&&Object(p.g)(d,u[0])(t),a.replace("/profile"),e.next=56;break;case 50:e.prev=50,e.t0=e.catch(10),console.error(e.t0),i&&i.text().then((function(e){console.error("Response data as text: ",e)})).catch((function(e){console.error("Could not process bad response data as text: ",e)})),T(null!==(P=null===e.t0||void 0===e.t0?void 0:e.t0.errorMessage)&&void 0!==P?P:null===e.t0||void 0===e.t0?void 0:e.t0.message),U(!1);case 56:case"end":return e.stop()}}),e,null,[[10,50]])})));return function(t,a){return e.apply(this,arguments)}}(),[H,Q,ie,M,N,k,y,a,t,T,n]),ue=Object(i.useCallback)((function(){re(null)}),[re]),be=Object(i.useCallback)((function(){var e=ne.servicePrice,t=ne.serviceID;de(e,t),re(null)}),[ne,de,re]),je=Object(i.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,c,s,o,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=r.a.keys(N);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(c=e.t1.value,!Object.prototype.hasOwnProperty.call(N,c)){e.next=10;break}if(!N[c][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(s="",w[n]&&(s=w[n].SeedServiceProvided),!(a||k&&y)){e.next=18;break}de(),e.next=29;break;case 18:if(!s||!n){e.next=28;break}return e.next=21,j.a.get("/api/gun/otheruser/".concat(n,"/load/offeredServices>").concat(s));case 21:o=e.sent,i=o.data,l=i.data.servicePrice,console.log(i),re({servicePrice:l,serviceID:s}),e.next=29;break;case 28:T("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[N,re,T,de,w,n,y,k]),pe=Object(i.useCallback)(function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),L(""),_(!1),V(""),T(null),re(null),le([]),W([]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[V,L,T,re,le,W]),ve=Object(i.useCallback)((function(e){var t=e.target,a=t.value;switch(t.name){case"title":return _(!1),void L(a);case"description":return void V(a);case"postType":return void $(a);case"createPost":return void console.log("create post");default:return}}),[L,V]),fe=Object(i.useCallback)((function(e){e.preventDefault(),console.log(e.target.files),le(e.target.files);var t=Array.from(e.target.files).map((function(e,t){return console.log("doing file..."),new Promise((function(a){var c=e.type,n=new FileReader;n.onload=function(e){c.startsWith("image/")&&a({type:"image",uri:e.target.result,index:t}),c.startsWith("video/")&&a({type:"video",uri:e.target.result,index:t})},n.readAsDataURL(e)}))}));Promise.allSettled(t).then((function(e){var t=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value)})),console.log(t),W(t)}))}),[le,W]),he=Object(i.useCallback)((function(e){e.preventDefault(),ee.current.click()}),[ee]),me=Object(i.useCallback)((function(e){e.preventDefault(),te.current.click()}),[te]);return Object(g.jsxs)(O.a,{padding:!0,pageTitle:"PUBLISH CONTENT",scrolls:!0,"data-v-97a8edec":"",children:[R?Object(g.jsx)(b.a,{overlay:!0,fullScreen:!0,text:"Publishing content...","data-v-97a8edec":""}):null,Object(g.jsxs)("h2",{"data-v-97a8edec":"",children:["Say Something",Object(g.jsx)("div",{className:"line","data-v-97a8edec":""})]}),Object(g.jsxs)("form",{className:"publish-content-form",onSubmit:je,onReset:pe,"data-v-97a8edec":"",children:[Object(g.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},"data-v-97a8edec":"",children:[Object(g.jsx)("div",{className:"publish-content-title","data-v-97a8edec":"",children:Object(g.jsx)("label",{htmlFor:"title","data-v-97a8edec":"",children:Object(g.jsx)("strong",{"data-v-97a8edec":"",children:"Title"})})}),Object(g.jsxs)("div",{"data-v-97a8edec":"",children:[Object(g.jsxs)("strong",{"data-v-97a8edec":"",children:["Audience:"," ",Object(g.jsx)("i",{className:"fas ".concat("public"===Z?"fa-globe-europe":"fa-credit-card"),"data-v-97a8edec":""})]}),Object(g.jsxs)("select",{name:"postType",id:"postType",onChange:ve,style:{appearance:"none",backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)",marginLeft:"0.3rem"},"data-v-97a8edec":"",children:[Object(g.jsx)("option",{value:"public",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},"data-v-97a8edec":"",children:"Public"}),Object(g.jsx)("option",{value:"private","data-v-97a8edec":"",children:"Paywall"})]})]})]}),Object(g.jsx)("input",{type:"text",name:"title",placeholder:"How I monetized my content with ShockWallet",value:H,onChange:ve,className:u()("input-field",q&&"input-field-error"),"data-v-97a8edec":""}),Object(g.jsx)("div",{className:"publish-content-title","data-v-97a8edec":"",children:Object(g.jsx)("label",{htmlFor:"contents","data-v-97a8edec":"",children:Object(g.jsx)("strong",{"data-v-97a8edec":"",children:"Contents"})})}),Object(g.jsxs)("div",{className:M.length>0?x.displayNone:"publish-content-icons","data-v-97a8edec":"",children:[Object(g.jsx)("i",{className:"fas fa-images publish-content-icon",onClick:he,"data-v-97a8edec":""}),Object(g.jsx)("i",{className:"fas fa-video publish-content-icon",onClick:me,"data-v-97a8edec":""})]}),Object(g.jsxs)("div",{className:u()((e={},Object(c.a)(e,u()("publish-content-preview",x.commonMarginHNegative),M.length>0),Object(c.a)(e,x.displayNone,0===M.length),e)),"data-v-97a8edec":"",children:[M.length>0&&M.map((function(e,t){return"image"===e.type?Object(g.jsx)("img",{alt:"Media preview ".concat(t+1),src:e.uri,width:288,className:"m-1","data-v-97a8edec":""},e.index.toString()):"video"===e.type?Object(g.jsx)("video",{src:e.uri,controls:!0,width:288,className:"m-1","data-v-97a8edec":""},e.index.toString()):(console.error("Unknown type of preview --| ".concat(e.type," |-- found inside <PublishContentPage />")),null)})),Object(g.jsx)("div",{className:"remove-btn",onClick:Object(i.useCallback)((function(){le([]),W([])}),[]),"data-v-97a8edec":"",children:Object(g.jsx)("i",{className:"far fa-trash-alt","data-v-97a8edec":""})})]}),Object(g.jsx)("div",{className:"publish-content-title","data-v-97a8edec":"",children:Object(g.jsx)("label",{htmlFor:"description","data-v-97a8edec":"",children:Object(g.jsx)("strong",{"data-v-97a8edec":"",children:"Description"})})}),Object(g.jsx)("textarea",{name:"description",placeholder:"I made a quick video to show you guys how easy it is to run your own social platform on ShockWallet, and start earning Bitcoin",rows:3,value:Q,onChange:ve,className:"input-field","data-v-97a8edec":""}),P?Object(g.jsx)("p",{className:"error-container","data-v-97a8edec":"",children:P}):null,Object(g.jsxs)("div",{className:"flex-center","data-v-97a8edec":"",children:[Object(g.jsx)("input",{type:"reset",value:"Reset",className:"shock-form-button m-1","data-v-97a8edec":""}),Object(g.jsx)("input",{type:"submit",value:"Submit",className:"shock-form-button-confirm m-1","data-v-97a8edec":""})]})]}),ne&&Object(g.jsx)(m.a,{modalOpen:ne&&!R,toggleModal:ue,"data-v-97a8edec":"",children:Object(g.jsxs)("div",{style:{padding:"1rem"},"data-v-97a8edec":"",children:[Object(g.jsxs)("p",{"data-v-97a8edec":"",children:["The service from the default service provider will cost:"," ",Object(g.jsxs)("strong",{"data-v-97a8edec":"",children:[ne.servicePrice," sats"]})]}),Object(g.jsx)("button",{className:"shock-form-button m-1",onClick:pe,"data-v-97a8edec":"",children:"cancel"}),Object(g.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:be,"data-v-97a8edec":"",children:"confirm"})]})}),Object(g.jsx)("input",{type:"file",id:"file",ref:ee,className:x.displayNone,accept:"image/*",onChange:fe,"data-v-97a8edec":""}),Object(g.jsx)("input",{type:"file",id:"file",ref:te,className:x.displayNone,accept:"video/*",onChange:fe,"data-v-97a8edec":""})]})}}}]);
//# sourceMappingURL=32.039cf0db.chunk.js.map