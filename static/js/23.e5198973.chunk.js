(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[23],{519:function(t,e,n){"use strict";e.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},566:function(t,e,n){"use strict";var r=n(3),i=r.useLayoutEffect;e.a=function(t){var e=Object(r.useRef)(t);return i((function(){e.current=t})),e}},629:function(t,e,n){var r=n(152),i=n(630),a=n(631),o=Math.max,c=Math.min;t.exports=function(t,e,n){var s,u,d,l,b,f,h=0,p=!1,v=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function j(e){var n=s,r=u;return s=u=void 0,h=e,l=t.apply(r,n)}function g(t){return h=t,b=setTimeout(O,e),p?j(t):l}function y(t){var n=t-f;return void 0===f||n>=e||n<0||v&&t-h>=d}function O(){var t=i();if(y(t))return x(t);b=setTimeout(O,function(t){var n=e-(t-f);return v?c(n,d-(t-h)):n}(t))}function x(t){return b=void 0,m&&s?j(t):(s=u=void 0,l)}function w(){var t=i(),n=y(t);if(s=arguments,u=this,f=t,n){if(void 0===b)return g(f);if(v)return clearTimeout(b),b=setTimeout(O,e),j(f)}return void 0===b&&(b=setTimeout(O,e)),l}return e=a(e)||0,r(n)&&(p=!!n.leading,d=(v="maxWait"in n)?o(a(n.maxWait)||0,e):d,m="trailing"in n?!!n.trailing:m),w.cancel=function(){void 0!==b&&clearTimeout(b),h=0,s=f=u=b=void 0},w.flush=function(){return void 0===b?l:x(i())},w}},630:function(t,e,n){var r=n(76);t.exports=function(){return r.Date.now()}},631:function(t,e,n){var r=n(632),i=n(152),a=n(634),o=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(a(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=r(t);var n=c.test(t);return n||s.test(t)?u(t.slice(2),n?2:8):o.test(t)?NaN:+t}},632:function(t,e,n){var r=n(633),i=/^\s+/;t.exports=function(t){return t?t.slice(0,r(t)+1).replace(i,""):t}},633:function(t,e){var n=/\s/;t.exports=function(t){for(var e=t.length;e--&&n.test(t.charAt(e)););return e}},634:function(t,e,n){var r=n(155),i=n(257);t.exports=function(t){return"symbol"==typeof t||i(t)&&"[object Symbol]"==r(t)}},635:function(t,e,n){},636:function(t,e,n){},764:function(t,e,n){"use strict";n.r(e);var r=n(16),i=n(3),a=n(22),o=n(40),c=n(12),s=n(31),u=n(566),d=function(t,e){"function"!==typeof t?t.current=e:t(e)},l=function(t,e){var n=Object(i.useRef)();return Object(i.useCallback)((function(r){t.current=r,n.current&&d(n.current,null),n.current=e,e&&d(e,r)}),[e])},b={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},f=function(t){Object.keys(b).forEach((function(e){t.style.setProperty(e,b[e],"important")}))},h=null;var p=function(){},v=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],m=!!document.documentElement.currentStyle,j=function(t,e){var n=t.cacheMeasurements,r=t.maxRows,a=t.minRows,o=t.onChange,d=void 0===o?p:o,b=t.onHeightChange,j=void 0===b?p:b,g=Object(s.a)(t,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var y=void 0!==g.value,O=Object(i.useRef)(null),x=l(O,e),w=Object(i.useRef)(0),S=Object(i.useRef)(),L=function(){var t=O.current,e=n&&S.current?S.current:function(t){var e=window.getComputedStyle(t);if(null===e)return null;var n,r=(n=e,v.reduce((function(t,e){return t[e]=n[e],t}),{})),i=r.boxSizing;return""===i?null:(m&&"border-box"===i&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})}(t);if(e){S.current=e;var i=function(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),h||((h=document.createElement("textarea")).setAttribute("tab-index","-1"),h.setAttribute("aria-hidden","true"),f(h)),null===h.parentNode&&document.body.appendChild(h);var i=t.paddingSize,a=t.borderSize,o=t.sizingStyle,c=o.boxSizing;Object.keys(o).forEach((function(t){var e=t;h.style[e]=o[e]})),f(h),h.value=e;var s=function(t,e){var n=t.scrollHeight;return"border-box"===e.sizingStyle.boxSizing?n+e.borderSize:n-e.paddingSize}(h,t);h.value="x";var u=h.scrollHeight-i,d=u*n;"border-box"===c&&(d=d+i+a),s=Math.max(d,s);var l=u*r;return"border-box"===c&&(l=l+i+a),[s=Math.min(l,s),u]}(e,t.value||t.placeholder||"x",a,r),o=i[0],c=i[1];w.current!==o&&(w.current=o,t.style.setProperty("height",o+"px","important"),j(o,{rowHeight:c}))}};return Object(i.useLayoutEffect)(L),function(t){var e=Object(u.a)(t);Object(i.useLayoutEffect)((function(){var t=function(t){e.current(t)};return window.addEventListener("resize",t),function(){window.removeEventListener("resize",t)}}),[])}(L),Object(i.createElement)("textarea",Object(c.a)({},g,{onChange:function(t){y||L(),d(t)},ref:x}))},g=Object(i.forwardRef)(j),y=n(72),O=n.n(y),x=n(629),w=n.n(x),S=n(112),L=n(83),k=n(504),N=n(25);function V(){return(V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var C=new Map,F=new Map,M=0;function T(t){return Object.keys(t).sort().filter((function(e){return void 0!==t[e]})).map((function(e){return e+"_"+("root"===e?(n=t.root)?(F.has(n)||(M+=1,F.set(n,M.toString())),F.get(n)):"0":t[e]);var n})).toString()}function E(t,e,n){if(void 0===n&&(n={}),!t)return function(){};var r=function(t){var e=T(t),n=C.get(e);if(!n){var r,i=new Map,a=new IntersectionObserver((function(e){e.forEach((function(e){var n,a=e.isIntersecting&&r.some((function(t){return e.intersectionRatio>=t}));t.trackVisibility&&"undefined"===typeof e.isVisible&&(e.isVisible=a),null==(n=i.get(e.target))||n.forEach((function(t){t(a,e)}))}))}),t);r=a.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),n={id:e,observer:a,elements:i},C.set(e,n)}return n}(n),i=r.id,a=r.observer,o=r.elements,c=o.get(t)||[];return o.has(t)||o.set(t,c),c.push(e),a.observe(t),function(){c.splice(c.indexOf(e),1),0===c.length&&(o.delete(t),a.unobserve(t)),0===o.size&&(a.disconnect(),C.delete(i))}}function R(t){return"function"!==typeof t.children}var z=function(t){var e,n;function r(e){var n;return(n=t.call(this,e)||this).node=null,n._unobserveCb=null,n.handleNode=function(t){n.node&&(n.unobserve(),t||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=t||null,n.observeNode()},n.handleChange=function(t,e){t&&n.props.triggerOnce&&n.unobserve(),R(n.props)||n.setState({inView:t,entry:e}),n.props.onChange&&n.props.onChange(t,e)},n.state={inView:!!e.initialInView,entry:void 0},n}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var a=r.prototype;return a.componentDidUpdate=function(t){t.rootMargin===this.props.rootMargin&&t.root===this.props.root&&t.threshold===this.props.threshold&&t.skip===this.props.skip&&t.trackVisibility===this.props.trackVisibility&&t.delay===this.props.delay||(this.unobserve(),this.observeNode())},a.componentWillUnmount=function(){this.unobserve(),this.node=null},a.observeNode=function(){if(this.node&&!this.props.skip){var t=this.props,e=t.threshold,n=t.root,r=t.rootMargin,i=t.trackVisibility,a=t.delay;this._unobserveCb=E(this.node,this.handleChange,{threshold:e,root:n,rootMargin:r,trackVisibility:i,delay:a})}},a.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},a.render=function(){if(!R(this.props)){var t=this.state,e=t.inView,n=t.entry;return this.props.children({inView:e,entry:n,ref:this.handleNode})}var r=this.props,a=r.children,o=r.as,c=r.tag,s=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(r,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(i.createElement)(o||c||"div",V({ref:this.handleNode},s),a)},r}(i.Component);z.displayName="InView",z.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var I=n(484),D=n(496),W=n(482),_=n(89),A=(n(635),n(7)),K={threshold:.2},H=function(t){var e=t.text,n=void 0===e?"":e,r=t.receivedMessage,a=void 0!==r&&r,o=t.publicKey,c=void 0===o?"":o,s=t.timestamp,u=t.onInView,d=void 0===u?_.a:u,l=t.onOutView,b=void 0===l?_.a:l,f=t.id,h=function(t){var e=void 0===t?{}:t,n=e.threshold,r=e.delay,a=e.trackVisibility,o=e.rootMargin,c=e.root,s=e.triggerOnce,u=e.skip,d=e.initialInView,l=Object(i.useRef)(),b=Object(i.useState)({inView:!!d}),f=b[0],h=b[1],p=Object(i.useCallback)((function(t){void 0!==l.current&&(l.current(),l.current=void 0),u||t&&(l.current=E(t,(function(t,e){h({inView:t,entry:e}),e.isIntersecting&&s&&l.current&&(l.current(),l.current=void 0)}),{root:c,rootMargin:o,threshold:n,trackVisibility:a,delay:r}))}),[Array.isArray(n)?n.toString():n,c,o,s,u,a,r]);Object(i.useEffect)((function(){l.current||!f.entry||s||u||h({inView:!!d})}));var v=[p,f.inView,f.entry];return v.ref=v[0],v.inView=v[1],v.entry=v[2],v}(K),p=h.inView,v=h.ref;return Object(i.useEffect)((function(){p?d(f):b(f)}),[f,p,d,b]),Object(A.jsxs)("div",{className:O()({"chat-message":!0,"chat-message-received":a}),ref:v,"data-v-4db7690a":"",children:[a&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(D.a,{height:48,publicKey:c,"data-v-4db7690a":""}),Object(A.jsx)(I.a,{amt:16,insideRow:!0,"data-v-4db7690a":""})]}),Object(A.jsx)("p",{className:"chat-message-text","data-v-4db7690a":"",children:n}),Object(A.jsx)(I.a,{amt:8,insideRow:!0,"data-v-4db7690a":""}),function(){try{var t=N.k(s),e=S.DateTime.fromMillis(t).toLocaleString(S.DateTime.TIME_SIMPLE);return Object(A.jsx)("div",{className:O()(W.u),"data-v-4db7690a":"",children:Object(A.jsx)("p",{className:W.n,"data-v-4db7690a":"",children:e})})}catch(n){return console.log(n),null}}()]})},q=n(24),P=n(519),B=(n(636),n(18)),U=n(20);Object(L.b)();e.default=function(){var t=Object(o.b)(),e=Object(a.i)().publicKey,n=B.useSelector(B.selectUser(e)),c=Object(i.useState)(""),s=Object(r.a)(c,2),u=s[0],d=s[1],l=Object(i.useState)(!1),b=Object(r.a)(l,2),f=b[0],h=b[1],p=Object(i.useState)(-1),v=Object(r.a)(p,2),m=v[0],j=v[1],y=Object(i.useMemo)((function(){return{top:m+8+"px"}}),[m]),x=Object(i.useCallback)((function(t){j(t)}),[j]),N=w()((function(){f||(h(!0),setTimeout((function(){h(!1)}),1500))})),V=B.useSelector((function(t){return t.chat.messages[e]})),C=B.useSelector((function(t){var n=t.chat;return Object(_.c)(n.contacts,e)})),F=B.useSelector((function(t){var n=t.chat;return Object(_.c)(n.sentRequests,e)})),M=B.useSelector((function(t){var n=t.chat;return Object(_.c)(n.receivedRequests,e)})),T=B.useSelector((function(t){return t.node.publicKey})),E=!C&&F,R=!C&&M,z=Object(i.useCallback)((function(t){d(t.target.value)}),[]),I=Object(i.useCallback)((function(){console.log(M),M&&Object(q.b)(M.id)(t)}),[M,t]),D=Object(i.useCallback)((function(n){if("Enter"!==n.key||!n.ctrlKey)return"Enter"===n.key?(n.preventDefault(),t(Object(q.g)({message:u,publicKey:e})),void d("")):void 0;d(u+"\r\n")}),[u,e,t]),K=Object(i.useCallback)((function(){var n=t(Object(q.h)(T,e));return Object(U.f)(n)}),[t,T,e]);Object(i.useEffect)((function(){return K()}),[K]);var $=Object(i.useState)(new Set),J=Object(r.a)($,2),Y=J[0],G=J[1],Q=Object(i.useMemo)((function(){if(0===Y.size)return[S.DateTime.now().valueOf(),Date.now().valueOf()];var t=Array.from(Y).map((function(t){return V.find((function(e){return e.id===t}))})).filter((function(t){return!!t})).sort((function(t,e){return e.timestamp-t.timestamp}));return[t[0].timestamp,t[t.length-1].timestamp]}),[V,Y]),X=Object(r.a)(Q,2),Z=X[0],tt=X[1],et=Object(i.useCallback)((function(t){G(Object(L.a)((function(e){e.add(t)})))}),[G]),nt=Object(i.useCallback)((function(t){G(Object(L.a)((function(e){e.delete(t)})))}),[G]),rt=n.displayName;return Object(A.jsxs)("div",{className:"page-container","data-v-6da333bb":"",children:[Object(A.jsx)(k.a,{solid:!0,pageTitle:rt,enableBackButton:!0,onHeight:x,"data-v-6da333bb":""}),Object(A.jsx)("div",{className:"chat-messages-container",onScroll:N,"data-v-6da333bb":"",children:null===V||void 0===V?void 0:V.map((function(t){return Object(A.jsx)(H,{text:t.body,receivedMessage:!t.outgoing,publicKey:t.recipientPublicKey,timestamp:t.timestamp,onInView:et,onOutView:nt,id:t.id,"data-v-6da333bb":""})}))}),Object(A.jsx)("div",{className:O()(W.p,W.b,W.c,W.d),style:y,"data-v-6da333bb":"",children:Object(A.jsx)("span",{className:O()(W.n,"chat-date-bubble",f?W.r:W.q),"data-v-6da333bb":"",children:function(){var t=S.DateTime.fromMillis(Z).startOf("day"),e=S.DateTime.fromMillis(tt).startOf("day"),n=S.DateTime.now().startOf("day"),r=S.DateTime.now().minus({day:1}).startOf("day"),i=t.hasSame(n,"year")&&e.hasSame(n,"year");if((t||e).hasSame(e,"day"))return t.hasSame(n,"day")?"Today":t.hasSame(r,"day")?"Yesterday":i?t.toFormat("LLLL d"):t.toLocaleString(S.DateTime.DATE_FULL);if(t.hasSame(e,"month")){var a=e.toFormat("d"),o=t.toFormat("d"),c=(t||e).toFormat("LLLL");if(i)return"".concat(c," ").concat(a," - ").concat(o);var s=t.toFormat("y");return"".concat(c," ").concat(a," - ").concat(o,", ").concat(s)}if(i){var u=e.toFormat("d"),d=t.toFormat("d"),l=e.toFormat("LLLL"),b=t.toFormat("LLLL");return"".concat(l," ").concat(u," - ").concat(b," ").concat(d)}var f=e.toFormat("d"),h=t.toFormat("d"),p=e.toFormat("LLLL"),v=t.toFormat("LLLL"),m=e.toFormat("y"),j=t.toFormat("y");return"".concat(p," ").concat(f,", ").concat(m," - ").concat(v," ").concat(h,", ").concat(j)}()})}),R?Object(A.jsxs)("div",{className:"chat-permission-bar","data-v-6da333bb":"",children:[Object(A.jsxs)("p",{className:"chat-permission-bar-title unselectable","data-v-6da333bb":"",children:[rt," has sent you a chat request!"]}),Object(A.jsxs)("p",{className:"chat-permission-bar-text","data-v-6da333bb":"",children:["Once you accept the request, you'll be able to chat and send invoices to ",rt]}),Object(A.jsxs)("div",{className:"chat-permission-bar-actions unselectable","data-v-6da333bb":"",children:[Object(A.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:I,"data-v-6da333bb":"",children:"Accept"}),Object(A.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline","data-v-6da333bb":"",children:"Decline"})]})]}):E?Object(A.jsxs)("div",{className:"chat-permission-bar","data-v-6da333bb":"",children:[Object(A.jsxs)("p",{className:"chat-permission-bar-title","data-v-6da333bb":"",children:["Your request has been sent to ",rt," successfully"]}),Object(A.jsxs)("p",{className:"chat-permission-bar-text unselectable","data-v-6da333bb":"",children:["Once ",rt," accepts the request, you'll be able to chat with them"]})]}):Object(A.jsx)("div",{className:"chat-bottom-bar","data-v-6da333bb":"",children:Object(A.jsxs)("div",{className:"chat-input-container","data-v-6da333bb":"",children:[Object(A.jsx)("div",{className:"chat-input-btn unselectable","data-v-6da333bb":"",children:Object(A.jsx)("img",{src:P.a,alt:"Menu","data-v-6da333bb":""})}),Object(A.jsx)(g,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:D,onChange:z,value:u,height:20,"data-v-6da333bb":""})]})})]})}}}]);
//# sourceMappingURL=23.e5198973.chunk.js.map