(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[20],{494:function(e,t,n){"use strict";var i=n(3),r=n(73),a=n.n(r),o=(n(495),n(37)),c=n(60),s=n(77),u=n(492),l=n(21),d=n(7);t.a=function(e){var t=e.pageTitle,n=e.absolute,r=void 0!==n&&n,b=e.solid,h=void 0!==b&&b,f=e.enableBackButton,p=void 0!==f&&f,v=e.onHeight,m=void 0===v?c.a:v,j=Object(o.c)(),g=Object(i.useCallback)((function(){window.history.back()}),[]),O=Object(i.useCallback)((function(){j(Object(s.c)())}),[j]),y=Object(l.useSelector)((function(e){return e.node.publicKey})),x=Object(i.useCallback)((function(e){if(e)try{m(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in MainNav:"),console.log(t)}}),[m]);return Object(d.jsxs)("div",{className:a()({"main-nav-container":!0,"main-nav-absolute":r,"main-nav-solid":h}),ref:x,children:[p?Object(d.jsx)("div",{className:"main-nav-back",onClick:g,children:Object(d.jsx)("i",{className:"icon icon-thin-back"})}):Object(d.jsx)(u.a,{disableOnlineRing:!0,height:40,publicKey:y}),Object(d.jsx)("p",{className:"main-nav-title unselectable",children:t}),Object(d.jsxs)("div",{className:"main-nav-menu-btn",onClick:O,children:[Object(d.jsx)("div",{className:"main-nav-menu-dash"}),Object(d.jsx)("div",{className:"main-nav-menu-dash"}),Object(d.jsx)("div",{className:"main-nav-menu-dash"})]})]})}},495:function(e,t,n){},529:function(e,t,n){"use strict";t.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},575:function(e,t,n){"use strict";var i=n(3),r=i.useLayoutEffect;t.a=function(e){var t=Object(i.useRef)(e);return r((function(){t.current=e})),t}},629:function(e,t,n){var i=n(153),r=n(630),a=n(631),o=Math.max,c=Math.min;e.exports=function(e,t,n){var s,u,l,d,b,h,f=0,p=!1,v=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function j(t){var n=s,i=u;return s=u=void 0,f=t,d=e.apply(i,n)}function g(e){return f=e,b=setTimeout(y,t),p?j(e):d}function O(e){var n=e-h;return void 0===h||n>=t||n<0||v&&e-f>=l}function y(){var e=r();if(O(e))return x(e);b=setTimeout(y,function(e){var n=t-(e-h);return v?c(n,l-(e-f)):n}(e))}function x(e){return b=void 0,m&&s?j(e):(s=u=void 0,d)}function w(){var e=r(),n=O(e);if(s=arguments,u=this,h=e,n){if(void 0===b)return g(h);if(v)return clearTimeout(b),b=setTimeout(y,t),j(h)}return void 0===b&&(b=setTimeout(y,t)),d}return t=a(t)||0,i(n)&&(p=!!n.leading,l=(v="maxWait"in n)?o(a(n.maxWait)||0,t):l,m="trailing"in n?!!n.trailing:m),w.cancel=function(){void 0!==b&&clearTimeout(b),f=0,s=h=u=b=void 0},w.flush=function(){return void 0===b?d:x(r())},w}},630:function(e,t,n){var i=n(78);e.exports=function(){return i.Date.now()}},631:function(e,t,n){var i=n(632),r=n(153),a=n(634),o=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(a(e))return NaN;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=c.test(e);return n||s.test(e)?u(e.slice(2),n?2:8):o.test(e)?NaN:+e}},632:function(e,t,n){var i=n(633),r=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(r,""):e}},633:function(e,t){var n=/\s/;e.exports=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},634:function(e,t,n){var i=n(155),r=n(258);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},635:function(e,t,n){},636:function(e,t,n){},754:function(e,t,n){"use strict";n.r(t);var i=n(2),r=n.n(i),a=n(5),o=n(17),c=n(3),s=n(22),u=n(37),l=n(12),d=n(31),b=n(575),h=function(e,t){"function"!==typeof e?e.current=t:e(t)},f=function(e,t){var n=Object(c.useRef)();return Object(c.useCallback)((function(i){e.current=i,n.current&&h(n.current,null),n.current=t,t&&h(t,i)}),[t])},p={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},v=function(e){Object.keys(p).forEach((function(t){e.style.setProperty(t,p[t],"important")}))},m=null;var j=function(){},g=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],O=!!document.documentElement.currentStyle,y=function(e,t){var n=e.cacheMeasurements,i=e.maxRows,r=e.minRows,a=e.onChange,o=void 0===a?j:a,s=e.onHeightChange,u=void 0===s?j:s,h=Object(d.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var p=void 0!==h.value,y=Object(c.useRef)(null),x=f(y,t),w=Object(c.useRef)(0),S=Object(c.useRef)(),k=function(){var e=y.current,t=n&&S.current?S.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,i=(n=t,g.reduce((function(e,t){return e[t]=n[t],e}),{})),r=i.boxSizing;return""===r?null:(O&&"border-box"===r&&(i.width=parseFloat(i.width)+parseFloat(i.borderRightWidth)+parseFloat(i.borderLeftWidth)+parseFloat(i.paddingRight)+parseFloat(i.paddingLeft)+"px"),{sizingStyle:i,paddingSize:parseFloat(i.paddingBottom)+parseFloat(i.paddingTop),borderSize:parseFloat(i.borderBottomWidth)+parseFloat(i.borderTopWidth)})}(e);if(t){S.current=t;var a=function(e,t,n,i){void 0===n&&(n=1),void 0===i&&(i=1/0),m||((m=document.createElement("textarea")).setAttribute("tab-index","-1"),m.setAttribute("aria-hidden","true"),v(m)),null===m.parentNode&&document.body.appendChild(m);var r=e.paddingSize,a=e.borderSize,o=e.sizingStyle,c=o.boxSizing;Object.keys(o).forEach((function(e){var t=e;m.style[t]=o[t]})),v(m),m.value=t;var s=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(m,e);m.value="x";var u=m.scrollHeight-r,l=u*n;"border-box"===c&&(l=l+r+a),s=Math.max(l,s);var d=u*i;return"border-box"===c&&(d=d+r+a),[s=Math.min(d,s),u]}(t,e.value||e.placeholder||"x",r,i),o=a[0],c=a[1];w.current!==o&&(w.current=o,e.style.setProperty("height",o+"px","important"),u(o,{rowHeight:c}))}};return Object(c.useLayoutEffect)(k),function(e){var t=Object(b.a)(e);Object(c.useLayoutEffect)((function(){var e=function(e){t.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[])}(k),Object(c.createElement)("textarea",Object(l.a)({},h,{onChange:function(e){p||k(),o(e)},ref:x}))},x=Object(c.forwardRef)(y),w=n(73),S=n.n(w),k=n(629),N=n.n(k),L=n(113),C=n(84),V=n(494),F=n(20);function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var T=new Map,E=new Map,R=0;function z(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(E.has(n)||(R+=1,E.set(n,R.toString())),E.get(n)):"0":e[t]);var n})).toString()}function I(e,t,n){if(void 0===n&&(n={}),!e)return function(){};var i=function(e){var t=z(e),n=T.get(t);if(!n){var i,r=new Map,a=new IntersectionObserver((function(t){t.forEach((function(t){var n,a=t.isIntersecting&&i.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=a),null==(n=r.get(t.target))||n.forEach((function(e){e(a,t)}))}))}),e);i=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:a,elements:r},T.set(t,n)}return n}(n),r=i.id,a=i.observer,o=i.elements,c=o.get(e)||[];return o.has(e)||o.set(e,c),c.push(t),a.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(o.delete(e),a.unobserve(e)),0===o.size&&(a.disconnect(),T.delete(r))}}function D(e){return"function"!==typeof e.children}var K=function(e){var t,n;function i(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),D(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=i.prototype;return r.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},r.componentWillUnmount=function(){this.unobserve(),this.node=null},r.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,i=e.rootMargin,r=e.trackVisibility,a=e.delay;this._unobserveCb=I(this.node,this.handleChange,{threshold:t,root:n,rootMargin:i,trackVisibility:r,delay:a})}},r.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},r.render=function(){if(!D(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var i=this.props,r=i.children,a=i.as,o=i.tag,s=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(i,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(c.createElement)(a||o||"div",M({ref:this.handleNode},s),r)},i}(c.Component);K.displayName="InView",K.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var W=n(498),_=n(492),A=n(491),H=n(60),B=(n(635),n(7)),P={threshold:.2},q=function(e){var t=e.text,n=void 0===t?"":t,i=e.receivedMessage,r=void 0!==i&&i,a=e.publicKey,o=void 0===a?"":a,s=e.timestamp,u=e.onInView,l=void 0===u?H.a:u,d=e.onOutView,b=void 0===d?H.a:d,h=e.id,f=function(e){var t=void 0===e?{}:e,n=t.threshold,i=t.delay,r=t.trackVisibility,a=t.rootMargin,o=t.root,s=t.triggerOnce,u=t.skip,l=t.initialInView,d=Object(c.useRef)(),b=Object(c.useState)({inView:!!l}),h=b[0],f=b[1],p=Object(c.useCallback)((function(e){void 0!==d.current&&(d.current(),d.current=void 0),u||e&&(d.current=I(e,(function(e,t){f({inView:e,entry:t}),t.isIntersecting&&s&&d.current&&(d.current(),d.current=void 0)}),{root:o,rootMargin:a,threshold:n,trackVisibility:r,delay:i}))}),[Array.isArray(n)?n.toString():n,o,a,s,u,r,i]);Object(c.useEffect)((function(){d.current||!h.entry||s||u||f({inView:!!l})}));var v=[p,h.inView,h.entry];return v.ref=v[0],v.inView=v[1],v.entry=v[2],v}(P),p=f.inView,v=f.ref;return Object(c.useEffect)((function(){p?l(h):b(h)}),[h,p,l,b]),Object(B.jsxs)("div",{className:S()({"chat-message":!0,"chat-message-received":r}),ref:v,children:[r&&Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(_.a,{height:48,publicKey:o}),Object(B.jsx)(W.a,{amt:16,insideRow:!0})]}),Object(B.jsx)("p",{className:"chat-message-text",children:n}),Object(B.jsx)(W.a,{amt:8,insideRow:!0}),function(){try{var e=F.h(s),t=L.DateTime.fromMillis(e).toLocaleString(L.DateTime.TIME_SIMPLE);return Object(B.jsx)("div",{className:S()(A.s),children:Object(B.jsx)("p",{className:A.l,children:t})})}catch(n){return console.log(n),null}}()]})},U=n(24),$=n(529),J=(n(636),n(21));Object(C.b)();t.default=function(){var e=Object(u.c)(),t=Object(s.i)().publicKey,n=J.useSelector(J.selectUser(t)),i=Object(c.useState)(""),l=Object(o.a)(i,2),d=l[0],b=l[1],h=Object(c.useState)(!1),f=Object(o.a)(h,2),p=f[0],v=f[1],m=Object(c.useState)(-1),j=Object(o.a)(m,2),g=j[0],O=j[1],y=Object(c.useMemo)((function(){return{top:g+8+"px"}}),[g]),w=Object(c.useCallback)((function(e){O(e)}),[O]),k=N()((function(){p||(v(!0),setTimeout((function(){v(!1)}),1500))})),F=J.useSelector((function(e){return e.chat.messages[t]})),M=J.useSelector((function(e){var n=e.chat;return Object(H.c)(n.contacts,t)})),T=J.useSelector((function(e){var n=e.chat;return Object(H.c)(n.sentRequests,t)})),E=J.useSelector((function(e){var n=e.chat;return Object(H.c)(n.receivedRequests,t)})),R=J.useSelector((function(e){return e.node.publicKey})),z=!M&&T,I=!M&&E,D=Object(c.useCallback)((function(e){b(e.target.value)}),[]),K=Object(c.useCallback)((function(){console.log(E),E&&Object(U.b)(E.id)(e)}),[E,e]),W=Object(c.useCallback)((function(n){if("Enter"!==n.key||!n.ctrlKey)return"Enter"===n.key?(n.preventDefault(),e(Object(U.g)({message:d,publicKey:t})),void b("")):void 0;b(d+"\r\n")}),[d,t,e]),_=Object(c.useCallback)((function(){var n=e(Object(U.h)(R,t));return Object(a.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:null===(t=e.sent)||void 0===t||t.close();case 4:case"end":return e.stop()}}),e)})))}),[e,R,t]);Object(c.useEffect)((function(){var e=_();return function(){e()}}),[_]);var P=Object(c.useState)(new Set),Y=Object(o.a)(P,2),G=Y[0],Q=Y[1],X=Object(c.useMemo)((function(){if(0===G.size)return[L.DateTime.now().valueOf(),Date.now().valueOf()];var e=Array.from(G).map((function(e){return F.find((function(t){return t.id===e}))})).filter((function(e){return!!e})).sort((function(e,t){return t.timestamp-e.timestamp}));return[e[0].timestamp,e[e.length-1].timestamp]}),[F,G]),Z=Object(o.a)(X,2),ee=Z[0],te=Z[1],ne=Object(c.useCallback)((function(e){Q(Object(C.a)((function(t){t.add(e)})))}),[Q]),ie=Object(c.useCallback)((function(e){Q(Object(C.a)((function(t){t.delete(e)})))}),[Q]),re=n.displayName;return Object(B.jsxs)("div",{className:"page-container",children:[Object(B.jsx)(V.a,{solid:!0,pageTitle:re,enableBackButton:!0,onHeight:w}),Object(B.jsx)("div",{className:"chat-messages-container",onScroll:k,children:null===F||void 0===F?void 0:F.map((function(e){return Object(B.jsx)(q,{text:e.body,receivedMessage:!e.outgoing,publicKey:e.recipientPublicKey,timestamp:e.timestamp,onInView:ne,onOutView:ie,id:e.id})}))}),Object(B.jsx)("div",{className:S()(A.n,A.b,A.c,A.d),style:y,children:Object(B.jsx)("span",{className:S()(A.l,"chat-date-bubble",p?A.p:A.o),children:function(){var e=L.DateTime.fromMillis(ee).startOf("day"),t=L.DateTime.fromMillis(te).startOf("day"),n=L.DateTime.now().startOf("day"),i=L.DateTime.now().minus({day:1}).startOf("day"),r=e.hasSame(n,"year")&&t.hasSame(n,"year");if((e||t).hasSame(t,"day"))return e.hasSame(n,"day")?"Today":e.hasSame(i,"day")?"Yesterday":r?e.toFormat("LLLL d"):e.toLocaleString(L.DateTime.DATE_FULL);if(e.hasSame(t,"month")){var a=t.toFormat("d"),o=e.toFormat("d"),c=(e||t).toFormat("LLLL");if(r)return"".concat(c," ").concat(a," - ").concat(o);var s=e.toFormat("y");return"".concat(c," ").concat(a," - ").concat(o,", ").concat(s)}if(r){var u=t.toFormat("d"),l=e.toFormat("d"),d=t.toFormat("LLLL"),b=e.toFormat("LLLL");return"".concat(d," ").concat(u," - ").concat(b," ").concat(l)}var h=t.toFormat("d"),f=e.toFormat("d"),p=t.toFormat("LLLL"),v=e.toFormat("LLLL"),m=t.toFormat("y"),j=e.toFormat("y");return"".concat(p," ").concat(h,", ").concat(m," - ").concat(v," ").concat(f,", ").concat(j)}()})}),I?Object(B.jsxs)("div",{className:"chat-permission-bar",children:[Object(B.jsxs)("p",{className:"chat-permission-bar-title unselectable",children:[re," has sent you a chat request!"]}),Object(B.jsxs)("p",{className:"chat-permission-bar-text",children:["Once you accept the request, you'll be able to chat and send invoices to ",re]}),Object(B.jsxs)("div",{className:"chat-permission-bar-actions unselectable",children:[Object(B.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:K,children:"Accept"}),Object(B.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline",children:"Decline"})]})]}):z?Object(B.jsxs)("div",{className:"chat-permission-bar",children:[Object(B.jsxs)("p",{className:"chat-permission-bar-title",children:["Your request has been sent to ",re," successfully"]}),Object(B.jsxs)("p",{className:"chat-permission-bar-text unselectable",children:["Once ",re," accepts the request, you'll be able to chat with them"]})]}):Object(B.jsx)("div",{className:"chat-bottom-bar",children:Object(B.jsxs)("div",{className:"chat-input-container",children:[Object(B.jsx)("div",{className:"chat-input-btn unselectable",children:Object(B.jsx)("img",{src:$.a,alt:"Menu"})}),Object(B.jsx)(x,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:W,onChange:D,value:d,height:20})]})})]})}}}]);
//# sourceMappingURL=20.8c658499.chunk.js.map