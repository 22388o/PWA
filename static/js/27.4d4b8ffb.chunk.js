(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[27],{615:function(e,t,n){"use strict";var c=n(0),a=n(88),i=n.n(a),r=(n(616),n(38)),o=n(7),s=n(91),u=n(610),l=n(19),d=n(4),b=function(e){var t=e.pageTitle,n=e.absolute,a=void 0!==n&&n,b=e.solid,h=void 0!==b&&b,f=e.enableBackButton,v=void 0!==f&&f,m=e.onHeight,p=void 0===m?o.b:m,j=Object(r.b)(),O=Object(c.useCallback)((function(){window.history.back()}),[]),g=Object(c.useCallback)((function(){j(Object(s.c)())}),[j]),y=Object(l.useSelector)((function(e){return e.node.publicKey})),x=Object(c.useCallback)((function(e){if(e)try{p(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in MainNav:"),console.log(t)}}),[p]);return Object(d.jsxs)("div",{className:i()({"main-nav-container":!0,"main-nav-absolute":a,"main-nav-solid":h}),ref:x,"data-v-933595cd":"",children:[v?Object(d.jsx)("div",{className:"main-nav-back",onClick:O,"data-v-933595cd":"",children:Object(d.jsx)("i",{className:"icon icon-thin-back","data-v-933595cd":""})}):Object(d.jsx)(u.a,{height:40,publicKey:y,"data-v-933595cd":""}),Object(d.jsx)("p",{className:"main-nav-title unselectable","data-v-933595cd":"",children:t}),Object(d.jsxs)("div",{className:"main-nav-menu-btn",onClick:g,"data-v-933595cd":"",children:[Object(d.jsx)("div",{className:"main-nav-menu-dash","data-v-933595cd":""}),Object(d.jsx)("div",{className:"main-nav-menu-dash","data-v-933595cd":""}),Object(d.jsx)("div",{className:"main-nav-menu-dash","data-v-933595cd":""})]})]})};t.a=Object(c.memo)(b)},616:function(e,t,n){},663:function(e,t,n){"use strict";t.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},676:function(e,t,n){"use strict";var c=n(0),a=c.useLayoutEffect;t.a=function(e){var t=Object(c.useRef)(e);return a((function(){t.current=e})),t}},737:function(e,t,n){},738:function(e,t,n){},739:function(e,t,n){},909:function(e,t,n){"use strict";n.r(t);var c=n(49),a=n(13),i=n(0),r=n.n(i),o=n(26),s=n(21),u=n(37),l=n(676),d=function(e,t){"function"!==typeof e?e.current=t:e(t)},b=function(e,t){var n=Object(i.useRef)();return Object(i.useCallback)((function(c){e.current=c,n.current&&d(n.current,null),n.current=t,t&&d(t,c)}),[t])},h={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},f=function(e){Object.keys(h).forEach((function(t){e.style.setProperty(t,h[t],"important")}))},v=null;var m=function(){},p=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],j=!!document.documentElement.currentStyle,O=function(e,t){var n=e.cacheMeasurements,c=e.maxRows,a=e.minRows,r=e.onChange,o=void 0===r?m:r,d=e.onHeightChange,h=void 0===d?m:d,O=Object(u.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var g=void 0!==O.value,y=Object(i.useRef)(null),x=b(y,t),w=Object(i.useRef)(0),k=Object(i.useRef)(),C=function(){var e=y.current,t=n&&k.current?k.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,c=(n=t,p.reduce((function(e,t){return e[t]=n[t],e}),{})),a=c.boxSizing;return""===a?null:(j&&"border-box"===a&&(c.width=parseFloat(c.width)+parseFloat(c.borderRightWidth)+parseFloat(c.borderLeftWidth)+parseFloat(c.paddingRight)+parseFloat(c.paddingLeft)+"px"),{sizingStyle:c,paddingSize:parseFloat(c.paddingBottom)+parseFloat(c.paddingTop),borderSize:parseFloat(c.borderBottomWidth)+parseFloat(c.borderTopWidth)})}(e);if(t){k.current=t;var i=function(e,t,n,c){void 0===n&&(n=1),void 0===c&&(c=1/0),v||((v=document.createElement("textarea")).setAttribute("tab-index","-1"),v.setAttribute("aria-hidden","true"),f(v)),null===v.parentNode&&document.body.appendChild(v);var a=e.paddingSize,i=e.borderSize,r=e.sizingStyle,o=r.boxSizing;Object.keys(r).forEach((function(e){var t=e;v.style[t]=r[t]})),f(v),v.value=t;var s=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(v,e);v.value="x";var u=v.scrollHeight-a,l=u*n;"border-box"===o&&(l=l+a+i),s=Math.max(l,s);var d=u*c;return"border-box"===o&&(d=d+a+i),[s=Math.min(d,s),u]}(t,e.value||e.placeholder||"x",a,c),r=i[0],o=i[1];w.current!==r&&(w.current=r,e.style.setProperty("height",r+"px","important"),h(r,{rowHeight:o}))}};return Object(i.useLayoutEffect)(C),function(e){var t=Object(l.a)(e);Object(i.useLayoutEffect)((function(){var e=function(e){t.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[])}(C),Object(i.createElement)("textarea",Object(s.a)({},O,{onChange:function(e){g||C(),o(e)},ref:x}))},g=Object(i.forwardRef)(O),y=n(88),x=n.n(y),w=n(185),k=n(28),C=n(9),S=n(615),L=n(1),N=n(102),V=n(4),M=function(e){var t=e.children,n=e.onHeight,c=Object(N.a)(e,["children","onHeight"]),a=r.a.useCallback((function(e){if(e)try{n(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in WithHeight:"),console.log(t)}}),[n]);return Object(V.jsx)("div",Object(L.a)(Object(L.a)({},c),{},{ref:a,children:t}))},E=Object(i.memo)(M);function F(){return(F=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c])}return e}).apply(this,arguments)}var R=new Map,z=new Map,D=0;function T(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(z.has(n)||(D+=1,z.set(n,D.toString())),z.get(n)):"0":e[t]);var n})).toString()}function I(e,t,n){if(void 0===n&&(n={}),!e)return function(){};var c=function(e){var t=T(e),n=R.get(t);if(!n){var c,a=new Map,i=new IntersectionObserver((function(t){t.forEach((function(t){var n,i=t.isIntersecting&&c.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=i),null==(n=a.get(t.target))||n.forEach((function(e){e(i,t)}))}))}),e);c=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:i,elements:a},R.set(t,n)}return n}(n),a=c.id,i=c.observer,r=c.elements,o=r.get(e)||[];return r.has(e)||r.set(e,o),o.push(t),i.observe(e),function(){o.splice(o.indexOf(t),1),0===o.length&&(r.delete(e),i.unobserve(e)),0===r.size&&(i.disconnect(),R.delete(a))}}function H(e){return"function"!==typeof e.children}var A=function(e){var t,n;function c(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),H(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=c).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var a=c.prototype;return a.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},a.componentWillUnmount=function(){this.unobserve(),this.node=null},a.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,c=e.rootMargin,a=e.trackVisibility,i=e.delay;this._unobserveCb=I(this.node,this.handleChange,{threshold:t,root:n,rootMargin:c,trackVisibility:a,delay:i})}},a.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},a.render=function(){if(!H(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var c=this.props,a=c.children,r=c.as,o=c.tag,s=function(e,t){if(null==e)return{};var n,c,a={},i=Object.keys(e);for(c=0;c<i.length;c++)n=i[c],t.indexOf(n)>=0||(a[n]=e[n]);return a}(c,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(i.createElement)(r||o||"div",F({ref:this.handleNode},s),a)},c}(i.Component);A.displayName="InView",A.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var _=n(608),B=n(610),W=n(7),q=(n(737),{threshold:.2}),K=function(e){var t=e.text,n=void 0===t?"":t,c=e.receivedMessage,a=void 0!==c&&c,r=e.publicKey,o=void 0===r?"":r,s=e.timestamp,u=e.onInView,l=void 0===u?W.b:u,d=e.onOutView,b=void 0===d?W.b:d,h=e.id,f=function(e){var t=void 0===e?{}:e,n=t.threshold,c=t.delay,a=t.trackVisibility,r=t.rootMargin,o=t.root,s=t.triggerOnce,u=t.skip,l=t.initialInView,d=Object(i.useRef)(),b=Object(i.useState)({inView:!!l}),h=b[0],f=b[1],v=Object(i.useCallback)((function(e){void 0!==d.current&&(d.current(),d.current=void 0),u||e&&(d.current=I(e,(function(e,t){f({inView:e,entry:t}),t.isIntersecting&&s&&d.current&&(d.current(),d.current=void 0)}),{root:o,rootMargin:r,threshold:n,trackVisibility:a,delay:c}))}),[Array.isArray(n)?n.toString():n,o,r,s,u,a,c]);Object(i.useEffect)((function(){d.current||!h.entry||s||u||f({inView:!!l})}));var m=[v,h.inView,h.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}(q),v=f.inView,m=f.ref;Object(i.useEffect)((function(){v?l(h):b(h)}),[h,v,l,b]);var p=Object(i.useMemo)((function(){try{var e=C.r(s);return w.DateTime.fromMillis(e).toLocaleString(w.DateTime.TIME_SIMPLE)}catch(t){return console.error(t),null}}),[s]);return Object(V.jsxs)("div",{className:x()({message:!0,"message-received":a}),ref:m,"data-v-9631697c":"",children:[a&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(B.a,{height:48,publicKey:o,"data-v-9631697c":""}),Object(V.jsx)(_.a,{amt:16,insideRow:!0,"data-v-9631697c":""})]}),Object(V.jsxs)("div",{className:"message-content","data-v-9631697c":"",children:[Object(V.jsx)("p",{className:"message-text","data-v-9631697c":"",children:n}),Object(V.jsx)("div",{className:"timestamp","data-v-9631697c":"",children:Object(V.jsx)("p",{className:"timestamp-text","data-v-9631697c":"",children:p})})]})]})},P=Object(i.memo)(K),U=n(183),J=n(50),Y=n(68),G=n(663),Q=(n(738),n(19)),X=n(607),Z=n(46),$=(n(739),function(e){var t=e.acceptLabel,n=e.declineLabel,c=e.onAccept,a=e.onReject,i=e.text,r=e.title;return Object(V.jsxs)("div",{className:"chat-permission-bar","data-v-83810e72":"",children:[r&&Object(V.jsx)("p",{className:"chat-permission-bar-title","data-v-83810e72":"",children:r}),i&&Object(V.jsx)("p",{className:"chat-permission-bar-text unselectable","data-v-83810e72":"",children:i}),(c||a)&&Object(V.jsxs)("div",{className:"chat-permission-bar-actions unselectable","data-v-83810e72":"",children:[c&&Object(V.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:c,"data-v-83810e72":"",children:t||"Accept"}),a&&Object(V.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline",onClick:a,"data-v-83810e72":"",children:n||"Decline"})]})]})}),ee=Object(i.memo)($);Object(k.b)();var te=function(){var e=Object(o.g)(),t=Q.useDispatch(),n=Object(o.i)().convoOrReqID,r=Q.useSelector(Q.selectCommunication(n)),s=Z.a(r),u=Z.c(r),l=Q.useSelector(Q.selectSelfPublicKey),d=W.m(!1),b=Object(a.a)(d,2),h=b[0],f=b[1],v=Z.a(r)?r.with:Z.c(r)?r.from:"",m=Q.useSelector(Q.selectConvos);Object(i.useEffect)((function(){r||e.replace("/chat")}),[r,e]),Object(i.useEffect)((function(){var e=t(Object(J.o)());return function(){e.then((function(e){return e.off()}))}}),[t]),Object(i.useEffect)((function(){Z.c(r)&&(m.find((function(e){return e.id===r.receiverConvoID}))&&e.replace("/chat/".concat(r.receiverConvoID)))}),[r,m,e]);var p=Q.useSelector(Q.selectUser(v));Object(i.useEffect)((function(){return t(Object(Y.b)(v))}),[t,v]);var j=p.publicKey,O=Object(i.useState)(""),y=Object(a.a)(O,2),L=y[0],N=y[1],M=Object(i.useState)(20),F=Object(a.a)(M,2),R=F[0],z=F[1],D=Object(i.useState)(!1),T=Object(a.a)(D,2),I=T[0],H=T[1],A=Object(i.useState)(-1),_=Object(a.a)(A,2),B=_[0],q=_[1],K=Object(i.useMemo)((function(){return{top:B+8+"px"}}),[B]),$=Object(i.useCallback)((function(e){q(e)}),[]),te=Object(i.useCallback)((function(){I||(H(!0),setTimeout((function(){H(!1)}),1500))}),[I]),ne=W.m(!1),ce=Object(a.a)(ne,2),ae=ce[0],ie=ce[1],re=Object(i.useMemo)((function(){return{bottom:R}}),[R]),oe=W.m(!1),se=Object(a.a)(oe,2),ue=se[0],le=se[1],de=Object(i.useCallback)((function(){ie(),le(),W.d.delete("/api/gun/chats/".concat(j)).then((function(){e.goBack()})).catch((function(e){W.g.error("Error when trying to disconnect public key:",e),alert(e.message)})).finally(le)}),[e,j,ie,le]);Object(i.useEffect)((function(){return s?t(Object(J.n)(n)):W.b}),[n,t,s]);var be=Q.useSelector((function(e){return s?Q.selectConvoMessages(n)(e):[]})),he=Object(i.useMemo)((function(){return be.filter((function(e){return e.body!==C.a}))}),[be]),fe=Object(i.useMemo)((function(){return be.some((function(e){return"received"===e.state}))}),[be]),ve=Q.useSelector((function(e){var t=e.chat;return Object.values(t.receivedRequests).find((function(e){return e.from===j}))})),me=Object(i.useCallback)((function(e){N(e.target.value)}),[]),pe=Object(i.useCallback)((function(){console.log(ve),ve&&(f(),t(Object(J.a)(ve.id)).catch((function(e){W.g.error("Could not accept request -> ",e),alert("Could not accept request: ".concat(e.message))})).finally(f))}),[ve,f,t]),je=Object(i.useCallback)((function(e){if("Enter"!==e.key||!e.ctrlKey)return"Enter"===e.key?(e.preventDefault(),t(Object(J.m)(n,L)),void N("")):void 0;N(L+"\r\n")}),[L,t,n]),Oe=Object(i.useState)(new Set),ge=Object(a.a)(Oe,2),ye=ge[0],xe=ge[1],we=Object(i.useMemo)((function(){var e=Array.from(ye).map((function(e){return be.find((function(t){return t.id===e}))})).filter((function(e){return!!e})).sort((function(e,t){return t.timestamp-e.timestamp}));if(0===e.length)return[w.DateTime.now().valueOf(),Date.now().valueOf()];if(1===e.length){var t=Object(a.a)(e,1)[0];return[t.timestamp,t.timestamp]}return[e[0].timestamp,e[e.length-1].timestamp]}),[be,ye]),ke=Object(a.a)(we,2),Ce=ke[0],Se=ke[1],Le=Object(i.useCallback)((function(e){xe(Object(k.a)((function(t){t.add(e)})))}),[xe]),Ne=Object(i.useCallback)((function(e){xe(Object(k.a)((function(t){t.delete(e)})))}),[xe]),Ve=p.displayName;return Object(V.jsxs)("div",{className:"page-container","data-v-8ce0d2c2":"",children:[Object(V.jsx)(S.a,{solid:!0,pageTitle:Ve,enableBackButton:!0,onHeight:$,"data-v-8ce0d2c2":""}),Object(V.jsx)("div",{className:"chat-messages-container no-scrollbar",onClick:ae?ie:void 0,onScroll:te,"data-v-8ce0d2c2":"",children:he.map((function(e){return Object(V.jsx)(P,{text:e.body,receivedMessage:"received"===e.state,publicKey:"received"===e.state?j:l,timestamp:e.timestamp,onInView:Le,onOutView:Ne,id:e.id,"data-v-8ce0d2c2":""},e.id)}))}),Object(V.jsx)("div",{className:x()(X.t,X.c,X.d,X.e),style:K,"data-v-8ce0d2c2":"",children:Object(V.jsx)("span",{className:x()(X.q,"chat-date-bubble",I?X.v:X.u),"data-v-8ce0d2c2":"",children:function(){var e=w.DateTime.fromMillis(Ce).startOf("day"),t=w.DateTime.fromMillis(Se).startOf("day"),n=w.DateTime.now().startOf("day"),c=w.DateTime.now().minus({day:1}).startOf("day"),a=e.hasSame(n,"year")&&t.hasSame(n,"year");if((e||t).hasSame(t,"day"))return e.hasSame(n,"day")?"Today":e.hasSame(c,"day")?"Yesterday":a?e.toFormat("LLLL d"):e.toLocaleString(w.DateTime.DATE_FULL);if(e.hasSame(t,"month")){var i=t.toFormat("d"),r=e.toFormat("d"),o=(e||t).toFormat("LLLL");if(a)return"".concat(o," ").concat(i," - ").concat(r);var s=e.toFormat("y");return"".concat(o," ").concat(i," - ").concat(r,", ").concat(s)}if(a){var u=t.toFormat("d"),l=e.toFormat("d"),d=t.toFormat("LLLL"),b=e.toFormat("LLLL");return"".concat(d," ").concat(u," - ").concat(b," ").concat(l)}var h=t.toFormat("d"),f=e.toFormat("d"),v=t.toFormat("LLLL"),m=e.toFormat("LLLL"),p=t.toFormat("y"),j=e.toFormat("y");return"".concat(v," ").concat(h,", ").concat(p," - ").concat(m," ").concat(f,", ").concat(j)}()})}),h&&Object(V.jsx)(U.a,{text:"Accepting request...","data-v-8ce0d2c2":""}),u&&!h&&Object(V.jsx)(ee,{text:"Once you accept the request, you'll be able to chat and send\n         invoices to ".concat(Ve),title:"".concat(Ve," has sent you a chat request!"),onAccept:pe,"data-v-8ce0d2c2":""}),s&&!fe&&Object(V.jsx)(ee,{text:"Once ".concat(Ve," accepts the request, you'll be able to chat with\n        them"),title:"Your request has been sent to ".concat(Ve," successfully"),"data-v-8ce0d2c2":""}),s&&fe&&Object(V.jsx)(E,{className:"chat-bottom-bar",onHeight:z,onClick:ae?ie:void 0,"data-v-8ce0d2c2":"",children:Object(V.jsxs)("div",{className:"chat-input-container","data-v-8ce0d2c2":"",children:[Object(V.jsx)("div",{className:"chat-input-btn unselectable",onClick:ie,"data-v-8ce0d2c2":"",children:Object(V.jsx)("img",{src:G.a,alt:"Menu","data-v-8ce0d2c2":""})}),Object(V.jsx)(g,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:je,onChange:me,value:L,height:20,"data-v-8ce0d2c2":""})]})}),Object(V.jsx)("div",{className:x()("action-menu",Object(c.a)({},X.m,!ae)),style:re,"data-v-8ce0d2c2":"",children:Object(V.jsx)("span",{className:x()("action",X.C),onClick:de,"data-v-8ce0d2c2":"",children:"Disconnect"})}),ue&&Object(V.jsx)(U.a,{overlay:!0,fullScreen:!0,text:"Disconnecting...","data-v-8ce0d2c2":""})]})};t.default=Object(i.memo)(te)}}]);
//# sourceMappingURL=27.4d4b8ffb.chunk.js.map