(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[24],{447:function(e,t,n){"use strict";var a=n(3),i=n(72),r=n.n(i),o=(n(448),n(40)),c=n(88),s=n(76),u=n(445),d=n(18),l=n(7);t.a=function(e){var t=e.pageTitle,n=e.absolute,i=void 0!==n&&n,b=e.solid,h=void 0!==b&&b,v=e.enableBackButton,f=void 0!==v&&v,p=e.onHeight,m=void 0===p?c.a:p,j=Object(o.b)(),O=Object(a.useCallback)((function(){window.history.back()}),[]),g=Object(a.useCallback)((function(){j(Object(s.c)())}),[j]),y=Object(d.useSelector)((function(e){return e.node.publicKey})),x=Object(a.useCallback)((function(e){if(e)try{m(e.getBoundingClientRect().height)}catch(t){console.log("Error inside onHeight mechanism in MainNav:"),console.log(t)}}),[m]);return Object(l.jsxs)("div",{className:r()({"main-nav-container":!0,"main-nav-absolute":i,"main-nav-solid":h}),ref:x,"data-v-e4311236":"",children:[f?Object(l.jsx)("div",{className:"main-nav-back",onClick:O,"data-v-e4311236":"",children:Object(l.jsx)("i",{className:"icon icon-thin-back","data-v-e4311236":""})}):Object(l.jsx)(u.a,{height:40,publicKey:y,"data-v-e4311236":""}),Object(l.jsx)("p",{className:"main-nav-title unselectable","data-v-e4311236":"",children:t}),Object(l.jsxs)("div",{className:"main-nav-menu-btn",onClick:g,"data-v-e4311236":"",children:[Object(l.jsx)("div",{className:"main-nav-menu-dash","data-v-e4311236":""}),Object(l.jsx)("div",{className:"main-nav-menu-dash","data-v-e4311236":""}),Object(l.jsx)("div",{className:"main-nav-menu-dash","data-v-e4311236":""})]})]})}},448:function(e,t,n){},476:function(e,t,n){"use strict";t.a=n.p+"static/media/bitcoin-lightning.2d73b74b.svg"},523:function(e,t,n){"use strict";var a=n(3),i=a.useLayoutEffect;t.a=function(e){var t=Object(a.useRef)(e);return i((function(){t.current=e})),t}},581:function(e,t,n){},582:function(e,t,n){},710:function(e,t,n){"use strict";n.r(t);var a=n(16),i=n(3),r=n(22),o=n(40),c=n(12),s=n(31),u=n(523),d=function(e,t){"function"!==typeof e?e.current=t:e(t)},l=function(e,t){var n=Object(i.useRef)();return Object(i.useCallback)((function(a){e.current=a,n.current&&d(n.current,null),n.current=t,t&&d(t,a)}),[t])},b={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},h=function(e){Object.keys(b).forEach((function(t){e.style.setProperty(t,b[t],"important")}))},v=null;var f=function(){},p=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],m=!!document.documentElement.currentStyle,j=function(e,t){var n=e.cacheMeasurements,a=e.maxRows,r=e.minRows,o=e.onChange,d=void 0===o?f:o,b=e.onHeightChange,j=void 0===b?f:b,O=Object(s.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var g=void 0!==O.value,y=Object(i.useRef)(null),x=l(y,t),w=Object(i.useRef)(0),S=Object(i.useRef)(),k=function(){var e=y.current,t=n&&S.current?S.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,a=(n=t,p.reduce((function(e,t){return e[t]=n[t],e}),{})),i=a.boxSizing;return""===i?null:(m&&"border-box"===i&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px"),{sizingStyle:a,paddingSize:parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),borderSize:parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth)})}(e);if(t){S.current=t;var i=function(e,t,n,a){void 0===n&&(n=1),void 0===a&&(a=1/0),v||((v=document.createElement("textarea")).setAttribute("tab-index","-1"),v.setAttribute("aria-hidden","true"),h(v)),null===v.parentNode&&document.body.appendChild(v);var i=e.paddingSize,r=e.borderSize,o=e.sizingStyle,c=o.boxSizing;Object.keys(o).forEach((function(e){var t=e;v.style[t]=o[t]})),h(v),v.value=t;var s=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(v,e);v.value="x";var u=v.scrollHeight-i,d=u*n;"border-box"===c&&(d=d+i+r),s=Math.max(d,s);var l=u*a;return"border-box"===c&&(l=l+i+r),[s=Math.min(l,s),u]}(t,e.value||e.placeholder||"x",r,a),o=i[0],c=i[1];w.current!==o&&(w.current=o,e.style.setProperty("height",o+"px","important"),j(o,{rowHeight:c}))}};return Object(i.useLayoutEffect)(k),function(e){var t=Object(u.a)(e);Object(i.useLayoutEffect)((function(){var e=function(e){t.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[])}(k),Object(i.createElement)("textarea",Object(c.a)({},O,{onChange:function(e){g||k(),d(e)},ref:x}))},O=Object(i.forwardRef)(j),g=n(72),y=n.n(g),x=n(108),w=n(82),S=n(447),k=n(25);function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var L=new Map,C=new Map,V=0;function F(e){return Object.keys(e).sort().filter((function(t){return void 0!==e[t]})).map((function(t){return t+"_"+("root"===t?(n=e.root)?(C.has(n)||(V+=1,C.set(n,V.toString())),C.get(n)):"0":e[t]);var n})).toString()}function M(e,t,n){if(void 0===n&&(n={}),!e)return function(){};var a=function(e){var t=F(e),n=L.get(t);if(!n){var a,i=new Map,r=new IntersectionObserver((function(t){t.forEach((function(t){var n,r=t.isIntersecting&&a.some((function(e){return t.intersectionRatio>=e}));e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=r),null==(n=i.get(t.target))||n.forEach((function(e){e(r,t)}))}))}),e);a=r.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:t,observer:r,elements:i},L.set(t,n)}return n}(n),i=a.id,r=a.observer,o=a.elements,c=o.get(e)||[];return o.has(e)||o.set(e,c),c.push(t),r.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(o.delete(e),r.unobserve(e)),0===o.size&&(r.disconnect(),L.delete(i))}}function z(e){return"function"!==typeof e.children}var E=function(e){var t,n;function a(t){var n;return(n=e.call(this,t)||this).node=null,n._unobserveCb=null,n.handleNode=function(e){n.node&&(n.unobserve(),e||n.props.triggerOnce||n.props.skip||n.setState({inView:!!n.props.initialInView,entry:void 0})),n.node=e||null,n.observeNode()},n.handleChange=function(e,t){e&&n.props.triggerOnce&&n.unobserve(),z(n.props)||n.setState({inView:e,entry:t}),n.props.onChange&&n.props.onChange(e,t)},n.state={inView:!!t.initialInView,entry:void 0},n}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=a.prototype;return r.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},r.componentWillUnmount=function(){this.unobserve(),this.node=null},r.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,n=e.root,a=e.rootMargin,i=e.trackVisibility,r=e.delay;this._unobserveCb=M(this.node,this.handleChange,{threshold:t,root:n,rootMargin:a,trackVisibility:i,delay:r})}},r.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},r.render=function(){if(!z(this.props)){var e=this.state,t=e.inView,n=e.entry;return this.props.children({inView:t,entry:n,ref:this.handleNode})}var a=this.props,r=a.children,o=a.as,c=a.tag,s=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(a,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView"]);return Object(i.createElement)(o||c||"div",N({ref:this.handleNode},s),r)},a}(i.Component);E.displayName="InView",E.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};var T=n(443),R=n(445),I=n(88),D=(n(581),n(7)),K={threshold:.2},_=function(e){var t=e.text,n=void 0===t?"":t,a=e.receivedMessage,r=void 0!==a&&a,o=e.publicKey,c=void 0===o?"":o,s=e.timestamp,u=e.onInView,d=void 0===u?I.a:u,l=e.onOutView,b=void 0===l?I.a:l,h=e.id,v=function(e){var t=void 0===e?{}:e,n=t.threshold,a=t.delay,r=t.trackVisibility,o=t.rootMargin,c=t.root,s=t.triggerOnce,u=t.skip,d=t.initialInView,l=Object(i.useRef)(),b=Object(i.useState)({inView:!!d}),h=b[0],v=b[1],f=Object(i.useCallback)((function(e){void 0!==l.current&&(l.current(),l.current=void 0),u||e&&(l.current=M(e,(function(e,t){v({inView:e,entry:t}),t.isIntersecting&&s&&l.current&&(l.current(),l.current=void 0)}),{root:c,rootMargin:o,threshold:n,trackVisibility:r,delay:a}))}),[Array.isArray(n)?n.toString():n,c,o,s,u,r,a]);Object(i.useEffect)((function(){l.current||!h.entry||s||u||v({inView:!!d})}));var p=[f,h.inView,h.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}(K),f=v.inView,p=v.ref;Object(i.useEffect)((function(){f?d(h):b(h)}),[h,f,d,b]);var m=Object(i.useMemo)((function(){try{var e=k.k(s);return x.DateTime.fromMillis(e).toLocaleString(x.DateTime.TIME_SIMPLE)}catch(t){return console.error(t),null}}),[s]);return Object(D.jsxs)("div",{className:y()({message:!0,"message-received":r}),ref:p,"data-v-950ac179":"",children:[r&&Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(R.a,{height:48,publicKey:c,alignment:"end","data-v-950ac179":""}),Object(D.jsx)(T.a,{amt:16,insideRow:!0,"data-v-950ac179":""})]}),Object(D.jsxs)("div",{className:"message-content","data-v-950ac179":"",children:[Object(D.jsx)("p",{className:"message-text","data-v-950ac179":"",children:n}),Object(D.jsx)("div",{className:"timestamp","data-v-950ac179":"",children:Object(D.jsx)("p",{className:"timestamp-text","data-v-950ac179":"",children:m})})]})]})},A=n(24),H=n(476),W=(n(582),n(18)),B=n(20),P=n(435);Object(w.b)();t.default=function(){var e=Object(o.b)(),t=Object(r.i)().publicKey,n=W.useSelector(W.selectUser(t)),c=Object(i.useState)(""),s=Object(a.a)(c,2),u=s[0],d=s[1],l=Object(i.useState)(!1),b=Object(a.a)(l,2),h=b[0],v=b[1],f=Object(i.useState)(-1),p=Object(a.a)(f,2),m=p[0],j=p[1],g=Object(i.useMemo)((function(){return{top:m+8+"px"}}),[m]),k=Object(i.useCallback)((function(e){j(e)}),[]),N=Object(i.useCallback)((function(){h||(v(!0),setTimeout((function(){v(!1)}),1500))}),[h]),L=W.useSelector((function(e){return e.chat.messages[t]})),C=W.useSelector((function(e){var n=e.chat;return Object(I.c)(n.contacts,t)})),V=W.useSelector((function(e){var n=e.chat;return Object(I.c)(n.sentRequests,t)})),F=W.useSelector((function(e){var n=e.chat;return Object(I.c)(n.receivedRequests,t)})),M=W.useSelector((function(e){return e.node.publicKey})),z=!C&&V,E=!C&&F,T=Object(i.useCallback)((function(e){d(e.target.value)}),[]),R=Object(i.useCallback)((function(){console.log(F),F&&Object(A.b)(F.id)(e)}),[F,e]),K=Object(i.useCallback)((function(n){if("Enter"!==n.key||!n.ctrlKey)return"Enter"===n.key?(n.preventDefault(),e(Object(A.g)({message:u,publicKey:t})),void d("")):void 0;d(u+"\r\n")}),[u,t,e]),q=Object(i.useCallback)((function(){var n=e(Object(A.h)(M,t));return Object(B.f)(n)}),[e,M,t]);Object(i.useEffect)((function(){return q()}),[q]);var U=Object(i.useState)(new Set),J=Object(a.a)(U,2),Y=J[0],Q=J[1],G=Object(i.useMemo)((function(){if(0===Y.size)return[x.DateTime.now().valueOf(),Date.now().valueOf()];var e=Array.from(Y).map((function(e){return L.find((function(t){return t.id===e}))})).filter((function(e){return!!e})).sort((function(e,t){return t.timestamp-e.timestamp}));return[e[0].timestamp,e[e.length-1].timestamp]}),[L,Y]),X=Object(a.a)(G,2),Z=X[0],$=X[1],ee=Object(i.useCallback)((function(e){Q(Object(w.a)((function(t){t.add(e)})))}),[Q]),te=Object(i.useCallback)((function(e){Q(Object(w.a)((function(t){t.delete(e)})))}),[Q]),ne=n.displayName;return Object(D.jsxs)("div",{className:"page-container","data-v-8093932d":"",children:[Object(D.jsx)(S.a,{solid:!0,pageTitle:ne,enableBackButton:!0,onHeight:k,"data-v-8093932d":""}),Object(D.jsx)("div",{className:"chat-messages-container",onScroll:N,"data-v-8093932d":"",children:null===L||void 0===L?void 0:L.map((function(e){return Object(D.jsx)(_,{text:e.body,receivedMessage:!e.outgoing,publicKey:e.recipientPublicKey,timestamp:e.timestamp,onInView:ee,onOutView:te,id:e.id,"data-v-8093932d":""})}))}),Object(D.jsx)("div",{className:y()(P.horizontallyCenteredAbsolute,P.absoluteStickToTop,P.centerAlign,P.centerJustify),style:g,"data-v-8093932d":"",children:Object(D.jsx)("span",{className:y()(P.fontSize12,"chat-date-bubble",h?P.opacityThreeQuarters:P.opacityNone),"data-v-8093932d":"",children:function(){var e=x.DateTime.fromMillis(Z).startOf("day"),t=x.DateTime.fromMillis($).startOf("day"),n=x.DateTime.now().startOf("day"),a=x.DateTime.now().minus({day:1}).startOf("day"),i=e.hasSame(n,"year")&&t.hasSame(n,"year");if((e||t).hasSame(t,"day"))return e.hasSame(n,"day")?"Today":e.hasSame(a,"day")?"Yesterday":i?e.toFormat("LLLL d"):e.toLocaleString(x.DateTime.DATE_FULL);if(e.hasSame(t,"month")){var r=t.toFormat("d"),o=e.toFormat("d"),c=(e||t).toFormat("LLLL");if(i)return"".concat(c," ").concat(r," - ").concat(o);var s=e.toFormat("y");return"".concat(c," ").concat(r," - ").concat(o,", ").concat(s)}if(i){var u=t.toFormat("d"),d=e.toFormat("d"),l=t.toFormat("LLLL"),b=e.toFormat("LLLL");return"".concat(l," ").concat(u," - ").concat(b," ").concat(d)}var h=t.toFormat("d"),v=e.toFormat("d"),f=t.toFormat("LLLL"),p=e.toFormat("LLLL"),m=t.toFormat("y"),j=e.toFormat("y");return"".concat(f," ").concat(h,", ").concat(m," - ").concat(p," ").concat(v,", ").concat(j)}()})}),E?Object(D.jsxs)("div",{className:"chat-permission-bar","data-v-8093932d":"",children:[Object(D.jsxs)("p",{className:"chat-permission-bar-title unselectable","data-v-8093932d":"",children:[ne," has sent you a chat request!"]}),Object(D.jsxs)("p",{className:"chat-permission-bar-text","data-v-8093932d":"",children:["Once you accept the request, you'll be able to chat and send invoices to ",ne]}),Object(D.jsxs)("div",{className:"chat-permission-bar-actions unselectable","data-v-8093932d":"",children:[Object(D.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-accept",onClick:R,"data-v-8093932d":"",children:"Accept"}),Object(D.jsx)("div",{className:"chat-permission-bar-action chat-permission-bar-action-decline","data-v-8093932d":"",children:"Decline"})]})]}):z?Object(D.jsxs)("div",{className:"chat-permission-bar","data-v-8093932d":"",children:[Object(D.jsxs)("p",{className:"chat-permission-bar-title","data-v-8093932d":"",children:["Your request has been sent to ",ne," successfully"]}),Object(D.jsxs)("p",{className:"chat-permission-bar-text unselectable","data-v-8093932d":"",children:["Once ",ne," accepts the request, you'll be able to chat with them"]})]}):Object(D.jsx)("div",{className:"chat-bottom-bar","data-v-8093932d":"",children:Object(D.jsxs)("div",{className:"chat-input-container","data-v-8093932d":"",children:[Object(D.jsx)("div",{className:"chat-input-btn unselectable","data-v-8093932d":"",children:Object(D.jsx)("img",{src:H.a,alt:"Menu","data-v-8093932d":""})}),Object(D.jsx)(O,{className:"chat-input",type:"text",enterKeyHint:"send",onKeyPress:K,onChange:T,value:u,height:20,"data-v-8093932d":""})]})})]})}}}]);
//# sourceMappingURL=24.58e11710.chunk.js.map