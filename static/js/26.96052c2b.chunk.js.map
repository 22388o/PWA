{"version":3,"sources":["common/DialogNav/index.js","common/DarkPage/DarkPage.tsx","common/DarkPage/css/DarkPage.module.css","common/Post/components/Image/index.js","pages/PublicContentItem/PublicContentItemPage.tsx"],"names":["DIALOG_NAV_MIN_HEIGHT_PX","CONTAINER_STYLE","minHeight","DialogNav","pageTitle","drawerVisible","onHeight","Utils","goBack","useCallback","window","history","back","divRefCb","el","getBoundingClientRect","height","e","console","log","className","ref","style","onClick","classNames","memo","DarkPage","children","justify","padding","paddingBetweenChildren","scrolls","Error","React","useState","headerHeight","setHeaderHeight","c","styles","container","gStyles","Pad","amt","module","exports","Image","id","item","index","postId","tipValue","tipCounter","hideRibbon","width","disableZoom","zoomed","setZoomed","zoomLoaded","setZoomLoaded","previewVisible","setPreviewVisible","animationTimer","setAnimationTimer","handleZoomChange","value","clearTimeout","timer","setTimeout","contentURL","decodeURIComponent","magnetURI","replace","mainImageStyle","opacity","imgNode","alt","data-torrent","data-file-key","src","onLoad","display","isZoomed","onZoomChange","overlayBgColorStart","overlayBgColorEnd","PublicContentItemPage","dispatch","Store","useParams","publicKey","setItem","error","setError","author","useEffect","subscribeUserProfile","subscription","rifle","query","onError","JSON","stringify","onData","data","Schema","warn","slice","then","sub","off","onRetry","title","type","controls","ShockAvatar","insideRow","displayName","timestamp","description"],"mappings":"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","file":"static/js/26.96052c2b.chunk.js","sourcesContent":["// @ts-check\nimport { memo, useCallback } from \"react\";\nimport classNames from \"classnames\";\n/**\n * @typedef {import('react').RefCallback<HTMLElement>} DivRefCallback\n */\n\nimport * as Utils from \"../../utils\";\n\nimport \"./css/index.scoped.css\";\n\nexport const DIALOG_NAV_MIN_HEIGHT_PX = 73;\n/** @type {import('react').CSSProperties} */\nconst CONTAINER_STYLE = {\n  minHeight: DIALOG_NAV_MIN_HEIGHT_PX\n};\n\nconst DialogNav = ({\n  pageTitle,\n  drawerVisible = false,\n  onHeight = Utils.EMPTY_FN\n}) => {\n  const goBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  /** @type {DivRefCallback} */\n  const divRefCb = useCallback(\n    el => {\n      // https://www.pluralsight.com/tech-blog/getting-size-and-position-of-an-element-in-react/\n      if (!el) return;\n      try {\n        onHeight(el.getBoundingClientRect().height);\n      } catch (e) {\n        console.log(`Error inside onHeight mechanism in DialogNav:`);\n        console.log(e);\n      }\n    },\n    [onHeight]\n  );\n\n  return (\n    <div\n      className=\"dialog-nav-container\"\n      ref={divRefCb}\n      style={CONTAINER_STYLE}\n    >\n      <div className=\"dialog-nav-back\" onClick={goBack}>\n        <i className=\"icon icon-thin-back\"></i>\n      </div>\n      <p className=\"dialog-nav-title\">{pageTitle}</p>\n      <div\n        className={classNames({\n          \"dialog-nav-menu-btn\": true,\n          \"dialog-nav-hidden\": !drawerVisible\n        })}\n      >\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DialogNav);\n","import React, { memo } from \"react\";\nimport c from \"classnames\";\n\nimport DialogNav, { DIALOG_NAV_MIN_HEIGHT_PX } from \"../DialogNav\";\nimport Pad from \"../Pad\";\nimport * as gStyles from \"../../styles\";\n\nimport styles from \"./css/DarkPage.module.css\";\n\nexport interface DarkPageProps {\n  children?: any;\n  justify?: \"start\" | \"center\";\n  padding?: boolean;\n  paddingBetweenChildren?: 0 | 48;\n  pageTitle?: string;\n  scrolls?: boolean;\n}\n\nconst DarkPage: React.FC<DarkPageProps> = ({\n  children,\n  justify,\n  padding,\n  paddingBetweenChildren = 0,\n  pageTitle,\n  scrolls\n}) => {\n  if (scrolls && !!justify) {\n    throw new Error(`Can not both set \"scrolls\" and \"justify\" at <DarkPage />`);\n  }\n  //#region controller\n  const [headerHeight, setHeaderHeight] = React.useState(\n    DIALOG_NAV_MIN_HEIGHT_PX\n  );\n  //#endregion controller\n\n  return (\n    <div\n      className={c(styles.container, {\n        [styles[\"container-scrolls\"]]: !!scrolls,\n        [gStyles.col]: !!justify,\n        [gStyles.centerJustify]: justify === \"center\",\n        [gStyles.commonPaddingH]: !!padding,\n        [gStyles.childrenSpaced48Col]: paddingBetweenChildren === 48\n      })}\n    >\n      <DialogNav pageTitle={pageTitle || \"\"} onHeight={setHeaderHeight} />\n\n      <Pad amt={headerHeight} />\n\n      {children}\n    </div>\n  );\n};\n\nexport default memo(DarkPage);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"DarkPage_container__1so-g\",\"container-scrolls\":\"DarkPage_container-scrolls__3t0tO\"};","import React, { memo, useState, useCallback } from \"react\";\nimport { Controlled as ControlledZoom } from \"react-medium-image-zoom\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"react-medium-image-zoom/dist/styles.css\";\nimport \"./css/index.scoped.css\";\n\nconst IMAGE_TRANSITION_MS = 200;\n\nconst Image = ({\n  id = \"\",\n  item,\n  index = 0,\n  postId = \"\",\n  tipValue = 0,\n  tipCounter = 0,\n  hideRibbon = false,\n  width = null,\n  disableZoom = false,\n  style = /** @type {import('react').CSSProperties} */ ({})\n}) => {\n  const [zoomed, setZoomed] = useState(false);\n  const [zoomLoaded, setZoomLoaded] = useState(false);\n  const [previewVisible, setPreviewVisible] = useState(true);\n  const [animationTimer, setAnimationTimer] = useState(null);\n\n  const handleZoomChange = useCallback(\n    value => {\n      clearTimeout(animationTimer);\n      setZoomed(value);\n      if (!value && zoomLoaded) {\n        setZoomLoaded(false);\n        const timer = setTimeout(() => {\n          setPreviewVisible(true);\n        }, IMAGE_TRANSITION_MS);\n        setAnimationTimer(timer);\n      }\n\n      if (value) {\n        setPreviewVisible(false);\n      }\n    },\n    [\n      animationTimer,\n      zoomLoaded,\n      setZoomed,\n      setZoomLoaded,\n      setPreviewVisible,\n      setAnimationTimer\n    ]\n  );\n\n  const contentURL = decodeURIComponent(\n    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n  );\n  const mainImageStyle = { ...style, opacity: previewVisible ? 1 : 0 };\n  if (width) {\n    mainImageStyle.width = width;\n  }\n\n  const imgNode = (\n    <>\n      <img\n        className={`image torrent-img torrent-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-torrent={item.magnetURI}\n        data-file-key={index}\n        style={mainImageStyle}\n        src={contentURL}\n      />\n      <img\n        className={`image enlarged-img enlarged-img-${postId}-${id}`}\n        alt=\"Post Media\"\n        data-file-key={index}\n        onLoad={() => {\n          setZoomLoaded(true);\n        }}\n        style={{\n          opacity: zoomed ? 1 : 0,\n          display: zoomed ? \"block\" : \"none\"\n        }}\n        src={contentURL}\n      />\n      {!hideRibbon && (\n        <TipRibbon\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          zoomed={zoomed}\n        />\n      )}\n    </>\n  );\n\n  return (\n    <div className=\"media-container\">\n      {disableZoom ? (\n        imgNode\n      ) : (\n        <ControlledZoom\n          isZoomed={zoomed}\n          onZoomChange={handleZoomChange}\n          overlayBgColorStart=\"#16191c00\"\n          overlayBgColorEnd=\"#16191c\"\n        >\n          {imgNode}\n        </ControlledZoom>\n      )}\n    </div>\n  );\n};\n\nexport default memo(Image);\n","import React,{memo} from \"react\";\nimport { useParams } from \"react-router-dom\";\n\nimport * as Schema from \"../../schema\";\nimport * as Utils from \"../../utils\";\nimport * as Store from \"../../store\";\nimport DarkPage from \"../../common/DarkPage\";\nimport Pad from \"../../common/Pad\";\nimport Image from \"../../common/Post/components/Image\";\nimport ShockAvatar from \"../../common/ShockAvatar\";\nimport { rifle } from \"../../utils/WebSocket\";\nimport { subscribeUserProfile } from \"../../actions/UserProfilesActions\";\n\nimport \"./css/PublicContentItemPage.scoped.css\";\n\nexport interface PublicContentItemPageProps {\n  id: string;\n}\n\nconst PublicContentItemPage: React.FC<PublicContentItemPageProps> = () => {\n  const dispatch = Store.useDispatch();\n  const { id, publicKey } = useParams<{ id: string; publicKey: string }>();\n  const [item, setItem] = React.useState<Schema.PublicContentItem | null>(null);\n  const [error, setError] = React.useState<string>(\"\");\n\n  const author = Store.useSelector(Store.selectUser(publicKey));\n\n  React.useEffect(() => dispatch(subscribeUserProfile(publicKey)));\n\n  React.useEffect(() => {\n    if (error) {\n      return () => {};\n    }\n    const subscription = rifle({\n      query: `${publicKey}::publishedContentPublic>${id}::on`,\n      onError(e) {\n        setError(JSON.stringify(e, null, 4));\n      },\n      onData(data) {\n        if (Schema.isPublicContentItem(data)) {\n          setItem(data);\n        } else {\n          Utils.logger.warn(\n            `Invalid/incomplete public published content found for public key ...${publicKey.slice(\n              -8\n            )}, might be due to pending replication or was deleted if null: ${JSON.stringify(\n              data,\n              null,\n              4\n            )}`\n          );\n        }\n      }\n    });\n\n    return () => {\n      subscription.then(sub => sub.off());\n    };\n  }, [error, id, publicKey]);\n\n  const onRetry = React.useCallback(() => {\n    setError(\"\");\n  }, []);\n\n  if (error) {\n    return (\n      <DarkPage pageTitle=\"Error\" justify=\"center\">\n        <span>{error}</span>\n\n        <Pad amt={32} />\n\n        <button className=\"submit-btn retry-btn\" onClick={onRetry}>\n          Retry\n        </button>\n      </DarkPage>\n    );\n  }\n\n  if (!item) {\n    return <DarkPage pageTitle=\"Loading...\" />;\n  }\n\n  return (\n    <DarkPage scrolls>\n      <h1>{item.title}</h1>\n\n      {item.type === \"image/embedded\" && <Image item={item} />}\n\n      {item.type === \"video/embedded\" && (\n        <video\n          className=\"public-content-item-video\"\n          controls\n          src={decodeURIComponent(item.magnetURI.replace(/.*(ws=)/gi, \"\"))}\n        />\n      )}\n\n      <div className=\"info\">\n        <div className=\"user-info\">\n          <ShockAvatar height={48} publicKey={publicKey} />\n\n          <Pad amt={12} insideRow />\n\n          <span>{author.displayName}</span>\n        </div>\n\n        <span>{Utils.formatTimestamp(item.timestamp)}</span>\n      </div>\n\n      <p className=\"description\">{item.description}</p>\n\n      <Pad amt={160} />\n    </DarkPage>\n  );\n};\n\nexport default memo(PublicContentItemPage);\n"],"sourceRoot":""}