(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[38],{811:function(e,t,a){},863:function(e,t,a){"use strict";a.r(t);var n,c,r=a(26),s=a(2),o=a.n(s),l=a(5),i=a(12),d=a(3),u=a(42),b=a(80),v=a.n(b),j=a(239),p=a(275),f=0,h=0;var m=function(e,t,a){var r=t&&a||0,s=t||new Array(16),o=(e=e||{}).node||n,l=void 0!==e.clockseq?e.clockseq:c;if(null==o||null==l){var i=e.random||(e.rng||j.a)();null==o&&(o=n=[1|i[0],i[1],i[2],i[3],i[4],i[5]]),null==l&&(l=c=16383&(i[6]<<8|i[7]))}var d=void 0!==e.msecs?e.msecs:Date.now(),u=void 0!==e.nsecs?e.nsecs:h+1,b=d-f+(u-h)/1e4;if(b<0&&void 0===e.clockseq&&(l=l+1&16383),(b<0||d>f)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=d,h=u,c=l;var v=(1e4*(268435455&(d+=122192928e5))+u)%4294967296;s[r++]=v>>>24&255,s[r++]=v>>>16&255,s[r++]=v>>>8&255,s[r++]=255&v;var m=d/4294967296*1e4&268435455;s[r++]=m>>>8&255,s[r++]=255&m,s[r++]=m>>>24&15|16,s[r++]=m>>>16&255,s[r++]=l>>>8|128,s[r++]=255&l;for(var O=0;O<6;++O)s[r+O]=o[O];return t||Object(p.a)(s)},O=(a(811),a(171)),x=a(13),g=a(28),k=a(689),y=a(23),w=a(17),S=a(565),C=a(585),N=a(563),P=a(4);t.default=function(){var e,t=Object(u.b)(),a=Object(y.g)(),n=w.useSelector((function(e){return e.content.seedProviderPub})),c=w.useSelector((function(e){return e.content.seedInfo})),s=c.seedUrl,b=c.seedToken,j=w.useSelector((function(e){return e.content.availableTokens})),p=w.useSelector((function(e){return e.userProfiles})),f=Object(d.useState)(null),h=Object(i.a)(f,2),T=h[0],D=h[1],I=Object(d.useState)(!1),R=Object(i.a)(I,2),A=R[0],U=R[1],F=Object(d.useState)([]),q=Object(i.a)(F,2),E=q[0],M=q[1],W=Object(d.useState)(""),B=Object(i.a)(W,2),L=B[0],z=B[1],H=Object(d.useState)(!1),J=Object(i.a)(H,2),K=J[0],_=J[1],G=Object(d.useState)(""),Q=Object(i.a)(G,2),V=Q[0],X=Q[1],Y=Object(d.useState)("public"),Z=Object(i.a)(Y,2),$=Z[0],ee=Z[1],te=Object(d.useRef)(null),ae=Object(d.useRef)(null),ne=Object(d.useState)(null),ce=Object(i.a)(ne,2),re=ce[0],se=ce[1],oe=w.useSelector(w.selectSelfPublicKey),le=Object(d.useState)([]),ie=Object(i.a)(le,2),de=ie[0],ue=ie[1],be=Object(d.useCallback)(function(){var e=Object(l.a)(o.a.mark((function e(c,r){var l,d,u,v,p,f,h,O,x,y,w,S,C,N,P,T;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log([L,V,de]),L){e.next=5;break}return D("Please input a title"),_(!0),e.abrupt("return");case 5:if(0!==de.length){e.next=8;break}return D("No selected files"),e.abrupt("return");case 8:return U(!0),l=null,e.prev=10,e.next=13,Object(k.a)({availableTokens:j,seedProviderPub:n,seedToken:b,seedUrl:s,serviceID:r,servicePrice:c});case 13:return d=e.sent,u=d.seedUrl,v=d.tokens,p=d.deleteToken,f=new FormData,Array.from(de).forEach((function(e){return f.append("files",e)})),f.append("info","extraInfo"),f.append("comment","comment"),e.next=23,fetch("".concat(u,"/api/put_file"),{method:"POST",headers:{Authorization:"Bearer ".concat(v[0])},body:f});case 23:return l=e.sent,e.next=26,l.json();case 26:if(h=e.sent,console.log(h),!h.error||!h.error.message){e.next=33;break}return"The provided token has already been used"===(O=h.error.message)?(D("An error occurred, please try again"),Object(g.j)(u,v[0])(t)):D(O),U(!1),e.abrupt("return");case 33:return x=h.data.torrent,y=x.magnet,w=Object(i.a)(E,1),S=w[0],console.log(S),C="video"===S.type?"video/embedded":"image/embedded",N={id:m(),timestamp:Date.now(),author:oe,type:C,magnetURI:y,width:0,height:0,title:L,description:V},e.next=41,Object(g.c)(N,$)(t);case 41:P=e.sent,console.log("content publish complete"),console.log(P),U(!1),p&&Object(g.j)(u,v[0])(t),a.replace("/profile"),e.next=55;break;case 49:e.prev=49,e.t0=e.catch(10),console.error(e.t0),l&&l.text().then((function(e){console.error("Response data as text: ",e)})).catch((function(e){console.error("Could not process bad response data as text: ",e)})),D(null!==(T=null===e.t0||void 0===e.t0?void 0:e.t0.errorMessage)&&void 0!==T?T:null===e.t0||void 0===e.t0?void 0:e.t0.message),U(!1);case 55:case"end":return e.stop()}}),e,null,[[10,49]])})));return function(t,a){return e.apply(this,arguments)}}(),[j,V,t,a,E,$,n,b,s,de,oe,L]),ve=Object(d.useCallback)((function(){se(null)}),[se]),je=Object(d.useCallback)((function(){var e=re.servicePrice,t=re.serviceID;be(e,t),se(null)}),[re,be,se]),pe=Object(d.useCallback)(function(){var e=Object(l.a)(o.a.mark((function e(t){var a,c,r,l,i,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=o.a.keys(j);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(c=e.t1.value,!Object.prototype.hasOwnProperty.call(j,c)){e.next=10;break}if(!j[c][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(r="",p[n]&&(r=p[n].SeedServiceProvided),!(a||s&&b)){e.next=18;break}be(),e.next=29;break;case 18:if(!r||!n){e.next=28;break}return e.next=21,x.a.get("/api/gun/otheruser/".concat(n,"/load/offeredServices>").concat(r));case 21:l=e.sent,i=l.data,d=i.data.servicePrice,console.log(i),se({servicePrice:d,serviceID:r}),e.next=29;break;case 28:D("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[j,se,D,be,p,n,b,s]),fe=Object(d.useCallback)(function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),z(""),_(!1),X(""),D(null),se(null),ue([]),M([]);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[X,z,D,se,ue,M]),he=Object(d.useCallback)((function(e){var t=e.target,a=t.value;switch(t.name){case"title":return _(!1),void z(a);case"description":return void X(a);case"postType":return void ee(a);case"createPost":return void console.log("create post");default:return}}),[z,X]),me=Object(d.useCallback)((function(e){e.preventDefault(),console.log(e.target.files),ue(e.target.files);var t=Array.from(e.target.files).map((function(e,t){return console.log("doing file..."),new Promise((function(a){var n=e.type,c=new FileReader;c.onload=function(e){n.startsWith("image/")&&a({type:"image",uri:e.target.result,index:t}),n.startsWith("video/")&&a({type:"video",uri:e.target.result,index:t})},c.readAsDataURL(e)}))}));Promise.allSettled(t).then((function(e){var t=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value)})),console.log(t),M(t)}))}),[ue,M]),Oe=Object(d.useCallback)((function(e){e.preventDefault(),te.current.click()}),[te]),xe=Object(d.useCallback)((function(e){e.preventDefault(),ae.current.click()}),[ae]);return Object(P.jsxs)(C.a,{padding:!0,pageTitle:"PUBLISH CONTENT",scrolls:!0,"data-v-382d115b":"",children:[A?Object(P.jsx)(O.a,{overlay:!0,fullScreen:!0,text:"Publishing content...","data-v-382d115b":""}):null,Object(P.jsxs)("h2",{"data-v-382d115b":"",children:["Say Something",Object(P.jsx)("div",{className:"line","data-v-382d115b":""})]}),Object(P.jsxs)("form",{className:"publish-content-form",onSubmit:pe,onReset:fe,"data-v-382d115b":"",children:[Object(P.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},"data-v-382d115b":"",children:[Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"title","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Title"})})}),Object(P.jsxs)("div",{"data-v-382d115b":"",children:[Object(P.jsxs)("strong",{"data-v-382d115b":"",children:["Audience:"," ",Object(P.jsx)("i",{className:"fas ".concat("public"===$?"fa-globe-europe":"fa-credit-card"),"data-v-382d115b":""})]}),Object(P.jsxs)("select",{name:"postType",id:"postType",onChange:he,style:{appearance:"none",backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)",marginLeft:"0.3rem"},"data-v-382d115b":"",children:[Object(P.jsx)("option",{value:"public",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},"data-v-382d115b":"",children:"Public"}),Object(P.jsx)("option",{value:"private","data-v-382d115b":"",children:"Paywall"})]})]})]}),Object(P.jsx)("input",{type:"text",name:"title",placeholder:"How I monetized my content with ShockWallet",value:L,onChange:he,className:v()("input-field",K&&"input-field-error"),"data-v-382d115b":""}),Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"contents","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Contents"})})}),Object(P.jsxs)("div",{className:E.length>0?N.m:"publish-content-icons","data-v-382d115b":"",children:[Object(P.jsx)("i",{className:"fas fa-images publish-content-icon",onClick:Oe,"data-v-382d115b":""}),Object(P.jsx)("i",{className:"fas fa-video publish-content-icon",onClick:xe,"data-v-382d115b":""})]}),Object(P.jsxs)("div",{className:v()((e={},Object(r.a)(e,v()("publish-content-preview",N.k),E.length>0),Object(r.a)(e,N.m,0===E.length),e)),"data-v-382d115b":"",children:[E.length>0&&E.map((function(e,t){return"image"===e.type?Object(P.jsx)("img",{alt:"Media preview ".concat(t+1),src:e.uri,width:288,className:"m-1","data-v-382d115b":""},e.index.toString()):"video"===e.type?Object(P.jsx)("video",{src:e.uri,controls:!0,width:288,className:"m-1","data-v-382d115b":""},e.index.toString()):(console.error("Unknown type of preview --| ".concat(e.type," |-- found inside <PublishContentPage />")),null)})),Object(P.jsx)("div",{className:"remove-btn",onClick:Object(d.useCallback)((function(){ue([]),M([])}),[]),"data-v-382d115b":"",children:Object(P.jsx)("i",{className:"far fa-trash-alt","data-v-382d115b":""})})]}),Object(P.jsx)("div",{className:"publish-content-title","data-v-382d115b":"",children:Object(P.jsx)("label",{htmlFor:"description","data-v-382d115b":"",children:Object(P.jsx)("strong",{"data-v-382d115b":"",children:"Description"})})}),Object(P.jsx)("textarea",{name:"description",placeholder:"I made a quick video to show you guys how easy it is to run your own social platform on ShockWallet, and start earning Bitcoin",rows:3,value:V,onChange:he,className:"input-field","data-v-382d115b":""}),T?Object(P.jsx)("p",{className:"error-container","data-v-382d115b":"",children:T}):null,Object(P.jsxs)("div",{className:"flex-center","data-v-382d115b":"",children:[Object(P.jsx)("input",{type:"reset",value:"Reset",className:"shock-form-button m-1","data-v-382d115b":""}),Object(P.jsx)("input",{type:"submit",value:"Submit",className:"shock-form-button-confirm m-1","data-v-382d115b":""})]})]}),re&&Object(P.jsx)(S.a,{modalOpen:re&&!A,toggleModal:ve,"data-v-382d115b":"",children:Object(P.jsxs)("div",{style:{padding:"1rem"},"data-v-382d115b":"",children:[Object(P.jsxs)("p",{"data-v-382d115b":"",children:["The service from the default service provider will cost:"," ",Object(P.jsxs)("strong",{"data-v-382d115b":"",children:[re.servicePrice," sats"]})]}),Object(P.jsx)("button",{className:"shock-form-button m-1",onClick:fe,"data-v-382d115b":"",children:"cancel"}),Object(P.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:je,"data-v-382d115b":"",children:"confirm"})]})}),Object(P.jsx)("input",{type:"file",id:"file",ref:te,className:N.m,accept:"image/*",onChange:me,"data-v-382d115b":""}),Object(P.jsx)("input",{type:"file",id:"file",ref:ae,className:N.m,accept:"video/*",onChange:me,"data-v-382d115b":""})]})}}}]);
//# sourceMappingURL=38.7678335e.chunk.js.map