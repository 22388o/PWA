(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[17],{482:function(e,t,n){"use strict";var a=n(3),r=n(73),c=n.n(r),s=(n(484),n(7)),o=function(e){var t=e.children,n=e.style;return Object(s.jsx)("div",{className:"modal-content",style:n,children:t})},i=(n(485),function(e){var t=e.title,n=e.toggleModal;return t?Object(s.jsxs)("div",{className:"modal-head",children:[Object(s.jsx)("p",{className:"modal-head-title",children:t}),Object(s.jsx)("div",{className:"modal-head-close",onClick:n,children:Object(s.jsx)("i",{className:"fas fa-times"})})]}):null});n(486),t.a=function(e){var t=e.modalOpen,n=void 0!==t&&t,r=e.toggleModal,l=e.modalTitle,u=void 0===l?"":l,d=e.children,b=e.contentStyle,j=void 0===b?{}:b,p=Object(a.useCallback)((function(){r()}),[r]);return Object(s.jsxs)("div",{className:c()({modal:!0,"modal-open":n}),children:[Object(s.jsx)("div",{className:"modal-backdrop",onClick:p}),Object(s.jsxs)("div",{className:"modal-container",children:[Object(s.jsx)(i,{title:u,toggleModal:p}),Object(s.jsx)(o,{style:j,children:d})]})]})}},483:function(e,t,n){"use strict";n(3),n(493);var a=n(7);t.a=function(e){var t=e.tipCounter,n=e.tipValue,r=e.zoomed;return n>0?Object(a.jsxs)("div",{className:"ribbon-container",style:{opacity:r?0:1},children:[Object(a.jsx)("p",{className:"ribbon-title",children:"Total Tips"}),Object(a.jsxs)("p",{className:"ribbon-value",children:[t," ",1===t?"Tip":"Tips"]})]}):null}},484:function(e,t,n){},485:function(e,t,n){},486:function(e,t,n){},488:function(e,t,n){"use strict";var a=n(3),r=n(73),c=n.n(r),s=(n(489),n(7));t.a=function(e){var t=e.pageTitle,n=e.drawerVisible,r=Object(a.useCallback)((function(){window.history.back()}),[]);return Object(s.jsxs)("div",{className:"dialog-nav-container",children:[Object(s.jsx)("div",{className:"dialog-nav-back",onClick:r,children:Object(s.jsx)("i",{className:"icon icon-thin-back"})}),Object(s.jsx)("p",{className:"dialog-nav-title",children:t}),Object(s.jsxs)("div",{className:c()({"dialog-nav-menu-btn":!0,"dialog-nav-hidden":!n}),children:[Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"}),Object(s.jsx)("div",{className:"dialog-nav-menu-dash"})]})]})}},489:function(e,t,n){},493:function(e,t,n){},499:function(e,t,n){},501:function(e,t,n){"use strict";var a=n(2),r=n.n(a),c=n(5),s=n(17),o=n(3),i=n(483),l=(n(502),n(152)),u=n(14),d=n(7),b="".concat("https://webtorrent.shock.network","/rtmpapi/api/streams/live");t.a=function(e){e.id;var t=e.item,n=(e.index,e.postId,e.tipValue),a=e.tipCounter,j=e.hideRibbon,p=e.width,m=e.timeout,v=void 0===m?1e4:m,f=Object(o.useRef)(null),h=Object(o.useState)(!1),O=Object(s.a)(h,2),x=O[0],k=O[1],g={width:"100%"};return p&&(g.width=p),Object(o.useEffect)((function(){var e=null,n=function(){var e=Object(c.a)(r.a.mark((function e(){var n,a,c,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.magnetURI.split("/live/")[1].split("/index.m3u8"),a=Object(s.a)(n,1),c=a[0],e.next=4,u.a.get("".concat(b,"/").concat(c));case 4:if(e.sent.data.isLive){e.next=7;break}return e.abrupt("return",!1);case 7:return(o=Object(l.a)(f.current,{autoplay:!0,muted:!0,aspectRatio:"16:9"})).src({src:t.magnetURI,type:"application/x-mpegURL"}),o.play(),e.abrupt("return",!0);case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(){return e.apply(this,arguments)}}();return n().then((function(t){t?k(!0):e=setInterval(Object(c.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n();case 2:if(!t.sent){t.next=7;break}return k(!0),clearInterval(e),t.abrupt("return");case 7:case"end":return t.stop()}}),t)}))),v)})),function(){clearInterval(e)}}),[t]),Object(d.jsx)("div",{className:"media-container w-100",children:Object(d.jsxs)("div",{className:"video-container w-100",style:{cursor:"pointer",width:"100%"},children:[!x&&Object(d.jsx)("p",{children:"The streamer has disconnected."}),Object(d.jsx)("div",{style:x?{width:"100%"}:{display:"none",width:"100%"},children:Object(d.jsx)("video",{className:"video-js vjs-default-skin",ref:f,style:g,preload:"auto",controls:!0,muted:!0,autoPlay:!0})}),!j&&Object(d.jsx)(i.a,{tipCounter:a,tipValue:n,zoomed:!1})]})})}},502:function(e,t,n){},566:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),r=n(2),c=n.n(r),s=n(5),o=n(14),i=function(){var e=Object(s.a)(c.a.mark((function e(t,n){var a,r,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Uint8Array(32),window.crypto.getRandomValues(a),r=Array.prototype.map.call(a,(function(e){return("00"+e.toString(16)).slice(-2)})).join(""),s={seed_token:n,wallet_token:r},e.next=6,fetch("".concat(t,"/api/enroll_token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 6:if(200===e.sent.status){e.next=9;break}throw new Error("torrentSeed service currently not available");case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l=function(){var e=Object(s.a)(c.a.mark((function e(t){var n,r,s,l,u,d,b,j,p,m,v,f,h,O,x;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.availableTokens,r=t.seedUrl,s=t.seedToken,l=t.seedProviderPub,u=t.serviceID,d=t.servicePrice,b=null,j=!1,p=null,e.t0=c.a.keys(n);case 5:if((e.t1=e.t0()).done){e.next=14;break}if(m=e.t1.value,!Object.prototype.hasOwnProperty.call(n,m)){e.next=12;break}if(!(v=n[m])[0]){e.next=12;break}return p={seedUrl:m,tokens:v},e.abrupt("break",14);case 12:e.next=5;break;case 14:if(console.log(l),console.log(u),console.log(d),!r||!s){e.next=27;break}return console.log("USING SELF SEED TOKEN"),e.next=21,i(r,s);case 21:f=e.sent,console.log("token"),console.log(f),b={seedUrl:r,tokens:[f]},e.next=48;break;case 27:if(!p){e.next=33;break}console.log("USING AVAILABLE TOKEN"),b=p,j=!0,e.next=48;break;case 33:if(!(l&&u&&d)){e.next=47;break}return console.log("USING DEFAULT TOKEN PROVIDER"),e.next=37,o.a.post("/api/lnd/unifiedTrx",{type:"service",amt:d,to:l,memo:"",feeLimit:500,ackInfo:u});case 37:if(h=e.sent,O=h.data,200===h.status){e.next=42;break}throw new Error("seed token request failed");case 42:console.log(O),x=O.orderAck,b=JSON.parse(x.response),e.next=48;break;case 47:throw new Error("provide the token data or use default seed provider");case 48:return e.abrupt("return",Object(a.a)(Object(a.a)({},b),{},{deleteToken:j}));case 49:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},757:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(5),s=n(17),o=n(3),i=n(37),l=n(41),u=(n(499),n(150)),d=n(14),b=n(488),j=n.p+"static/media/obs-2.7c61e78e.svg",p=n(501),m=n(566),v=n(21),f=n(482),h=n(20),O=n(7);t.default=function(){var e=Object(i.c)(),t=Object(v.g)(),n=h.useSelector((function(e){return e.content.seedProviderPub})),a=h.useSelector((function(e){return e.content.seedInfo})),x=a.seedUrl,k=a.seedToken,g=h.useSelector((function(e){return e.content.streamLiveToken})),y=h.useSelector((function(e){return e.content.streamUserToken})),w=h.useSelector((function(e){return e.content.availableTokens})),N=h.useSelector((function(e){return e.content.streamUrl})),S=h.useSelector((function(e){return e.userProfiles})),C=Object(o.useState)("obs"),T=Object(s.a)(C,2),P=T[0],I=T[1],U=Object(o.useState)(!1),E=Object(s.a)(U,2),R=E[0],L=E[1],V=Object(o.useState)(g),A=Object(s.a)(V,2),D=A[0],B=A[1],M=Object(o.useState)(y),G=Object(s.a)(M,2),J=(G[0],G[1]),K=Object(o.useState)("Look I'm streaming!"),z=Object(s.a)(K,2),_=z[0],F=z[1],q=Object(o.useState)(!0),W=Object(s.a)(q,2),Y=W[0],H=(W[1],Object(o.useState)(null)),Q=Object(s.a)(H,2),X=Q[0],Z=Q[1],$=Object(o.useState)(""),ee=Object(s.a)($,2),te=ee[0],ne=ee[1],ae=Object(o.useState)(null),re=Object(s.a)(ae,2),ce=re[0],se=re[1],oe=Object(o.useCallback)(function(){var t=Object(c.a)(r.a.mark((function t(a,c){var o,i,u,b,j,p,v,f,h,O,g,y,N;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,L(!0),t.next=4,Object(m.a)({availableTokens:w,seedProviderPub:n,seedToken:k,seedUrl:x,serviceID:c,servicePrice:a});case 4:return o=t.sent,i=o.seedUrl,u=o.tokens,b=Object(s.a)(u,1),j=b[0],J(j),t.next=11,d.a.post("".concat(i,"/api/stream/auth"),{token:j});case 11:return p=t.sent,v=p.data,f=v.data.token,console.log(f),h="".concat(j,"?key=").concat(f),B("".concat(j,"?key=").concat(f)),O="".concat(i,"/rtmpapi/live/").concat(j,"/index.m3u8"),g=i.replace("https","rtmp"),ne("".concat(g,"/live")),Object(l.d)(j,h,O)(e),y=[],""!==_&&y.push({type:"text/paragraph",text:_}),y.push({type:"stream/embedded",width:0,height:0,magnetURI:O,isPreview:!1,isPrivate:!1,userToken:j}),t.next=26,d.a.post("/api/gun/wall",{tags:[],title:"Post",contentItems:y});case 26:200===t.sent.status?(console.log("post created successfully"),L(!1)):(Z("invalid response status"),L(!1)),t.next=35;break;case 30:t.prev=30,t.t0=t.catch(0),console.log(t.t0),Z(null!==(N=null===t.t0||void 0===t.t0?void 0:t.t0.errorMessage)&&void 0!==N?N:null===t.t0||void 0===t.t0?void 0:t.t0.message),L(!1);case 35:case"end":return t.stop()}}),t,null,[[0,30]])})));return function(e,n){return t.apply(this,arguments)}}(),[_,n,x,k,L,B,Z,J,ne,l.d]),ie=Object(o.useCallback)((function(){se(null)}),[se]),le=Object(o.useCallback)((function(){var e=ce.servicePrice,t=ce.serviceID;oe(e,t),se(null)}),[ce,oe,se]),ue=Object(o.useCallback)(function(){var e=Object(c.a)(r.a.mark((function e(t){var a,c,s,o,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a=!1,e.t0=r.a.keys(w);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(c=e.t1.value,!Object.prototype.hasOwnProperty.call(w,c)){e.next=10;break}if(!w[c][0]){e.next=10;break}return a=!0,e.abrupt("break",12);case 10:e.next=3;break;case 12:if(s="",S[n]&&(s=S[n].SeedServiceProvided),!(a||x&&k)){e.next=18;break}oe(),e.next=29;break;case 18:if(!s||!n){e.next=28;break}return e.next=21,d.a.get("/api/gun/otheruser/".concat(n,"/load/offeredServices>").concat(s));case 21:o=e.sent,i=o.data,l=i.data.servicePrice,console.log(i),se({servicePrice:l,serviceID:s}),e.next=29;break;case 28:Z("No way found to publish content");case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[w,se,Z,oe]),de=Object(o.useCallback)((function(){navigator.clipboard.writeText(D)}),[D]),be=Object(o.useCallback)((function(){navigator.clipboard.writeText(te)}),[]),je=Object(o.useCallback)((function(e){var t=e.target,n=t.value,a=t.name;t.checked;switch(a){case"paragraph":return void F(n);case"source":return void I(n);default:return}}),[F,I]),pe=Object(o.useCallback)((function(){Object(l.f)()(e),t.push("/profile")}),[t]),me=Object(o.useMemo)((function(){return Object(O.jsx)(p.a,{hideRibbon:!0,item:{magnetURI:N},timeout:1500})}),[N]);return Object(O.jsxs)("div",{className:"h-100 m-1",children:[R?Object(O.jsx)(u.a,{overlay:!0,fullScreen:!0,text:""}):null,Object(O.jsx)(b.a,{drawerVisible:!1,pageTitle:"GO LIVE"}),Y&&Object(O.jsx)("div",{children:me}),Object(O.jsxs)("select",{value:P,onChange:je,name:"source",id:"source",style:{backgroundColor:"rgba(0,0,0,0)",color:"white",width:"100%",border:"0",marginBottom:"1em"},children:[Object(O.jsx)("option",{value:"camera",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},children:"Camera"}),Object(O.jsx)("option",{value:"obs",style:{backgroundColor:"rgba(0,0,0,0)",color:"var(--main-blue)"},children:"OBS"})]}),Object(O.jsxs)("div",{className:"flex-center m-b-1",children:["obs"===P&&Object(O.jsx)("img",{src:j,style:{width:"10em",height:"10em"},alt:""}),"camera"===P&&Object(O.jsx)("i",{className:"fas fa-camera",style:{fontSize:"10em"}})]}),D?Object(O.jsxs)("div",{children:["obs"===P&&Object(O.jsx)("p",{className:"m-b-1",children:"You are ready to go! setup the stream with OBS and watch it from your profile"}),Object(O.jsx)("p",{children:"Broadcaster:"}),Object(O.jsxs)("div",{style:{border:"1px solid var(--main-blue)",padding:"0.5rem",display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[Object(O.jsx)("p",{children:te.substring(0,20)+(te.length>21?"...":"")}),Object(O.jsx)("i",{className:"far fa-copy",onClick:be})]}),Object(O.jsx)("p",{children:"Stream Key:"}),Object(O.jsxs)("div",{style:{border:"1px solid var(--main-blue)",padding:"0.5rem",display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[Object(O.jsx)("p",{children:D.substring(0,20)+(D.length>21?"...":"")}),Object(O.jsx)("i",{className:"far fa-copy",onClick:de})]}),Object(O.jsx)("div",{className:"flex-center",children:Object(O.jsx)("button",{onClick:pe,className:"shock-form-button-confirm",children:"STOP"})})]}):Object(O.jsxs)("div",{className:"vertical-flex-center",children:[Object(O.jsx)("input",{className:"input-field",type:"text",name:"paragraph",id:"paragraph",value:_,onChange:je}),Object(O.jsx)("button",{onClick:ue,className:"shock-form-button-confirm",children:"START NOW"})]}),X?Object(O.jsx)("p",{className:"error-container",children:X}):null,ce&&Object(O.jsx)(f.a,{modalOpen:ce&&!R,toggleModal:ie,children:Object(O.jsxs)("div",{style:{padding:"1rem"},children:[Object(O.jsxs)("p",{children:["The service from the default service provider will cost: ",Object(O.jsxs)("strong",{children:[ce.servicePrice," sats"]})]}),Object(O.jsx)("button",{className:"shock-form-button m-1",onClick:ie,children:"cancel"}),Object(O.jsx)("button",{className:"shock-form-button-confirm m-1",onClick:le,children:"confirm"})]})})]})}}}]);
//# sourceMappingURL=17.82d3e28a.chunk.js.map