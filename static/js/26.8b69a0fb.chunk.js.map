{"version":3,"sources":["common/DialogNav/index.js","utils/Platform.ts","common/QRCodeScanner/index.tsx","utils/validators.ts","pages/QRScanner/index.tsx"],"names":["DIALOG_NAV_MIN_HEIGHT_PX","CONTAINER_STYLE","minHeight","DialogNav","pageTitle","drawerVisible","onHeight","Utils","goBack","useCallback","window","history","back","divRefCb","el","getBoundingClientRect","height","e","console","log","className","ref","style","onClick","classNames","isDesktop","navigator","userAgent","match","modeContents","wizard","title","target","description","invoice","QRCodeScanner","mode","onScan","onError","onClose","content","facingMode","constraints","video","exact","btcAddress","lnInvoice","lnPubKey","extractInfo","data","cleanData","value","includes","split","removePrefix","amountSplit","amount","Math","floor","Number","address","toString","undefined","hasAmount","test","isBitcoinAddress","type","toLowerCase","isLightningPaymentRequest","request","isLightningPubKey","startsWith","isShockPubKey","pk","found","res","exec","findlnurl","lnurl","toUpperCase","QRScanner","useHistory","dispatch","useDispatch","useSelector","node","publicKey","useState","loading","setLoading","privateChannel","setPrivateChannel","payAmount","setPayAmount","withdrawAmount","setWithdrawAmount","hasMemo","setHasMemo","memo","setMemo","LNURLdata","setLNURLdata","scanQR","setScanQR","setDone","setError","push","onInputChange","name","checked","decodeLNURL","a","getParams","params","tag","p","reason","message","decodeAll","result","info","ExtractInfo","JSON","stringify","closeQR","scanDone","text","confirmWithdrawReq","callback","k1","Http","post","expiry","payReq","completeUrl","payment_request","fetch","json","status","confirmChannelReq","uri","newK1","shockPubKey","samePeer","pub_key","fetchPeers","peers","find","plit","host","connectPeer","get","nodeId","identity_pubkey","priv","confirmPayReq","pr","toRender","useMemo","onChange","maxWithdrawable","placeholder","minSendable","maxSendable","scanErr","Loader","overlay","fullScreen"],"mappings":"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","file":"static/js/26.8b69a0fb.chunk.js","sourcesContent":["// @ts-check\nimport { useCallback } from \"react\";\nimport classNames from \"classnames\";\n/**\n * @typedef {import('react').RefCallback<HTMLElement>} DivRefCallback\n */\n\nimport * as Utils from \"../../utils\";\n\nimport \"./css/index.scoped.css\";\n\nexport const DIALOG_NAV_MIN_HEIGHT_PX = 73;\n/** @type {import('react').CSSProperties} */\nconst CONTAINER_STYLE = {\n  minHeight: DIALOG_NAV_MIN_HEIGHT_PX\n};\n\nconst DialogNav = ({\n  pageTitle,\n  drawerVisible = false,\n  onHeight = Utils.EMPTY_FN\n}) => {\n  const goBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  /** @type {DivRefCallback} */\n  const divRefCb = useCallback(\n    el => {\n      // https://www.pluralsight.com/tech-blog/getting-size-and-position-of-an-element-in-react/\n      if (!el) return;\n      try {\n        onHeight(el.getBoundingClientRect().height);\n      } catch (e) {\n        console.log(`Error inside onHeight mechanism in DialogNav:`);\n        console.log(e);\n      }\n    },\n    [onHeight]\n  );\n\n  return (\n    <div\n      className=\"dialog-nav-container\"\n      ref={divRefCb}\n      style={CONTAINER_STYLE}\n    >\n      <div className=\"dialog-nav-back\" onClick={goBack}>\n        <i className=\"icon icon-thin-back\"></i>\n      </div>\n      <p className=\"dialog-nav-title\">{pageTitle}</p>\n      <div\n        className={classNames({\n          \"dialog-nav-menu-btn\": true,\n          \"dialog-nav-hidden\": !drawerVisible\n        })}\n      >\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n      </div>\n    </div>\n  );\n};\n\nexport default DialogNav;\n","export const isMobile = (): boolean =>\n  !!navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);\n\nexport const isDesktop = (): boolean => (!isMobile() ? true : false);\n","import QRScanner from \"react-qr-scanner\";\nimport { isDesktop } from \"../../utils/Platform\";\nimport \"./css/index.scoped.css\";\n\ntype ScannerMode = \"wizard\" | \"invoice\";\ninterface Props {\n  mode: ScannerMode;\n  onScan: (result: string | null) => void;\n  onError: (error: Error) => void;\n  onClose: () => void;\n}\n\nconst modeContents = {\n  wizard: {\n    title: \"SCAN A\",\n    target: \"QR CODE\",\n    description: \"Point your camera at a ShockWizard QR Code\"\n  },\n  invoice: {\n    title: \"SCAN AN\",\n    target: \"INVOICE\",\n    description: \"Point your camera at an LND Invoice\"\n  }\n};\n\nconst QRCodeScanner = ({\n  mode = \"wizard\",\n  onScan,\n  onError,\n  onClose\n}: Props) => {\n  const content = modeContents[mode];\n  const facingMode = isDesktop() ? \"user\" : \"environment\";\n\n  return (\n    <div className=\"qr-code-scanner-container\">\n      <div className=\"qr-scanner-top-section\">\n        <i className=\"fas fa-times\" onClick={onClose}></i>\n      </div>\n\n      <QRScanner\n        constraints={{\n          video: {\n            facingMode: { exact: facingMode }\n          }\n        }}\n        onScan={onScan}\n        onError={onError}\n      />\n\n      <div className=\"qr-scanner-target\" />\n      <div className=\"qr-scanner-bottom-section\">\n        <p className=\"qr-scanner-bottom-title\">\n          {content.title}{\" \"}\n          <span className=\"qr-scanner-bottom-title-highlight\">\n            {content.target}\n          </span>\n        </p>\n        <p className=\"qr-scanner-bottom-description\">{content.description}</p>\n        <div className=\"qr-scanner-btn\" onClick={onClose}>\n          Cancel Scan\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QRCodeScanner;\n","const btcAddress = /^(bc(1|r)|[123]|m|n|((t|x)pub)|(tb1))[a-zA-HJ-NP-Z0-9]{25,90}$/;\nconst lnInvoice = /^(ln(tb|bc|bcrt))[0-9][a-z0-9]{180,7089}$/;\nconst lnPubKey = /^[a-f0-9]{66}$/;\n\nexport const removePrefix = (data: string): string => {\n  let value = data;\n  if (data.includes(\"bitcoin:\")) {\n    [, value] = data.split(\"bitcoin:\");\n  } else if (data.includes(\"lightning:\")) {\n    [, value] = data.split(\"lightning:\");\n  } else if (data.includes(\"LIGHTNING:\")) {\n    [, value] = data.split(\"LIGHTNING:\");\n  }\n\n  return value;\n};\n\nexport const hasAmount = (\n  data: string\n): { address: string; amount: undefined | string } => {\n  if (data.includes(\"?amount=\")) {\n    const amountSplit = data.split(\"?amount=\");\n\n    const amount = Math.floor(Number(amountSplit[1]) * 100000000);\n    return { address: amountSplit[0], amount: amount.toString() };\n  }\n  return { address: data, amount: undefined };\n};\n\nexport const isBitcoinAddress = (data: string) => {\n  return btcAddress.test(data);\n};\n\nexport const isLightningPaymentRequest = (data: string) =>\n  lnInvoice.test(data.toLowerCase());\n\nexport const isLightningPubKey = (data: string) => lnPubKey.test(data);\n\nexport const isShockPubKey = (data: string) =>\n  data.startsWith(\"$$__SHOCKWALLET__USER__\");\n\nexport const findlnurl = (data: string) => {\n  const res = /^(http.*[&?]lightning=)?((lnurl)([0-9]{1,}[a-z0-9]+){1})/.exec(\n    data.toLowerCase()\n  );\n  if (res) {\n    return res[2];\n  }\n  return null;\n};\nexport type ExtractedBTCAddress = {\n  type: \"btc\";\n  address: string;\n  amount?: string;\n};\nexport type ExtractedLNInvoice = {\n  type: \"ln\";\n  request: string;\n};\nexport type ExtractedKeysend = {\n  type: \"keysend\";\n  address: string;\n};\nexport type ExtractedShockPK = {\n  type: \"pk\";\n  pk: string;\n};\nexport type ExtractedLNURL = {\n  type: \"lnurl\";\n  lnurl: string;\n};\nexport type ExtractedUnknown = {\n  type: \"unknown\";\n};\n\n/**\n * @param {string} data\n * @returns {ExtractedBTCAddress|ExtractedLNInvoice|ExtractedKeysend|ExtractedShockPK|ExtractedUnknown|ExtractedLNURL}\n */\nconst extractInfo = (\n  data: string\n):\n  | ExtractedBTCAddress\n  | ExtractedLNInvoice\n  | ExtractedKeysend\n  | ExtractedShockPK\n  | ExtractedUnknown\n  | ExtractedLNURL => {\n  const cleanData = removePrefix(data);\n  const { address, amount } = hasAmount(cleanData);\n  if (isBitcoinAddress(address)) {\n    return {\n      type: \"btc\",\n      address,\n      amount\n    };\n  }\n  if (isLightningPaymentRequest(cleanData)) {\n    return {\n      type: \"ln\",\n      request: cleanData\n    };\n  }\n  if (isLightningPubKey(cleanData)) {\n    return {\n      type: \"keysend\",\n      address: cleanData\n    };\n  }\n  if (isShockPubKey(cleanData)) {\n    return {\n      type: \"pk\",\n      pk: cleanData\n    };\n  }\n\n  const found = findlnurl(cleanData);\n  if (found) {\n    return {\n      type: \"lnurl\",\n      lnurl: found.toUpperCase()\n    };\n  }\n  return { type: \"unknown\" };\n};\n\nexport default extractInfo;\n","import React, {\n  Suspense,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState\n} from \"react\";\nimport { useHistory } from \"react-router\";\nimport {\n  getParams,\n  LNURLAuthParams,\n  LNURLChannelParams,\n  LNURLPayParams,\n  LNURLResponse,\n  LNURLWithdrawParams\n} from \"js-lnurl\";\nimport DialogNav from \"../../common/DialogNav\";\nimport Loader from \"../../common/Loader\";\nimport QRCodeScanner from \"../../common/QRCodeScanner\";\nimport ExtractInfo from \"../../utils/validators\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Http } from \"../../utils\";\nimport { connectPeer, fetchPeers } from \"../../actions/WalletActions\";\n\nconst QRScanner = () => {\n  const history = useHistory();\n  const dispatch = useDispatch();\n  //@ts-ignore\n  const publicKey = useSelector(({ node }) => node.publicKey);\n  const [loading, setLoading] = useState(false);\n  const [privateChannel, setPrivateChannel] = useState(true);\n  const [payAmount, setPayAmount] = useState(0);\n  const [withdrawAmount, setWithdrawAmount] = useState(0);\n  const [hasMemo, setHasMemo] = useState(false);\n  const [memo, setMemo] = useState(\"\");\n  const [LNURLdata, setLNURLdata] = useState(null);\n  const [scanQR, setScanQR] = useState(true);\n  const [done, setDone] = useState(null);\n  const [error, setError] = useState(null);\n  const goBack = useCallback(() => {\n    history.push(\"/overview\");\n  }, [history]);\n  const onInputChange = useCallback(\n    e => {\n      const { value, name, checked } = e.target;\n      //e.preventDefault()\n      switch (name) {\n        case \"privateChannel\": {\n          setPrivateChannel(checked);\n          return;\n        }\n        case \"payAmount\": {\n          setPayAmount(value);\n          return;\n        }\n        case \"withdrawAmount\": {\n          setWithdrawAmount(value);\n          return;\n        }\n        case \"hasMemo\": {\n          setHasMemo(checked);\n          return;\n        }\n        case \"memo\": {\n          setMemo(value);\n          return;\n        }\n        case \"memo\": {\n          setMemo(value);\n          return;\n        }\n        default:\n          return;\n      }\n    },\n    [setPrivateChannel, setPayAmount, setWithdrawAmount, setHasMemo, setMemo]\n  );\n  const decodeLNURL = useCallback(async data => {\n    setLoading(true);\n    try {\n      const params = await getParams(data);\n      //@ts-ignore\n      if (!params.tag) {\n        const p = params as LNURLResponse;\n        setLoading(false);\n        setError(p.reason);\n      }\n      const p = params as\n        | LNURLChannelParams\n        | LNURLWithdrawParams\n        | LNURLAuthParams\n        | LNURLPayParams;\n      switch (p.tag) {\n        case \"channelRequest\": {\n          console.log(\"this url is a channel request\");\n          break;\n        }\n        case \"withdrawRequest\": {\n          console.log(\"this url is a withdrawal request\");\n          break;\n        }\n        case \"hostedChannelRequest\": {\n          console.log(\"this url is a hosted channel request\");\n          break;\n        }\n        case \"login\": {\n          console.log(\"this url is a login \");\n          break;\n        }\n        case \"payRequest\": {\n          console.log(\"this url is a pay request\");\n          break;\n        }\n        default: {\n          console.log(\"unknown tag\");\n        }\n      }\n      setLNURLdata(p);\n      setLoading(false);\n    } catch (e) {\n      console.log(e);\n      setLoading(false);\n      setError(e.message || e);\n    }\n  }, []);\n  const decodeAll = useCallback(\n    result => {\n      console.log(\"decoding!\");\n      const info = ExtractInfo(result);\n      switch (info.type) {\n        case \"btc\":\n        case \"ln\":\n        case \"keysend\": {\n          history.push(\"/send\", {\n            data: info\n          });\n          return;\n        }\n        case \"pk\": {\n          history.push(`/otherUser/${info.pk}`);\n          return;\n        }\n        case \"lnurl\": {\n          decodeLNURL(info.lnurl);\n          return;\n        }\n        case \"unknown\": {\n          setError(\"cant decode\" + JSON.stringify(info));\n        }\n      }\n    },\n    [history, setError, decodeLNURL]\n  );\n  const closeQR = useCallback(() => {\n    setScanQR(false);\n    history.push(\"/overview\");\n  }, [setScanQR]);\n  const scanDone = useCallback(\n    content => {\n      console.log(content);\n      if (!content || !content.text) {\n        return;\n      }\n      decodeAll(content.text);\n      setScanQR(false);\n    },\n    [decodeAll, setScanQR]\n  );\n\n  const confirmWithdrawReq = useCallback(async () => {\n    try {\n      const { callback, k1 } = LNURLdata;\n      const { data: payReq } = await Http.post(\"/api/lnd/addinvoice\", {\n        value: withdrawAmount,\n        memo: memo,\n        expiry: 1800\n      });\n      const completeUrl = `${callback}?k1=${k1}&pr=${payReq.payment_request}`;\n      console.log(completeUrl);\n      const res = await fetch(completeUrl);\n      const json = await res.json();\n      if (json.status === \"OK\") {\n        setDone(\"Withdraw request sent correctly\");\n      } else {\n        setError(json.reason);\n      }\n    } catch (e) {\n      setError(e.message || e);\n    }\n  }, [history, LNURLdata, withdrawAmount, memo, setDone, setError]);\n  const confirmChannelReq = useCallback(async () => {\n    try {\n      const { uri, callback, k1 } = LNURLdata;\n      let newK1 = k1;\n      if (k1 === \"gun\" && LNURLdata.shockPubKey) {\n        newK1 = `$$__SHOCKWALLET__USER__${LNURLdata.shockPubKey}`;\n      }\n      const samePeer = e => {\n        const localUri = `${e.pub_key}@${e.address}`;\n        return localUri === uri;\n      };\n      const { peers } = await fetchPeers()(dispatch);\n      if (!peers.find(samePeer)) {\n        const [publicKey, host] = uri.plit(\"@\");\n        await connectPeer({ publicKey, host });\n      }\n\n      const { data: node } = await Http.get(\"/healthz\");\n      const nodeId = node.identity_pubkey;\n      const priv = privateChannel ? 1 : 0;\n      const completeUrl = `${callback}?k1=${newK1}&remoteid=${nodeId}&private=${priv}`;\n      const res = await fetch(completeUrl);\n      const json = await res.json();\n      if (json.status === \"OK\") {\n        setDone(\"Channel request sent correctly\");\n      } else {\n        setError(json.reason);\n      }\n    } catch (e) {\n      setError(e.message || e);\n    }\n  }, [history, LNURLdata, setError]);\n  const confirmPayReq = useCallback(async () => {\n    try {\n      const { callback } = LNURLdata;\n      const completeUrl = `${callback}?amount=${payAmount * 1000}`;\n      console.log(completeUrl);\n      const res = await fetch(completeUrl);\n      const json = await res.json();\n      if (json.status === \"ERROR\") {\n        setError(json.reason);\n        return;\n      }\n      history.push(\"/send\", {\n        data: { type: \"ln\", request: json.pr }\n      });\n    } catch (e) {\n      setError(e.message || e);\n    }\n  }, [history, LNURLdata, payAmount, setError]);\n\n  const toRender = useMemo(() => {\n    if (LNURLdata === null) {\n      return null;\n    }\n    switch (LNURLdata.tag) {\n      case \"channelRequest\": {\n        console.log(\"this url is a channel request\");\n        return (\n          <div>\n            <h2>LNURL Channel Request</h2>\n            <p>\n              Requesting channel from:{LNURLdata.uri || \"ADDRESS NOT FOUND\"}\n            </p>\n            <input\n              type=\"checkbox\"\n              name=\"privateChannel\"\n              checked={privateChannel}\n              onChange={onInputChange}\n            />\n            <button onClick={confirmChannelReq}>CONNECT</button>\n          </div>\n        );\n      }\n      case \"withdrawRequest\": {\n        console.log(\"this url is a withdrawal request\");\n        return (\n          <div>\n            <h2>LNURL Channel Request</h2>\n            <p>\n              <strong>Max</strong>Withdrawable:{\" \"}\n              <strong>{LNURLdata.maxWithdrawable / 1000}</strong> Satoshi\n            </p>\n            <input\n              type=\"number\"\n              value={withdrawAmount}\n              name=\"withdrawAmount\"\n              onChange={onInputChange}\n            />\n            <input\n              type=\"checkbox\"\n              name=\"hasMemo\"\n              checked={hasMemo}\n              onChange={onInputChange}\n            />\n            {hasMemo && (\n              <input\n                type=\"text\"\n                value={memo}\n                name=\"memo\"\n                placeholder=\"memo\"\n                onChange={onInputChange}\n              />\n            )}\n            <button onClick={confirmWithdrawReq}>RECEIVE</button>\n          </div>\n        );\n      }\n      case \"hostedChannelRequest\": {\n        console.log(\"this url is a hosted channel request\");\n        return (\n          <div>\n            <h2>LNURL Hosted Channel Request</h2>\n            <p>This Request is not supported</p>\n            <button onClick={goBack}>BACK</button>\n          </div>\n        );\n      }\n      case \"login\": {\n        console.log(\"this url is a login \");\n        return (\n          <div>\n            <h2>LNURL Auth Request</h2>\n            <p>This Request is not supported</p>\n            <button onClick={goBack}>BACK</button>\n          </div>\n        );\n      }\n      case \"payRequest\": {\n        console.log(\"this url is a pay request\");\n        return (\n          <div>\n            <h2>LNURL Pay Request</h2>\n            <p>\n              <strong>Min</strong>Sendable:{\" \"}\n              <strong>{LNURLdata.minSendable / 1000}</strong> Satoshi\n            </p>\n            <p>\n              <strong>Max</strong>Sendable:{\" \"}\n              <strong>{LNURLdata.maxSendable / 1000}</strong> Satoshi\n            </p>\n            <input\n              type=\"number\"\n              value={payAmount}\n              name=\"payAmount\"\n              onChange={onInputChange}\n            />\n            <button onClick={confirmPayReq}>SEND</button>\n          </div>\n        );\n      }\n      default: {\n        console.log(\"unknown tag\");\n        return (\n          <div>\n            <h2>LNURL Unknown Request</h2>\n            <button onClick={goBack}>BACK</button>\n          </div>\n        );\n      }\n    }\n  }, [\n    LNURLdata,\n    privateChannel,\n    withdrawAmount,\n    hasMemo,\n    memo,\n    payAmount,\n    onInputChange,\n    goBack\n  ]);\n  const scanErr = useCallback(\n    (e: Error) => {\n      setError(e.message || e);\n    },\n    [setError]\n  );\n  if (scanQR) {\n    return (\n      <div>\n        <QRCodeScanner\n          mode=\"invoice\"\n          onClose={closeQR}\n          onError={scanErr}\n          onScan={scanDone}\n        />\n      </div>\n    );\n  }\n  return (\n    <div className=\"publish-content-form-container m-1\">\n      {loading ? <Loader overlay fullScreen text=\"\" /> : null}\n      <DialogNav drawerVisible={false} pageTitle=\"PUBLISH CONTENT\" />\n      <div>{toRender}</div>\n    </div>\n  );\n};\n\nexport default QRScanner;\n"],"sourceRoot":""}