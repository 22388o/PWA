(this["webpackJsonpshocknet-pwa"]=this["webpackJsonpshocknet-pwa"]||[]).push([[43],{625:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return O}));var r=n(3),a=n.n(r),c=n(5),u=n(1),o=n(13),i=n(23),s=n(649),l=n.n(s),f=function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,l.a._init){e.next=4;break}return e.next=4,new Promise((function(e,t){l.a.init("ShockWalletStore").then((function(){return console.log("File cache initialized!"),l.a.persist()})).then((function(n){n.persistent?e(n):t(n)}))}));case 4:return e.next=6,l.a.load(t);case 6:return n=e.sent,e.abrupt("return",n.createURL());case 10:return e.prev=10,e.t0=e.catch(0),console.warn(e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),d=function(e,t){var n=document.querySelectorAll(t);return n&&n.length&&n.forEach((function(t){t.src||(t.src=e,t.muted=!0,t.autoplay=!1)})),!!(null===n||void 0===n?void 0:n.length)},p=function(e,t){return l.a.save(e,t)},m=function(e){var t=Promise.resolve();return e.forEach((function(e){t=t.then((function(){return e()}))})),t},v={"video/embedded":{formats:["mp4","webm"],element:"video",options:{autoplay:!1,muted:!0}},"image/embedded":{formats:["jpg","png","webp","jpeg"],element:"img",options:{}}},b=(Object.values(v).reduce((function(e,t){return[].concat(Object(i.a)(e),Object(i.a)(t.formats))}),[]),function(e){var t,n;if(!e)return null;var r=null===(t=e.name)||void 0===t||null===(n=t.split("."))||void 0===n?void 0:n.slice(-1)[0],a=Object.entries(v).filter((function(e){var t=Object(o.a)(e,2);t[0];return t[1].formats.includes(r)})),c=Object(o.a)(a,1)[0];if(c){var i=Object(o.a)(c,2),s=i[0],l=i[1];return Object(u.a)({name:s},l)}return null}),h=null,g=function(){var e=Object(c.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=5;break}return e.next=3,Promise.all([n.e(14),n.e(20)]).then(n.t.bind(null,907,7));case 3:t=e.sent,h=new t.default;case 5:return e.abrupt("return",h);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(e){var t,n,r,a=e.thumbnailFile,c=e.fileType,u=e.item,o=b(a),i="".concat(null!==(t=null===o||void 0===o?void 0:o.element)&&void 0!==t?t:"img",'[data-torrent="').concat(u.magnetURI,'"]'),s='.dynamic-thumbnail[data-torrent="'.concat(u.magnetURI,'"]');a||"video"!==c.element||(null===(n=document.querySelector(i))||void 0===n||n.classList.add("hidden"),null===(r=document.querySelector(s))||void 0===r||r.classList.remove("hidden"))},x=function(e){var t=e.id,n=e.key;return function(e){return"".concat(t,"-").concat(n,"-").concat(e.name)}},y=function(e){var t=e.file,n=e.type,r=e.torrentMode,a=e.torrent,c=n.element,u="".concat(c,'[data-torrent="').concat(a.magnetURI,'"]'),i=document.querySelectorAll(u);console.log("Torrent Elements:",i),i.forEach((function(e){if(!e.classList.contains("hidden")){var c=decodeURIComponent(a.magnetURI.replace(/.*(ws=)/gi,"")),u=n.formats.filter((function(e){return c.toLowerCase().endsWith(".".concat(e.toLowerCase()))})),i=Object(o.a)(u,1)[0];!r&&i?e.setAttribute("src",c):t.renderTo(e,n.options)}}))},k=function(e){var t=e.thumbnailFileNames,n=e.getCacheFileName,r=e.torrentMode;return function(){var e=Object(c.a)(a.a.mark((function e(c){var u,o,i,s,l,p,m,v,h,g,x,k,j;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=c.fileName,i=c.thumbnails,s=c.item,l=c.fileType,p=o.split(".").slice(0,-1).join("."),m="".concat(p,"-thumb"),v=t.indexOf(m),h=i[v],g=h?b(h):null,x="".concat(null!==(u=null===g||void 0===g?void 0:g.element)&&void 0!==u?u:"img",'[data-torrent="').concat(s.magnetURI,'"]'),"video"!==l.element||!h){e.next=17;break}return e.next=10,f(n(h));case 10:if(j=e.sent,null===(k=document.querySelector(x))||void 0===k||k.classList.remove("hidden"),!j){e.next=15;break}return d(j,x),e.abrupt("return");case 15:return y({file:h,type:g,torrentMode:r,torrent:s}),e.abrupt("return");case 17:if("video"!==l.element||h){e.next=20;break}return w({thumbnailFile:h,fileType:l,item:s}),e.abrupt("return");case 20:return e.abrupt("return",{thumbnailFile:h});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},j=function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,r,u,s=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:[],n=!(s.length>1&&void 0!==s[1])||s[1],e.next=4,Promise.all(t.map(function(){var e=Object(c.a)(a.a.mark((function e(t){var r,u,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contentItems,u=t.id,i=Object.entries(r).filter((function(e){var t=Object(o.a)(e,2)[1];return v[t.type]}))){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,g();case 6:return s=e.sent,e.abrupt("return",i.map((function(e){var t=Object(o.a)(e,2),r=t[0],i=t[1];return function(){return new Promise((function(e){var t=x({id:u,key:r});s.get(i.magnetURI)?e(!0):s.add(i.magnetURI,function(){var r=Object(c.a)(a.a.mark((function r(u){var o,l,m,h;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e(!0),o=u.files.filter((function(e){var t,n,r=null===(t=e.name)||void 0===t||null===(n=t.split("."))||void 0===n?void 0:n.slice(-1)[0],a=Object.values(v).filter((function(e){return e.formats.includes(r)}))[0];return!!a&&a.formats.includes(r)})),l=o.filter((function(e){return e.name.match(/-thumb\.([\w\d]){2,4}$/gi)})),m=l.map((function(e){return e.name.replace(/\.([\w\d]){2,4}$/gi,"")})),h=k({getCacheFileName:t,thumbnailFileNames:m,torrentMode:n}),o.map(function(){var e=Object(c.a)(a.a.mark((function e(r){var c,u,o,p,v,g;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m.includes(r.name)){e.next=2;break}return e.abrupt("return");case 2:if(c=b(r)){e.next=5;break}return e.abrupt("return");case 5:return u=t(r),o=c.element,p="".concat(o,'[data-torrent="').concat(i.magnetURI,'"]'),e.next=10,f(u);case 10:if(v=e.sent,h({fileName:r.name,thumbnails:l,fileType:c,item:i}),!v){e.next=17;break}return(g=s.get(i.magnetURI))&&g.destroy(),d(v,p),e.abrupt("return");case 17:y({file:r,type:c,torrentMode:n,torrent:i});case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.on("done",(function(){o.map((function(e){var n=b(e),r=t(e),u=n.element,o="".concat(u,'.torrent-video[data-torrent="').concat(i.magnetURI,'"]');e.getBlob(function(){var e=Object(c.a)(a.a.mark((function e(t,n){var c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return console.warn(t),e.abrupt("return");case 3:return console.log("Caching loaded file...",r,n),e.next=6,p(r,n);case 6:if("false"!==(null===(c=document.querySelector(o))||void 0===c?void 0:c.dataset.played)||(null===c||void 0===c?void 0:c.getAttribute("src"))){e.next=12;break}return e.next=10,f(r);case 10:u=e.sent,d(u,o);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}))}));case 7:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}))}})));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:r=e.sent,u=r.reduce((function(e,t){return[].concat(Object(i.a)(e),Object(i.a)(t))}),[]),m(u);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(c.a)(a.a.mark((function e(t){var n,r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.magnetURI,e.next=3,g();case 3:if(r=e.sent,!(c=r.get(n))){e.next=8;break}return c.destroy(),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=43.d659e439.chunk.js.map