{"version":3,"sources":["common/Post/components/Video/index.js","images/share.svg","common/Post/index.tsx","common/Post/SharedPost.tsx"],"names":["Video","id","item","index","postId","tipValue","tipCounter","hideRibbon","width","contentURL","useMemo","url","magnetURI","replace","isURLCompatible","decodeURIComponent","videoStyle","className","style","cursor","data-torrent","data-file-key","controls","data-played","src","TipRibbon","zoomed","Post","publicKey","openTipModal","openUnlockModal","openDeleteModal","undefined","openShareModal","_","dispatch","Store","unlockedContent","content","useEmblaCarousel","slidesToScroll","align","carouselRef","carouselAPI","author","post","React","tips","Object","values","length","sum","useState","sliderLength","setSliderLength","activeSlide","setActiveSlide","isPrivate","setIsPrivate","isOnlineNode","useEffect","subPostContent","subPostTips","liveStatus","stream","contentItems","find","type","viewersCounter","getMediaContent","useCallback","entries","filter","forEach","k","e","path","parseContent","key","text","finalMagnetURI","cached","Image","Common","playbackMagnet","Stream","nextSlide","canScrollNext","scrollNext","prevSlide","canScrollPrev","scrollPrev","handleUserKeyDown","updateActiveSlide","selectedScrollSnap","on","scrollSnapList","window","addEventListener","removeEventListener","off","tipPost","targetType","postID","unlockPost","deletePost","shared","sharePost","Tooltip","rebuild","console","log","ShockAvatar","height","Pad","amt","insideRow","to","displayName","live","waiting","wasLive","DateTime","fromMillis","date","toRelative","onClick","getTextContent","map","Array","from","classNames","scrollTo","ref","data-tip","alt","ShareIcon","color","marginLeft","SharedPost","sharerPublicKey","Utils","sharerProfile","sharedPost","originalPost","originalAuthor","loadPostMedia","a","attachMedia","subscribeUserProfile","subSinglePost","useLayoutEffect","shareDate"],"mappings":"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","file":"static/js/5.7c731519.chunk.js","sourcesContent":["import { useMemo } from \"react\";\nimport { isURLCompatible } from \"../../../../utils/Torrents\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"./css/index.scoped.css\";\n\nconst Video = ({\n  id = \"\",\n  item,\n  index = 0,\n  postId = \"\",\n  tipValue = 0,\n  tipCounter = 0,\n  hideRibbon = false,\n  width = null\n}) => {\n  const contentURL = useMemo(() => {\n    const url = item.magnetURI.replace(/.*(ws=)/gi, \"\");\n\n    if (isURLCompatible({ url })) {\n      return decodeURIComponent(url);\n    }\n\n    return null;\n  }, [item.magnetURI]);\n  const videoStyle = {};\n  if (width) {\n    videoStyle.width = width;\n  }\n  return (\n    <div className=\"media-container\">\n      <div\n        className=\"video-container\"\n        style={{\n          cursor: \"pointer\"\n        }}\n      >\n        <video\n          style={videoStyle}\n          className={`torrent-video torrent-video-${postId}-${id}`}\n          data-torrent={item.magnetURI}\n          data-file-key={index}\n          controls\n          data-played=\"false\"\n          src={contentURL}\n        />\n        {!hideRibbon && (\n          <TipRibbon\n            tipCounter={tipCounter}\n            tipValue={tipValue}\n            zoomed={false}\n          />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Video;\n","export default __webpack_public_path__ + \"static/media/share.8ed36b2d.svg\";","import React, { useEffect, useState, useCallback } from \"react\";\nimport * as Common from \"shock-common\";\nimport { Link } from \"react-router-dom\";\nimport { useEmblaCarousel } from \"embla-carousel/react\";\nimport Tooltip from \"react-tooltip\";\nimport classNames from \"classnames\";\nimport sum from \"lodash/sum\";\nimport { DateTime } from \"luxon\";\n\nimport * as Store from \"../../store\";\nimport ShockAvatar from \"../ShockAvatar\";\nimport Pad from \"../Pad\";\nimport { subPostContent, subPostTips } from \"../../actions/FeedActions\";\n\nimport Video from \"./components/Video\";\nimport Image from \"./components/Image\";\nimport Stream from \"./components/Stream\";\nimport \"./css/index.scoped.css\";\n\nimport ShareIcon from \"../../images/share.svg\";\n\nconst Post = ({\n  id,\n  publicKey,\n  openTipModal,\n  openUnlockModal,\n  openDeleteModal = undefined,\n  openShareModal = _ => {}\n}) => {\n  const dispatch = Store.useDispatch();\n  const unlockedContent = Store.useSelector(\n    ({ content }) => content.unlockedContent\n  );\n  const [carouselRef, carouselAPI] = useEmblaCarousel({\n    slidesToScroll: 1,\n    align: \"center\"\n  });\n  const author = Store.useSelector(Store.selectUser(publicKey));\n  const post = Store.useSelector(Store.selectSinglePost(publicKey, id));\n  const [tipCounter, tipValue] = React.useMemo(() => {\n    const tips = Object.values(\n      post.tips ||\n        {} /* cached data from previous app version won't have the tips object */\n    );\n\n    return [tips.length, sum(tips)];\n  }, [post]);\n\n  const [sliderLength, setSliderLength] = useState(0);\n  const [activeSlide, setActiveSlide] = useState(0);\n  const [isPrivate, setIsPrivate] = useState(false);\n\n  const isOnlineNode = /*Utils.isOnline(\n    Store.useSelector(Store.selectUser(publicKey)).lastSeenApp\n  );*/ true;\n\n  useEffect(() => dispatch(subPostContent(publicKey, id)), [\n    dispatch,\n    id,\n    publicKey\n  ]);\n\n  useEffect(() => dispatch(subPostTips(publicKey, id)), [\n    dispatch,\n    id,\n    publicKey\n  ]);\n\n  const liveStatus = React.useMemo<Common.LiveStatus | null>(() => {\n    const stream = Object.values(post.contentItems ?? {}).find(\n      item => item.type === \"stream/embedded\"\n    ) as Common.EmbeddedStream;\n\n    if (stream) {\n      return stream.liveStatus;\n    }\n\n    return null;\n  }, [post.contentItems]);\n\n  const viewersCounter = React.useMemo<number | null>(() => {\n    const stream = Object.values(post.contentItems ?? {}).find(\n      item => item.type === \"stream/embedded\"\n    ) as Common.EmbeddedStream;\n\n    if (stream && stream.liveStatus === \"live\") {\n      return stream.viewersCounter;\n    }\n\n    return null;\n  }, [post.contentItems]);\n\n  const getMediaContent = useCallback(() => {\n    return Object.entries(post.contentItems ?? {}).filter(\n      ([_, item]) => item.type !== \"text/paragraph\"\n    );\n  }, [post.contentItems]);\n\n  const getTextContent = () => {\n    return Object.entries(post.contentItems ?? {}).filter(\n      ([_, item]) => item.type === \"text/paragraph\"\n    );\n  };\n\n  useEffect(() => {\n    getMediaContent().forEach(([k, e]) => {\n      const path = `${publicKey}>posts>${k}`;\n      // @ts-expect-error\n      if (e.isPrivate && !unlockedContent[path]) {\n        setIsPrivate(true);\n      }\n    });\n  }, [getMediaContent, publicKey, unlockedContent]);\n\n  const parseContent = ([key, item]: [string, Common.ContentItem], index) => {\n    if (item.type === \"text/paragraph\") {\n      return <p key={key}>{item.text}</p>;\n    }\n\n    let finalMagnetURI = \"\";\n    if (item.isPrivate) {\n      const path = `${publicKey}>posts>${id}`;\n      const cached = unlockedContent[path];\n      if (cached) {\n        finalMagnetURI = cached;\n      } else {\n        return (\n          <div key={key}>\n            <i className=\"fas fa-lock fa-10x\"></i>\n          </div>\n        );\n      }\n    }\n\n    if (item.type === \"image/embedded\") {\n      return (\n        <Image\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n          hideRibbon={undefined}\n          width={undefined}\n        />\n      );\n    }\n\n    if (item.type === \"video/embedded\") {\n      return (\n        <Video\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n          hideRibbon={undefined}\n          width={undefined}\n        />\n      );\n    }\n    if (Common.isEmbeddedStream(item)) {\n      if (item.playbackMagnet) {\n        return (\n          <Video\n            id={key}\n            item={{\n              ...item,\n              magnetURI: item.playbackMagnet\n            }}\n            index={index}\n            postId={id}\n            tipCounter={tipCounter}\n            tipValue={tipValue}\n            key={`${id}-${index}`}\n            hideRibbon={undefined}\n            width={undefined}\n          />\n        );\n      }\n      return (\n        <Stream\n          id={key}\n          item={{\n            ...item,\n            magnetURI: finalMagnetURI || item.magnetURI\n          }}\n          index={index}\n          postId={id}\n          tipCounter={tipCounter}\n          tipValue={tipValue}\n          key={`${id}-${index}`}\n          hideRibbon={undefined}\n          width={undefined}\n        />\n      );\n    }\n\n    return null;\n  };\n\n  const nextSlide = useCallback(() => {\n    if (!carouselAPI) return;\n\n    if (carouselAPI.canScrollNext()) {\n      carouselAPI.scrollNext();\n    }\n  }, [carouselAPI]);\n\n  const prevSlide = useCallback(() => {\n    if (!carouselAPI) return;\n\n    if (carouselAPI.canScrollPrev()) {\n      carouselAPI.scrollPrev();\n    }\n  }, [carouselAPI]);\n\n  const handleUserKeyDown = useCallback(\n    e => {\n      if (sliderLength === 0) return;\n      const { key } = e;\n\n      if (key === \"ArrowRight\") {\n        nextSlide();\n      }\n\n      if (key === \"ArrowLeft\") {\n        prevSlide();\n      }\n    },\n    [sliderLength, prevSlide, nextSlide]\n  );\n\n  const updateActiveSlide = useCallback(() => {\n    setActiveSlide(carouselAPI.selectedScrollSnap());\n  }, [carouselAPI, setActiveSlide]);\n\n  useEffect(() => {\n    if (!carouselAPI) return;\n\n    carouselAPI.on(\"scroll\", updateActiveSlide);\n    setSliderLength(carouselAPI.scrollSnapList().length);\n    window.addEventListener(\"keydown\", handleUserKeyDown);\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleUserKeyDown);\n      carouselAPI.off(\"scroll\", updateActiveSlide);\n    };\n  }, [carouselAPI, sliderLength, handleUserKeyDown, updateActiveSlide]);\n\n  const tipPost = useCallback(() => {\n    if (!isOnlineNode) {\n      return;\n    }\n\n    openTipModal({\n      targetType: \"post\",\n      postID: id,\n      publicKey\n    });\n  }, [id, isOnlineNode, openTipModal, publicKey]);\n\n  const unlockPost = useCallback(() => {\n    if (!isOnlineNode) {\n      return;\n    }\n\n    openUnlockModal({\n      targetType: \"unlock\",\n      postID: id,\n      publicKey\n    });\n  }, [id, isOnlineNode, openUnlockModal, publicKey]);\n\n  const deletePost = useCallback(() => {\n    openDeleteModal({ id, shared: false });\n  }, [id, openDeleteModal]);\n\n  const sharePost = useCallback(() => {\n    openShareModal({\n      targetType: \"share\",\n      postID: id,\n      publicKey\n    });\n  }, [publicKey, id, openShareModal]);\n\n  useEffect(() => {\n    try {\n      Tooltip.rebuild();\n    } catch (e) {\n      console.log(`Error inside <Post />: `, e);\n    }\n  }, []);\n\n  const readableLiveStatus: Record<Common.LiveStatus, string> = {\n    live: \"Is Live\",\n    waiting: \"Waiting\",\n    wasLive: \"Was Live\"\n  };\n\n  return (\n    <div className=\"post\">\n      <div className=\"head\">\n        <div className=\"user\">\n          <ShockAvatar height={50} publicKey={publicKey} />\n\n          <Pad amt={10} insideRow />\n\n          <div className=\"details\">\n            <div className=\"username\">\n              <Link to={`/otherUser/${publicKey}`}>{author.displayName}</Link>\n              {liveStatus && (\n                <p className=\"liveStatus\">\n                  {readableLiveStatus[liveStatus]}\n                  <i\n                    className={`fas fa-circle liveStatusIcon ${\n                      liveStatus === \"live\" ? \"liveIcon\" : \"\"\n                    }`}\n                  ></i>\n                  {liveStatus === \"live\" && (\n                    <span> | {viewersCounter} watching</span>\n                  )}\n                </p>\n              )}\n            </div>\n            <p>{DateTime.fromMillis(post.date).toRelative()}</p>\n          </div>\n        </div>\n        {openDeleteModal && (\n          <i className=\"fas fa-trash trash-icon\" onClick={deletePost}></i>\n        )}\n      </div>\n\n      <div className=\"content\">\n        {getTextContent().map(parseContent)}\n        <div className=\"media-content-carousel\">\n          {sliderLength > 1 ? (\n            <div className=\"media-carousel-controls-container\">\n              <div\n                className=\"media-carousel-arrow fas fa-angle-left\"\n                onClick={prevSlide}\n              ></div>\n              <div className=\"media-carousel-pages\">\n                {Array.from({ length: sliderLength }).map((_, key) => (\n                  <div\n                    // TODO: Get the actual ID here. However posts can't be\n                    // edited so index is stable.\n                    key={key}\n                    className={classNames({\n                      \"media-carousel-page\": true,\n                      \"active-carousel-page\": activeSlide === key\n                    })}\n                    onClick={() => carouselAPI?.scrollTo(key)}\n                  ></div>\n                ))}\n              </div>\n              <div\n                className=\"media-carousel-arrow fas fa-angle-right\"\n                onClick={nextSlide}\n              ></div>\n            </div>\n          ) : null}\n          <div className=\"media-content-root\" ref={carouselRef}>\n            <div className=\"media-content-container\">\n              {getMediaContent().map(parseContent)}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"actions\">\n        <div></div>\n        <div\n          className=\"icon-tip-btn\"\n          data-tip={isPrivate ? \"Unlock this post\" : \"Tip this post\"}\n          onClick={isPrivate ? unlockPost : tipPost}\n        >\n          <div className=\"tip-icon icon-thin-feed\"></div>\n        </div>\n        {openShareModal && (\n          <div className=\"icon-tip-btn\" data-tip={\"share\"} onClick={sharePost}>\n            <img\n              alt=\"Share this post\"\n              src={ShareIcon}\n              style={{ color: \"#4285b9\", marginLeft: \"auto\" }}\n            />\n          </div>\n        )}\n        {!openShareModal && <div></div>}\n      </div>\n    </div>\n  );\n};\n\nexport default Post;\n","import React, { useCallback, useLayoutEffect } from \"react\";\nimport { DateTime } from \"luxon\";\nimport Tooltip from \"react-tooltip\";\n\nimport Post from \".\";\n\nimport * as Store from \"../../store\";\nimport * as Utils from \"../../utils\";\nimport Loader from \"../Loader\";\nimport ShockAvatar from \"../ShockAvatar\";\nimport Pad from \"../Pad\";\nimport { attachMedia } from \"../../utils/Torrents\";\nimport { subPostContent, subSinglePost } from \"../../actions/FeedActions\";\nimport { subscribeUserProfile } from \"../../actions/UserProfilesActions\";\nimport \"../Post/css/index.scoped.css\";\n\nexport interface SharedPostProps {\n  postID: string;\n  sharerPublicKey: string;\n  openTipModal?(tipData: any): void;\n  openUnlockModal?(unlockData: any): void;\n  openDeleteModal?(params: { id: string; shared: boolean }): void;\n  openShareModal?(shareData: any): void;\n}\n\nconst SharedPost = ({\n  postID,\n  sharerPublicKey,\n  openTipModal,\n  openUnlockModal,\n  openDeleteModal = Utils.EMPTY_FN,\n  openShareModal = Utils.EMPTY_FN\n}: SharedPostProps) => {\n  const dispatch = Store.useDispatch();\n\n  const sharerProfile = Store.useSelector(Store.selectUser(sharerPublicKey));\n  const sharedPost = Store.useSelector(\n    Store.selectSharedPost(sharerPublicKey, postID)\n  );\n  const originalPost = Store.useSelector(\n    Store.selectSinglePost(sharedPost.originalAuthor, postID)\n  );\n\n  const loadPostMedia = useCallback(async () => {\n    if (originalPost) {\n      attachMedia([originalPost], false);\n    }\n  }, [originalPost]);\n  const deletePost = useCallback(() => {\n    openDeleteModal({ id: originalPost.id, shared: true });\n  }, [originalPost, openDeleteModal]);\n\n  React.useEffect(\n    () => dispatch(subscribeUserProfile(sharedPost.originalAuthor)),\n    [dispatch, sharedPost.originalAuthor]\n  );\n\n  React.useEffect(() => dispatch(subscribeUserProfile(sharerPublicKey)), [\n    dispatch,\n    sharerPublicKey\n  ]);\n\n  React.useEffect(\n    () => dispatch(subSinglePost(sharedPost.originalAuthor, postID)),\n    [dispatch, postID, sharedPost.originalAuthor]\n  );\n\n  React.useEffect(\n    () => dispatch(subPostContent(sharedPost.originalAuthor, postID)),\n    [dispatch, postID, sharedPost.originalAuthor]\n  );\n\n  useLayoutEffect(() => {\n    Tooltip.rebuild();\n    loadPostMedia();\n  }, [loadPostMedia]);\n\n  return (\n    <div className=\"post shared-post\">\n      <div className=\"head\">\n        <div className=\"user\">\n          <ShockAvatar height={50} publicKey={sharerPublicKey} />\n\n          <Pad amt={10} insideRow />\n\n          <div className=\"details\">\n            <p>{sharerProfile?.displayName}</p>\n            <p>\n              {/* @ts-ignore */}\n              Shared {DateTime.fromMillis(sharedPost.shareDate).toRelative()}\n            </p>\n          </div>\n        </div>\n        {openDeleteModal && (\n          <i className=\"fas fa-trash\" onClick={deletePost}></i>\n        )}\n      </div>\n\n      <div className=\"shared-content\">\n        {originalPost ? (\n          <Post\n            id={originalPost.id}\n            publicKey={sharedPost.originalAuthor}\n            openTipModal={openTipModal}\n            openUnlockModal={openUnlockModal}\n            openShareModal={openShareModal}\n          />\n        ) : (\n          <Loader text=\"Loading Post...\" />\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SharedPost;\n"],"sourceRoot":""}