{"version":3,"sources":["common/Post/components/TipRibbon/index.js","common/DialogNav/index.js","utils/Cache.js","utils/Promise.js","utils/Torrents.js","common/Post/components/ImagePreview/index.js","common/Post/components/VideoPreview/index.js","pages/Profile/createPost.tsx"],"names":["TipRibbon","tipCounter","tipValue","zoomed","className","style","opacity","DIALOG_NAV_MIN_HEIGHT_PX","CONTAINER_STYLE","minHeight","DialogNav","pageTitle","drawerVisible","onHeight","Utils","goBack","useCallback","window","history","back","divRefCb","el","getBoundingClientRect","height","e","console","log","ref","onClick","classNames","getCachedFile","fileName","a","FileCache","_init","Promise","resolve","reject","init","then","persist","status","persistent","load","cachedFile","createURL","warn","renderCachedFile","fileURL","selector","elements","document","querySelectorAll","length","forEach","element","src","muted","autoplay","saveFile","buffer","save","runSerial","tasks","result","task","supportedFileTypes","formats","options","_getFileType","file","extension","name","split","slice","supportedFileType","Object","entries","filter","includes","fileType","webTorrentClient","WebTorrent","attachMedia","posts","torrentMode","allowDuplicates","torrentTasks","map","post","contentItems","id","item","type","key","get","magnetURI","add","torrent","files","target","destroy","torrentElement","contentURL","decodeURIComponent","replace","format","toLowerCase","endsWith","compatibleURL","elementSrc","getAttribute","setAttribute","renderTo","on","getBlob","err","blob","querySelector","dataset","played","reduce","torrents","ImagePreview","index","postId","width","selected","updateSelection","mainImageStyle","selectThis","position","alt","data-torrent","data-file-key","top","backgroundColor","display","alignItems","justifyContent","class","VideoPreview","videoStyle","cursor","controls","data-played","PublishContentPage","useDispatch","useHistory","publishedContent","useSelector","content","avatar","node","useState","loading","setLoading","error","setError","paragraph","setParagraph","postType","setPostType","isPreview","selectedContent","setSelectedContent","onSubmit","useMemo","preventDefault","push","text","isPrivate","Http","tags","title","errorMessage","message","onDiscard","onInputChange","value","Loader","overlay","fullScreen","onReset","marginBottom","backgroundImage","onChange","placeholder","rows","marginLeft","appearance","color","overflow","whiteSpace","margin"],"mappings":"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","file":"static/js/14.59967ec9.chunk.js","sourcesContent":["import React from \"react\";\nimport \"./css/index.css\";\n\nconst TipRibbon = ({ tipCounter, tipValue, zoomed }) =>\n  tipValue > 0 ? (\n    <div className=\"ribbon-container\" style={{ opacity: !zoomed ? 1 : 0 }}>\n      <p className=\"ribbon-title\">Total Tips</p>\n      <p className=\"ribbon-value\">\n        {tipCounter} {tipCounter === 1 ? \"Tip\" : \"Tips\"}\n      </p>\n    </div>\n  ) : null;\n\nexport default TipRibbon;\n","// @ts-check\nimport { useCallback } from \"react\";\nimport classNames from \"classnames\";\n/**\n * @typedef {import('react').RefCallback<HTMLElement>} DivRefCallback\n */\n\nimport * as Utils from \"../../utils\";\n\nimport \"./css/index.css\";\n\nexport const DIALOG_NAV_MIN_HEIGHT_PX = 73;\n/** @type {import('react').CSSProperties} */\nconst CONTAINER_STYLE = {\n  minHeight: DIALOG_NAV_MIN_HEIGHT_PX\n};\n\nconst DialogNav = ({\n  pageTitle,\n  drawerVisible = false,\n  onHeight = Utils.EMPTY_FN\n}) => {\n  const goBack = useCallback(() => {\n    window.history.back();\n  }, []);\n\n  /** @type {DivRefCallback} */\n  const divRefCb = useCallback(\n    el => {\n      // https://www.pluralsight.com/tech-blog/getting-size-and-position-of-an-element-in-react/\n      if (!el) return;\n      try {\n        onHeight(el.getBoundingClientRect().height);\n      } catch (e) {\n        console.log(`Error inside onHeight mechanism in DialogNav:`);\n        console.log(e);\n      }\n    },\n    [onHeight]\n  );\n\n  return (\n    <div\n      className=\"dialog-nav-container\"\n      ref={divRefCb}\n      style={CONTAINER_STYLE}\n    >\n      <div className=\"dialog-nav-back\" onClick={goBack}>\n        <i className=\"icon icon-thin-back\"></i>\n      </div>\n      <p className=\"dialog-nav-title\">{pageTitle}</p>\n      <div\n        className={classNames({\n          \"dialog-nav-menu-btn\": true,\n          \"dialog-nav-hidden\": !drawerVisible\n        })}\n      >\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n        <div className=\"dialog-nav-menu-dash\" />\n      </div>\n    </div>\n  );\n};\n\nexport default DialogNav;\n","import FileCache from \"browser-file-storage\";\n\nexport const DB_NAME = \"ShockWalletStore\";\n\nexport const init = () =>\n  new Promise((resolve, reject) => {\n    FileCache.init(DB_NAME)\n      .then(() => {\n        console.log(\"File cache initialized!\");\n        return FileCache.persist();\n      })\n      .then(status => {\n        if (status.persistent) {\n          resolve(status);\n        } else {\n          reject(status);\n        }\n      });\n  });\n\nexport const getCachedFile = async fileName => {\n  try {\n    if (!FileCache._init) {\n      await init();\n    }\n\n    const cachedFile = await FileCache.load(fileName);\n    return cachedFile.createURL();\n  } catch (err) {\n    console.warn(err);\n    return false;\n  }\n};\n\nexport const renderCachedFile = (fileURL, selector) => {\n  const elements = document.querySelectorAll(selector);\n  if (elements && elements.length) {\n    elements.forEach(element => {\n      if (!element.src) {\n        element.src = fileURL;\n        element.muted = true;\n        element.autoplay = true;\n      }\n    });\n  }\n  return !!elements?.length;\n};\n\nexport const saveFile = (fileName, buffer) => {\n  return FileCache.save(fileName, buffer);\n};\n","export const runSerial = tasks => {\n  let result = Promise.resolve();\n  tasks.forEach(task => {\n    result = result.then(() => task());\n  });\n  return result;\n};\n","import WebTorrent from \"webtorrent\";\nimport { getCachedFile, renderCachedFile, saveFile } from \"./Cache\";\nimport { runSerial } from \"./Promise\";\n\nconst supportedFileTypes = {\n  \"video/embedded\": {\n    formats: [\"mp4\", \"webm\"],\n    element: \"video\",\n    options: {\n      autoplay: true,\n      muted: true\n    }\n  },\n  \"image/embedded\": {\n    formats: [\"jpg\", \"png\", \"webp\", \"jpeg\"],\n    element: \"img\",\n    options: {}\n  }\n};\n\nconst _getFileType = file => {\n  const extension = file.name?.split(\".\")?.slice(-1)[0];\n  const supportedFileType = Object.entries(\n    supportedFileTypes\n  ).filter(([type, options]) => options.formats.includes(extension))[0];\n\n  if (supportedFileType) {\n    const [name, fileType] = supportedFileType;\n    return {\n      name,\n      ...fileType\n    };\n  }\n\n  return null;\n};\n\nexport const webTorrentClient = new WebTorrent();\n\nexport const attachMedia = (\n  posts = [],\n  torrentMode = true,\n  allowDuplicates = false\n) => {\n  const torrentTasks = posts\n    .map(post => {\n      const { contentItems, id } = post;\n      return Object.entries(contentItems)\n        .filter(([key, item]) => supportedFileTypes[item.type])\n        .map(([key, item]) => () =>\n          new Promise(resolve => {\n            const torrentExists = webTorrentClient.get(item.magnetURI);\n\n            if (torrentExists && !allowDuplicates) {\n              resolve(true);\n              return;\n            }\n\n            webTorrentClient.add(item.magnetURI, async torrent => {\n              // Proceed to the next torrent in queue\n              resolve(true);\n\n              const files = torrent.files.filter(file => {\n                const extension = file.name?.split(\".\")?.slice(-1)[0];\n                const supportedFileType = Object.entries(\n                  supportedFileTypes\n                ).filter(([type, options]) =>\n                  options.formats.includes(extension)\n                )[0];\n                if (supportedFileType) {\n                  const [, fileType] = supportedFileType;\n                  const matched = fileType.formats.includes(extension);\n                  return matched;\n                }\n                return false;\n              });\n\n              files.map(async file => {\n                const fileType = _getFileType(file);\n\n                if (!fileType) {\n                  return;\n                }\n\n                const fileName = `${id}-${key}-${file.name}`;\n\n                const element = fileType.element;\n                const target = `${element}[data-torrent=\"${item.magnetURI}\"]`;\n                const cachedFile = await getCachedFile(fileName);\n\n                if (cachedFile) {\n                  const torrent = webTorrentClient.get(item.magnetURI);\n\n                  if (torrent) {\n                    torrent.destroy();\n                  }\n\n                  renderCachedFile(cachedFile, target);\n                  return;\n                }\n\n                const torrentElements = document.querySelectorAll(target);\n                torrentElements.forEach(torrentElement => {\n                  const contentURL = decodeURIComponent(\n                    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n                  );\n                  const [compatibleURL] = fileType.formats.filter(format =>\n                    contentURL\n                      .toLowerCase()\n                      .endsWith(`.${format.toLowerCase()}`)\n                  );\n                  const elementSrc = torrentElement.getAttribute(\"src\");\n\n                  if ((torrentMode || !compatibleURL) && !elementSrc) {\n                    file.renderTo(torrentElement, fileType.options);\n                    return;\n                  }\n\n                  torrentElement.setAttribute(\"src\", contentURL);\n                });\n              });\n\n              torrent.on(\"done\", () => {\n                files.map(file => {\n                  const fileType = _getFileType(file);\n                  const fileName = `${id}-${key}-${file.name}`;\n                  const element = fileType.element;\n                  const target = `${element}[data-torrent=\"${item.magnetURI}\"]`;\n\n                  file.getBlob(async (err, blob) => {\n                    if (err) {\n                      console.warn(err);\n                      return;\n                    }\n\n                    await saveFile(fileName, blob);\n                    const element = document.querySelector(target);\n                    if (element?.dataset.played === \"false\" && !element?.getAttribute(\"src\")) {\n                      const cachedFile = await getCachedFile(fileName);\n                      renderCachedFile(cachedFile, target);\n                    }\n                  });\n\n                  return file;\n                });\n              });\n            });\n          })\n        );\n    })\n    .reduce((torrents, contentItems) => [...torrents, ...contentItems], []);\n\n  runSerial(torrentTasks);\n};\n","import React, { useState, useCallback } from \"react\";\nimport { Controlled as ControlledZoom } from \"react-medium-image-zoom\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"react-medium-image-zoom/dist/styles.css\";\nimport \"./css/index.css\";\n\nconst IMAGE_TRANSITION_MS = 200;\n\nconst ImagePreview = ({ id, item, index, postId,width,selected,updateSelection }) => {\n\n  const contentURL = decodeURIComponent(\n    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n  );\n  const mainImageStyle = {opacity:1}\n  if(width){\n    mainImageStyle.width = width\n  }\n  const selectThis = useCallback(()=> {\n    if(selected !==id){\n      updateSelection(id)\n    } \n  },[id,updateSelection])\n\n  return (\n    <div className=\"media-container\" onClick={selectThis} style={{position:'relative'}}>\n      <img\n          className={`torrent-img torrent-img-${postId}-${id}`}\n          alt=\"Post Media\"\n          data-torrent={item.magnetURI}\n          data-file-key={index}\n          style={mainImageStyle}\n          src={contentURL}\n        />\n      {selected === id && <div\n          style={{...mainImageStyle,opacity:1,position:'absolute',top:0,backgroundColor:'rgb(255,255,255,0.2)',height:'100%',display:'flex',alignItems:'center',justifyContent:'center'}}\n        >\n        <i class=\"far fa-check-circle fa-3x\" style={{opacity:1}}></i>\n      </div>}\n    </div>\n  );\n};\n\nexport default ImagePreview;\n","import React,{useCallback} from \"react\";\nimport TipRibbon from \"../TipRibbon\";\nimport \"./css/index.css\";\n\nconst VideoPreview = ({ id, item, index, postId,width,selected,updateSelection }) => {\n  const contentURL = decodeURIComponent(\n    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n  );\n  const videoStyle = { }\n  if(width){\n    videoStyle.width = width\n  }\n  const selectThis = useCallback(()=> {\n    if(selected !==id){\n      updateSelection(id)\n    } \n  },[id,updateSelection])\n  return (\n    <div className=\"media-container\" style={{position:'relative'}}>\n      <div\n        className=\"video-container\"\n        style={{\n          cursor: \"pointer\",\n          \n        }}\n        \n      >\n        <video\n          style={videoStyle}\n          className={`torrent-video torrent-video-${postId}-${id}`}\n          data-torrent={item.magnetURI}\n          data-file-key={index}\n          controls\n          data-played=\"false\"\n          src={contentURL}\n        />\n      </div>\n      <div onClick={selectThis}\n          style={{...videoStyle,opacity:selected === id ? 1:0,position:'absolute',top:0,backgroundColor:'rgb(255,255,255,0.2)',height:'100%',display:'flex',alignItems:'center',justifyContent:'center'}}\n        >\n        <i class=\"far fa-check-circle fa-3x\" style={{opacity:1}}></i>\n      </div>\n    </div>\n  );\n};\n\nexport default VideoPreview;\n","import React, { useCallback, useMemo, useState } from \"react\";\nimport { useSelector,useDispatch } from \"react-redux\";\nimport \"./css/index.css\";\n\nimport Loader from \"../../common/Loader\";\nimport DialogNav from \"../../common/DialogNav\";\nimport Http from \"../../utils/Http\";\nimport Video from \"../../common/Post/components/Video\";\nimport Image from \"../../common/Post/components/Image\";\nimport { attachMedia } from \"../../utils/Torrents\";\nimport ImagePreview from \"../../common/Post/components/ImagePreview\";\nimport VideoPreview from \"../../common/Post/components/VideoPreview\";\nimport { useHistory } from \"react-router\";\nconst PublishContentPage = () => {\n  const dispatch = useDispatch();\n  const history = useHistory()\n  //@ts-expect-error\n  const publishedContent = useSelector(({content}) => content.publishedContent)\n  //@ts-expect-error\n  const avatar = useSelector(({ node }) => node.avatar);\n  const [loading, setLoading] = useState(false);\n  const [error,setError] = useState(null)\n  const [paragraph,setParagraph] = useState('')\n  const [postType,setPostType] = useState(\"public\")\n  const [isPreview,setIsPreview] = useState(false)\n  const [selectedContent,setSelectedContent] = useState('')\n  const contentToDisplay = useMemo(() => {\n    attachMedia([{id:\"content\",contentItems:publishedContent}])\n  },[publishedContent])\n  const onSubmit = useCallback(\n    async e => {\n      e.preventDefault()\n      \n      console.log(\"submitting\")\n      if(selectedContent === '' && paragraph === ''){\n        setError(\"at least one paragraph or one media is required\")\n        return\n      }\n      setLoading(true)\n      let contentItems = []\n      if(paragraph !== ''){\n        contentItems.push({\n          type: 'text/paragraph',\n          text: paragraph,\n        })\n      }\n      const isPrivate = postType === \"private\"\n      if(selectedContent !== ''){\n        const item = publishedContent[selectedContent]\n        if(item){\n          contentItems.push({\n            type:item.type,\n            width:item.width,\n            height:item.height,\n            magnetURI:item.magnetURI,\n            isPreview:isPreview,\n            isPrivate:isPrivate\n          })\n        }\n      }\n      try{\n        const res = await Http.post(`/api/gun/wall`, {\n          tags: [],\n          title: 'Post',\n          contentItems,\n        })\n        if (res.status === 200) {\n          console.log('post created successfully')\n          setLoading(false)\n          history.push(\"/profile\")\n        } else {\n          setError('invalid response status')\n          setLoading(false)\n        }\n      }catch(err){\n        console.log(err)\n        setError(err?.errorMessage ?? err?.message)\n        setLoading(false)\n      }\n    },\n    [selectedContent,paragraph,publishedContent,isPreview,postType,history,setLoading,setError]\n  );\n  const onDiscard = useCallback(\n    async e => {\n      e.preventDefault();\n      setError(null)\n      setParagraph('')\n    },\n    []\n  );\n  const onInputChange = useCallback(e => {\n    const { value, name } = e.target;\n    switch (name) {\n      case \"paragraph\": {\n        setParagraph(value)\n        return;\n      }\n      case \"postType\":{\n        console.log(value)\n        setPostType(value)\n        return\n      }\n      default:\n        return;\n    }\n  }, [setParagraph]);\n\n  const updateSelection = useCallback(e => {\n    e.preventDefault()\n    setSelectedContent(e.target.getAttribute(\"propid\"))\n  },[selectedContent,setSelectedContent])\n\n  const parseContent = ([key, item], index) => {\n    if (item.type === \"image/embedded\") {\n      return (\n        <div style={{width:100,margin:'1em'}}>\n        <ImagePreview\n          id={key}\n          item={item}\n          index={index}\n          postId={\"content\"}\n          key={`${index}`}\n          width=\"100px\"\n          selected={selectedContent}\n          updateSelection={setSelectedContent}\n        />\n        </div>\n      );\n    }\n\n    if (item.type === \"video/embedded\") {\n      return (\n        <div style={{width:100}}>\n        <VideoPreview\n          id={key}\n          item={item}\n          index={index}\n          postId={\"content\"}\n          key={`${index}`}\n          width=\"100px\"\n          selected={selectedContent}\n          updateSelection={setSelectedContent}\n        />\n        </div>\n      );\n    }\n\n    return null;\n  };\n  console.log(selectedContent)\n  return (<div className=\"publish-content-form-container m-1\">\n    {loading ? (\n      <Loader overlay fullScreen text=\"Creating post...\" />\n    ) : null}\n    <DialogNav  drawerVisible={false}  pageTitle=\"CREATE POST\" />\n    <form className=\"publish-content-form\" onSubmit={onSubmit} onReset={onDiscard}>\n      <div style={{display:'flex',justifyContent:'space-between',marginBottom:\"1rem\"}}>\n        <div\n          className=\"profile-avatar\"\n          style={{ backgroundImage: `url(${avatar})` }}\n        />\n        <div>\n          <h2>Say Something</h2>\n          <div className=\"line\"></div>\n        </div>\n        <div  style={{width:\"122px\"}}></div>\n      </div>\n      <textarea className=\"input-field\" name={'paragraph'} value={paragraph} onChange={onInputChange} placeholder=\"What's up?\" rows={4}>\n      </textarea>\n      <div style={{marginLeft:'auto',display:\"flex\",alignItems:'center'}}>\n        <strong >Audience: <i className={`fas ${postType === 'public' ? \"fa-globe-europe\" : \"fa-credit-card\"}`}></i></strong>\n        <select name=\"postType\" id=\"postType\" onChange={onInputChange} style={{appearance:'none',backgroundColor:\"rgba(0,0,0,0)\",color:'var(--main-blue)', marginLeft:\"0.3rem\"}}>\n          <option value=\"public\" style={{backgroundColor:\"rgba(0,0,0,0)\",color:'var(--main-blue)'}}>Public</option>\n          <option value=\"private\">Paywall</option>\n        </select>\n      </div>\n      <div style={{display:'flex',alignItems:'center', overflow: 'auto',whiteSpace: 'nowrap'}}>\n      {Object.entries(publishedContent).map(parseContent)}\n      </div>\n      {error ? <p className=\"error-container\">{error}</p> : null}\n      <div className='flex-center'>\n      <input type=\"reset\" value=\"reset\" className='shock-form-button m-1'/>\n      <input type=\"submit\" value=\"submit\" className='shock-form-button-confirm m-1' />\n      </div>\n    </form>\n  </div>)\n};\n\nexport default PublishContentPage;\n"],"sourceRoot":""}