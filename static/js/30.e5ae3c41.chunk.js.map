{"version":3,"sources":["common/Pad/index.tsx","pages/Story/css/index.module.css","pages/Story/index.tsx"],"names":["Pad","amt","style","insideRow","width","height","module","exports","Story","publicKey","onParentNext","onNext","onParentPrevious","onPrevious","position","React","useState","currI","setCurrI","pics","setPics","currPic","Store","state","node","displayName","userProfiles","hostIP","subscribeStory","useCallback","a","rifle","host","query","sub","on","pictures","Object","values","filter","p","err","console","log","warn","off","close","useEffect","length","className","classNames","styles","container","alt","src","data","picture","map","pic","i","Fragment","id","info","moment","Common","timestamp","fromNow","onClick"],"mappings":"qHAAA,gBAkBeA,IAXiB,SAAC,GAAwB,IAAtBC,EAAqB,EAArBA,IAC3BC,EAA6B,GAOnC,OARsD,EAAhBC,UAGpCD,EAAME,MAAQH,EAEdC,EAAMG,OAASJ,EAGV,qBAAKC,MAAOA,M,oBCdrBI,EAAOC,QAAU,CAAC,IAAM,OAAO,UAAY,uBAAuB,KAAO,kBAAkB,kBAAkB,6BAA6B,KAAO,kBAAkB,gBAAgB,2CAA2C,KAAO,kBAAkB,YAAY,uCAAuC,aAAa,wCAAwC,QAAU,uB,wLCqJ1VC,UA9HqB,SAAC,GAK/B,EAJJC,UAIK,IAHGC,EAGJ,EAHJC,OACYC,EAER,EAFJC,WACAC,EACI,EADJA,SACI,EACsBC,IAAMC,SAAiB,GAD7C,mBACGC,EADH,KACUC,EADV,OAEoBH,IAAMC,SAAyB,IAFnD,mBAEGG,EAFH,KAESC,EAFT,KAGEC,EAAUF,EAAKF,GAGfR,EAAYa,eAAkB,SAAAC,GAAK,OAAIA,EAAMC,KAAKf,aAChDgB,EAAgBH,eACtB,qBAAGI,aAAgCjB,MAD7BgB,YAGAE,EAAWL,eAAkB,SAAAC,GAAK,OAAIA,EAAMC,QAA5CG,OACFC,EAAiBb,IAAMc,YAAN,sBAAkB,4BAAAC,EAAA,sEACrBC,YAAM,CACtBC,KAAML,EACNM,MAAM,GAAD,OAAKxB,EAAL,mBAHgC,cACjCyB,EADiC,QAMnCC,GAAG,UAAU,SAACC,GACQ,kBAAbA,GAAsC,OAAbA,GAIpChB,EACEiB,OAAOC,OAAOF,GAAUG,QAAO,SAAAC,GAAC,MAAiB,kBAANA,GAAwB,OAANA,SAIjEN,EAAIC,GAAG,SAAS,SAAAM,GACdC,QAAQC,IAAR,2BACAD,QAAQC,IAAIF,MAGdP,EAAIC,GAAG,YAAY,WACjBO,QAAQE,KAAR,iCAtBqC,mBA0BhC,WACLV,EAAIW,IAAI,UACRX,EAAIY,WA5BiC,2CA8BtC,CAACnB,EAAQlB,IAEZM,IAAMgC,WAAU,WACdnB,MACC,CAACA,IAEJb,IAAMgC,WAAU,cAIb,CAAC9B,EAAOH,IAoBX,OAAoB,IAAhBK,EAAK6B,OACA,qBAAKC,UAAWC,IAAW,iBAAkBC,IAAOC,aAI3D,sBAAKH,UAAWC,IAAW,iBAAkBC,IAAOC,WAApD,UACE,qBACEC,IAAG,cAASpC,EAAQ,EAAjB,mBAA6BE,EAAK6B,QACrCM,IAAG,iCAA4BjC,EAAQkC,MACvCN,UAAWE,IAAOK,UAGpB,cAAC,IAAD,CAAKvD,IAAK,KAEV,qBAAKgD,UAAWE,IAAO,mBAAvB,SACGhC,EAAKsC,KAAI,SAACC,EAAKC,GAAN,OACR,eAAC,IAAMC,SAAP,WACE,cAAC,IAAD,CAAK3D,IAAK,GAAIE,WAAS,IAEvB,qBACE8C,UAAWC,IACTC,IAAM,KACNQ,IAAM1C,GAASkC,IAAO,oBAI1B,cAAC,IAAD,CAAKlD,IAAK,GAAIE,WAAS,MAVJuD,EAAIG,SAe7B,cAAC,IAAD,CAAK5D,IAAK,KAEV,sBAAKgD,UAAWE,IAAOW,KAAvB,UACE,+BAAOrC,IAEP,cAAC,IAAD,CAAKxB,IAAK,KAEV,+BACG8D,IAAOC,IAA8B3C,EAAQ4C,YAAYC,eAI9D,qBAAKjB,UAAWE,IAAO,aAAcgB,QAnDtB,WACH,IAAVlD,EACFL,IAEAM,GAAS,SAAAyC,GAAC,OAAIA,EAAI,QAiDlB,qBAAKV,UAAWE,IAAO,cAAegB,QA/D3B,WACTlD,IAAUE,EAAK6B,OAAS,GACT,SAAblC,GACFI,EAAS,GAEXR,KAEAQ,GAAS,SAAAyC,GAAC,OAAIA,EAAI","file":"static/js/30.e5ae3c41.chunk.js","sourcesContent":["import React from \"react\";\n\nexport interface PadProps {\n  amt: number;\n  insideRow?: boolean;\n}\n\nconst Pad: React.FC<PadProps> = ({ amt, insideRow }) => {\n  const style: React.CSSProperties = {};\n  if (insideRow) {\n    style.width = amt;\n  } else {\n    style.height = amt;\n  }\n\n  return <div style={style} />;\n};\n\nexport default Pad;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"PAD\":\"24px\",\"container\":\"css_container__1PBSF\",\"info\":\"css_info__3-BVc\",\"lines-container\":\"css_lines-container__2cbF7\",\"line\":\"css_line__2Yjr7\",\"line-selected\":\"css_line-selected__2NoqB css_line__2Yjr7\",\"half\":\"css_half__og7Px\",\"half-left\":\"css_half-left__5n9sU css_half__og7Px\",\"half-right\":\"css_half-right__2A-oI css_half__og7Px\",\"picture\":\"css_picture__-Xnv0\"};","import React from \"react\";\nimport classNames from \"classnames\";\nimport moment from \"moment\";\nimport * as Common from \"shock-common\";\n\nimport Pad from \"../../common/Pad\";\nimport * as Utils from \"../../utils\";\nimport { rifle } from \"../../utils/WebSocket\";\nimport * as Store from \"../../store\";\nimport { Pic } from \"../../hooks\";\n\nimport styles from \"./css/index.module.css\";\n\nexport interface StoryParams {\n  publicKey?: string;\n}\n\nexport interface StoryProps {\n  publicKey?: string;\n  onNext(): void;\n  onPrevious(): void;\n  position: \"first\" | \"middle\" | \"last\";\n}\n\nconst Story: React.FC<StoryProps> = ({\n  publicKey: propsPublicKey,\n  onNext: onParentNext,\n  onPrevious: onParentPrevious,\n  position\n}) => {\n  const [currI, setCurrI] = React.useState<number>(0);\n  const [pics, setPics] = React.useState<readonly Pic[]>([]);\n  const currPic = pics[currI];\n  // const { publicKey: paramPublicKey } = useParams<StoryParams>();\n  // @ts-ignore\n  const publicKey = Store.useSelector(state => state.node.publicKey); //paramPublicKey || propsPublicKey;\n  const { displayName } = Store.useSelector(\n    ({ userProfiles }) => userProfiles[publicKey]\n  );\n  const { hostIP } = Store.useSelector(state => state.node);\n  const subscribeStory = React.useCallback(async () => {\n    const sub = await rifle({\n      host: hostIP,\n      query: `${publicKey}::story::open`\n    });\n\n    sub.on(\"$shock\", (pictures: unknown) => {\n      if (typeof pictures !== \"object\" || pictures === null) {\n        return;\n      }\n\n      setPics(\n        Object.values(pictures).filter(p => typeof p === \"object\" && p !== null)\n      );\n    });\n\n    sub.on(\"error\", err => {\n      console.log(`Error inside story sub:`);\n      console.log(err);\n    });\n\n    sub.on(\"NOT_AUTH\", () => {\n      console.warn(`NOT_AUTH inside story sub.`);\n      // TODO: dispatch token invalidation\n    });\n\n    return () => {\n      sub.off(\"$shock\");\n      sub.close();\n    };\n  }, [hostIP, publicKey]);\n\n  React.useEffect(() => {\n    subscribeStory();\n  }, [subscribeStory]);\n\n  React.useEffect(() => {\n    if (currI !== 0 && position !== \"first\") {\n      // setCurrI(0);\n    }\n  }, [currI, position]);\n\n  const onNext = () => {\n    if (currI === pics.length - 1) {\n      if (position !== \"last\") {\n        setCurrI(0);\n      }\n      onParentNext();\n    } else {\n      setCurrI(i => i + 1);\n    }\n  };\n  const onPrevious = () => {\n    if (currI === 0) {\n      onParentPrevious();\n    } else {\n      setCurrI(i => i - 1);\n    }\n  };\n\n  if (pics.length === 0) {\n    return <div className={classNames(\"page-container\", styles.container)} />;\n  }\n\n  return (\n    <div className={classNames(\"page-container\", styles.container)}>\n      <img\n        alt={`Pic ${currI + 1} out of ${pics.length}`}\n        src={`data:image/jpeg;base64,${currPic.data}`}\n        className={styles.picture}\n      />\n\n      <Pad amt={24} />\n\n      <div className={styles[\"lines-container\"]}>\n        {pics.map((pic, i) => (\n          <React.Fragment key={pic.id}>\n            <Pad amt={12} insideRow />\n\n            <div\n              className={classNames(\n                styles[\"line\"],\n                i === currI && styles[\"line-selected\"]\n              )}\n            />\n\n            <Pad amt={12} insideRow />\n          </React.Fragment>\n        ))}\n      </div>\n\n      <Pad amt={24} />\n\n      <div className={styles.info}>\n        <span>{displayName}</span>\n\n        <Pad amt={12} />\n\n        <span>\n          {moment(Common.normalizeTimestampToMs(currPic.timestamp)).fromNow()}\n        </span>\n      </div>\n\n      <div className={styles[\"half-left\"]} onClick={onPrevious} />\n\n      <div className={styles[\"half-right\"]} onClick={onNext} />\n    </div>\n  );\n};\n\nexport default Story;\n"],"sourceRoot":""}